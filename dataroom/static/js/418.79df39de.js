"use strict";(self["webpackChunk_gcpaas_data_room_ui"]=self["webpackChunk_gcpaas_data_room_ui"]||[]).push([[418],{53418:function(e,t,a){a.r(t),a.d(t,{default:function(){return P}});a(34284);var o=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"bs-container"},[a("div",{staticClass:"inner-container"},[a("el-form",{staticClass:"filter-container",attrs:{inline:!0}},[a("el-form-item",{staticClass:"filter-input filter-item"},[a("el-input",{staticClass:"bs-el-input",attrs:{clearable:"",maxlength:"200",placeholder:"请输入地图名称或标识"},on:{clear:e.getDataList},model:{value:e.searchForm.searchKey,callback:function(t){e.$set(e.searchForm,"searchKey",t)},expression:"searchForm.searchKey"}})],1),a("el-form-item",{staticClass:"filter-item"},[a("el-select",{staticClass:"bs-el-select",attrs:{clearable:"",placeholder:"请选择地图级别","popper-class":"bs-el-select"},on:{change:e.getDataList},model:{value:e.searchForm.level,callback:function(t){e.$set(e.searchForm,"level",t)},expression:"searchForm.level"}},e._l(e.levelList,(function(e){return a("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),1)],1),a("el-form-item",{staticClass:"filter-item"},[a("el-button",{attrs:{loading:e.searchLoading,icon:"el-icon-search",type:"primary"},on:{click:e.getDataList}},[e._v(" 查询 ")])],1),a("el-form-item",{staticClass:"filter-item"},[a("el-button",{staticClass:"bs-el-button-default",on:{click:e.addMap}},[e._v(" 新增 ")])],1)],1),a("div",{staticClass:"bs-table-box"},[a("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.searchLoading,expression:"searchLoading"},{name:"table",rawName:"v-table"}],ref:"table",staticClass:"bs-el-table bs-scrollbar",attrs:{data:e.mapList,"element-loading-text":e.loadingText,load:e.load,"tree-props":{children:"children",hasChildren:"hasChildren"},height:"0",lazy:"","row-key":"id"}},[a("el-empty",{attrs:{slot:"empty"},slot:"empty"}),a("el-table-column",{attrs:{align:"left",label:"地图名称",prop:"name","show-overflow-tooltip":""}}),a("el-table-column",{attrs:{align:"center",label:"地图标识",prop:"mapCode","show-overflow-tooltip":""}}),a("el-table-column",{attrs:{align:"center",label:"地图级别",prop:"level","show-overflow-tooltip":""},scopedSlots:e._u([{key:"default",fn:function(t){return[0===t.row.level?a("span",[e._v("世界")]):1===t.row.level?a("span",[e._v("国家")]):2===t.row.level?a("span",[e._v("省份")]):3===t.row.level?a("span",[e._v("城市")]):4===t.row.level?a("span",[e._v("区县")]):a("span",[e._v(e._s(e.getMoreLevel(t.row.level)))])]}}])}),a("el-table-column",{attrs:{align:"center",label:"已上传配置JSON",prop:"uploadedGeoJson","show-overflow-tooltip":""},scopedSlots:e._u([{key:"default",fn:function(t){return[1===t.row.uploadedGeoJson?a("span",[e._v("是")]):a("span",[e._v("否")])]}}])}),a("el-table-column",{attrs:{align:"center",label:"操作",width:"200"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-button",{staticClass:"bs-el-button-default",on:{click:function(a){return e.editMap(t.row)}}},[e._v(" 编辑 ")]),a("el-button",{staticClass:"bs-el-button-default",on:{click:function(a){return e.deleteMap(t.row)}}},[e._v(" 删除 ")]),1===t.row.uploadedGeoJson?a("el-button",{staticClass:"bs-el-button-default",on:{click:function(a){return e.addChild(t.row)}}},[e._v(" 添加下级 ")]):e._e(),0===t.row.uploadedGeoJson?a("el-button",{staticClass:"bs-el-button-default",on:{click:function(a){return e.uploadGeoJson(t.row)}}},[e._v(" 上传配置 ")]):e._e()]}}])})],1)],1)],1),a("add-form",{ref:"addForm",on:{refresh:e.refreshData}}),a("edit-form",{ref:"editForm",on:{refresh:e.refreshData}}),a("el-dialog",{staticClass:"bs-dialog-wrap bs-el-dialog",attrs:{"close-on-click-modal":!1,visible:e.geoJsonVisible,"append-to-body":"",height:"1000px",title:"geoJson数据",width:"1000px"},on:{"update:visible":function(t){e.geoJsonVisible=t}}},[a("vue-json-viewer",{attrs:{theme:"dark","show-btns":!1,mode:"code"},model:{value:e.currentMapGeoJSon,callback:function(t){e.currentMapGeoJSon=t},expression:"currentMapGeoJSon"}}),a("el-button",{staticClass:"bs-el-button-default",on:{click:function(t){return e.upload()}}},[a("i",{staticClass:"el-icon-upload2"}),e._v(" 上传 ")]),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{staticClass:"bs-el-button-default",on:{click:e.submitUpload}},[e._v("提交")])],1)],1),a("input",{ref:"geoJsonFileUpload",staticStyle:{display:"none"},attrs:{accept:".json",name:"file",type:"file"},on:{change:e.handleBatchUpload}})],1)},n=[],s=a(50124),l=a(48534),r=(a(56646),a(60228),a(21694),a(76265),a(70560),a(49693),a(47522),a(38077),a(97195),a(69358),a(48324),a(64043),a(7409),a(752),a(46761)),i=a(91317),c=a.n(i),p=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return c().prototype.$dataRoomAxios.get("/bigScreen/map/list",e,t)},m=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return c().prototype.$dataRoomAxios.post("/bigScreen/map/add",e,t)},u=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return c().prototype.$dataRoomAxios.post("/bigScreen/map/update",e,t)},d=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"-1";return c().prototype.$dataRoomAxios.post("/bigScreen/map/delete/".concat(e))},f=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"-1";return c().prototype.$dataRoomAxios.post("/bigScreen/map/cascadingDelete/".concat(e))},h=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"-1";return c().prototype.$dataRoomAxios.get("/bigScreen/map/getMapChildFromGeoJson/".concat(e))},v=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return c().prototype.$dataRoomAxios.post("/bigScreen/map/upload",e,t)},g=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return c().prototype.$dataRoomAxios.post("/bigScreen/map/repeat/code",e,t)},b=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return c().prototype.$dataRoomAxios.post("/bigScreen/map/repeat/name",e,t)},F=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"-1";return c().prototype.$dataRoomAxios.get("/bigScreen/map/info/".concat(e))},C=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("el-dialog",{staticClass:"bs-dialog-wrap bs-el-dialog",attrs:{"append-to-body":!0,"before-close":e.handleClose,"close-on-click-modal":!1,title:e.title,visible:e.mapFormVisible,width:"700px"},on:{"update:visible":function(t){e.mapFormVisible=t}}},[a("el-form",{ref:"mapForm",staticClass:"bs-el-form",attrs:{model:e.mapForm,rules:e.rules,"label-width":"120px"}},[a("el-form-item",{attrs:{label:"上级地图",prop:"parentId"}},[a("el-input",{staticClass:"bs-el-input",attrs:{disabled:""},model:{value:e.parentName,callback:function(t){e.parentName=t},expression:"parentName"}})],1),a("el-form-item",{attrs:{label:"地图名称",prop:"name"}},[a("el-input",{staticClass:"bs-el-input",attrs:{placeholder:"请输入"},model:{value:e.mapForm.name,callback:function(t){e.$set(e.mapForm,"name",t)},expression:"mapForm.name"}})],1),a("el-form-item",{attrs:{label:"地图标识",prop:"mapCode"}},[a("template",{slot:"label"},[a("span",[e._v("地图标识")]),"0"!==e.mapForm.parentId?a("el-tooltip",{staticClass:"item",attrs:{effect:"light",content:"子级的地图标识解析自上级地图的子区块数据",placement:"top"}},[a("i",{staticClass:"el-icon-warning-outline",staticStyle:{color:"#E3C98C","margin-left":"6px","font-size":"14px"}})]):e._e()],1),"0"===e.mapForm.parentId?a("el-input",{staticClass:"bs-el-input",attrs:{placeholder:"请输入地图标识"},model:{value:e.mapForm.mapCode,callback:function(t){e.$set(e.mapForm,"mapCode",t)},expression:"mapForm.mapCode"}}):a("el-select",{staticClass:"bs-el-select",attrs:{placeholder:"请选择地图标识","popper-class":"bs-el-select"},model:{value:e.mapForm.mapCode,callback:function(t){e.$set(e.mapForm,"mapCode",t)},expression:"mapForm.mapCode"}},e._l(e.mapCodeList,(function(t){return a("el-option",{key:t.name,attrs:{disabled:t.exist,label:t.name,value:t.name}},[a("span",{staticStyle:{float:"left"}},[e._v(e._s(t.name))]),a("span",{staticStyle:{float:"right",color:"#8492a6","font-size":"13px"}},[e._v(e._s(t.exist?"已存在":""))])])})),1)],2),a("el-form-item",{attrs:{label:"地图级别",prop:"level"}},[a("el-select",{staticClass:"bs-el-select",attrs:{disabled:"0"!==e.mapForm.parentId,placeholder:"请选择地图级别","popper-class":"bs-el-select"},model:{value:e.mapForm.level,callback:function(t){e.$set(e.mapForm,"level",t)},expression:"mapForm.level"}},[e._l(e.levelList,(function(e){return a("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),[0,1,2,3,4].includes(e.mapForm.level)?e._e():a("el-option",{attrs:{value:e.mapForm.level,label:e.outRangeLabel}})],2)],1),a("el-form-item",{attrs:{label:"geoJson上传"}},[a("vue-json-viewer",{attrs:{theme:"dark","show-btns":!1,mode:"code"},model:{value:e.mapForm.geoJson,callback:function(t){e.$set(e.mapForm,"geoJson",t)},expression:"mapForm.geoJson"}}),a("el-button",{staticClass:"bs-el-button-default",on:{click:e.upload}},[a("i",{staticClass:"el-icon-upload2"}),e._v(" 上传 ")])],1),e.autoParseNextLevelShow?a("el-form-item",{attrs:{label:"自动解析下一级",prop:"autoParseNextLevel"}},[a("el-switch",{staticClass:"bs-el-switch",attrs:{"active-value":1,"inactive-value":0},model:{value:e.mapForm.autoParseNextLevel,callback:function(t){e.$set(e.mapForm,"autoParseNextLevel",t)},expression:"mapForm.autoParseNextLevel"}})],1):e._e()],1),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{staticClass:"bs-el-button-default",on:{click:e.handleClose}},[e._v(" 取消 ")]),a("el-button",{attrs:{type:"primary"},on:{click:e.submitForm}},[e._v(" 确定 ")])],1)],1),a("input",{ref:"geoJsonFile",staticStyle:{display:"none"},attrs:{accept:".json",name:"file",type:"file"},on:{change:e.handleBatchUpload}})],1)},w=[],y=a(3336),x=a(95082),J=(a(21057),a(68932),a(90699)),L=a.n(J),k={name:"AddForm",components:{vueJsonViewer:L()},computed:{autoParseNextLevelShow:function(){return!this.isEmpty(this.mapForm.geoJson)},outRangeLabel:function(){return"级别".concat(this.mapForm.level+1)}},data:function(){var e=this,t=function(t,a,o){"0"===e.mapForm.parentId?g({parentId:e.mapForm.parentId,mapCode:a}).then((function(e){e?o(new Error("地图标识已存在")):o()})):o()},a=function(t,a,o){b({parentId:e.mapForm.parentId,mapName:a}).then((function(e){e?o(new Error("地图名称已存在")):o()}))};return{mapFormVisible:!1,geoJsonVisible:!1,uploadLoading:!1,title:"新增地图数据",parentName:"顶级",mapForm:{parentId:"0",mapCode:"",name:"",level:0,geoJson:{},uploadedGeoJson:0,autoParseNextLevel:0},rules:{mapCode:[{required:!0,message:"请选择地图标识",trigger:"blur"},{validator:t,trigger:"blur"}],name:[{required:!0,message:"请输入地图名称",trigger:"blur"},{validator:a,trigger:"blur"}],level:[{required:!0,message:"请选择地图级别",trigger:"change"}]},levelList:[{value:0,label:"世界"},{value:1,label:"国家"},{value:2,label:"省份"},{value:3,label:"城市"},{value:4,label:"区县"}],mapCodeList:[]}},methods:{init:function(e){this.mapForm={parentId:"0",mapCode:"map-".concat((new Date).getTime()),name:"",level:0,geoJson:{},uploadedGeoJson:0,autoParseNextLevel:0},this.parentName="顶级",e&&(this.mapForm.parentId=e.id,this.parentName=e.name,this.mapForm.level=e.level+1,this.mapForm.mapCode="",this.getMapCodeList())},handleClose:function(){this.mapFormVisible=!1},submitForm:function(){var e=this;this.$refs.mapForm.validate((function(t){if(!t)return!1;var a;a=e.isEmpty(e.mapForm.geoJson)?"":JSON.stringify(e.mapForm.geoJson),m((0,x.Z)((0,x.Z)({},e.mapForm),{},{geoJson:a})).then((function(t){e.mapFormVisible=!1,e.$emit("refresh",{id:t,parentId:e.mapForm.parentId})}))}))},isEmpty:function(e){return"object"===(0,y.Z)(e)?0===Object.keys(e).length&&e.constructor===Object:"string"===typeof e?/^\s*$/.test(e):Array.isArray(e)&&0===e.length},getMapCodeList:function(){var e=this;this.mapCodeList=[],"0"===this.mapForm.parentId?this.mapCodeList=[{name:"map-".concat((new Date).getTime()),exist:!1}]:h(this.mapForm.parentId).then((function(t){e.mapCodeList=t}))},upload:function(){this.$refs.geoJsonFile.click()},handleBatchUpload:function(e){var t=this;this.uploadLoading=!0;var a=e.target.files,o=new FileReader;o.readAsText(a[0],"UTF-8"),o.onload=function(a){var o=a.target.result;try{t.mapForm.geoJson=JSON.parse(o)}catch(n){return t.uploadLoading=!1,t.$message.error("JSON文件格式错误"),!1}t.uploadLoading=!1,e.target.value=""}}}},$=k,_=a(1001),S=(0,_.Z)($,C,w,!1,null,"bcd20ace",null),N=S.exports,I=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("el-dialog",{staticClass:"bs-dialog-wrap bs-el-dialog",attrs:{"append-to-body":!0,"before-close":e.handleClose,"close-on-click-modal":!1,title:e.title,visible:e.mapFormVisible,width:"700px"},on:{"update:visible":function(t){e.mapFormVisible=t}}},[a("el-form",{ref:"mapForm",staticClass:"bs-el-form",attrs:{model:e.mapForm,rules:e.rules,"label-width":"120px"}},[a("el-form-item",{attrs:{label:"上级地图",prop:"parentId"}},[a("el-input",{staticClass:"bs-el-input",attrs:{disabled:""},model:{value:e.parentName,callback:function(t){e.parentName=t},expression:"parentName"}})],1),a("el-form-item",{attrs:{label:"地图名称",prop:"name"}},[a("el-input",{staticClass:"bs-el-input",attrs:{placeholder:"请输入"},model:{value:e.mapForm.name,callback:function(t){e.$set(e.mapForm,"name",t)},expression:"mapForm.name"}})],1),a("el-form-item",{attrs:{label:"地图标识",prop:"mapCode"}},[a("template",{slot:"label"},[a("span",[e._v("地图标识")]),"0"!==e.mapForm.parentId?a("el-tooltip",{staticClass:"item",attrs:{effect:"light",content:"地图标识取自上级地图JSON数据中的properties.name值，用于在地图中显示地区名称",placement:"top"}},[a("i",{staticClass:"el-icon-warning-outline",staticStyle:{color:"#E3C98C","margin-left":"6px","font-size":"14px"}})]):e._e()],1),a("el-input",{staticClass:"bs-el-input",attrs:{placeholder:"请输入地图标识"},model:{value:e.mapForm.mapCode,callback:function(t){e.$set(e.mapForm,"mapCode",t)},expression:"mapForm.mapCode"}})],2),a("el-form-item",{attrs:{label:"地图级别",prop:"level"}},[a("template",{slot:"label"},[a("span",[e._v("地图级别")]),"0"!==e.mapForm.parentId?a("el-tooltip",{staticClass:"item",attrs:{effect:"light",content:"子级地图的级别根据上级地图自动递增，不可修改",placement:"top"}},[a("i",{staticClass:"el-icon-warning-outline",staticStyle:{color:"#E3C98C","margin-left":"6px","font-size":"14px"}})]):e._e()],1),a("el-select",{staticClass:"bs-el-select",attrs:{disabled:"",placeholder:"请选择地图级别","popper-class":"bs-el-select"},model:{value:e.mapForm.level,callback:function(t){e.$set(e.mapForm,"level",t)},expression:"mapForm.level"}},[e._l(e.levelList,(function(e){return a("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})})),[0,1,2,3,4].includes(e.mapForm.level)?e._e():a("el-option",{attrs:{value:e.mapForm.level,label:e.outRangeLabel}})],2)],2),a("el-form-item",{attrs:{label:"geoJson"}},[a("vue-json-viewer",{attrs:{theme:"dark","show-btns":!1,mode:"code"},model:{value:e.mapForm.geoJson,callback:function(t){e.$set(e.mapForm,"geoJson",t)},expression:"mapForm.geoJson"}}),1!==e.mapForm.uploadedGeoJson?a("el-button",{staticClass:"bs-el-button-default",on:{click:e.upload}},[a("i",{staticClass:"el-icon-upload2"}),e._v(" 上传 ")]):e._e()],1),e.autoParseNextLevelShow?a("el-form-item",{attrs:{label:"自动解析下一级",prop:"autoParseNextLevel"}},[a("el-switch",{staticClass:"bs-el-switch",attrs:{"active-value":1,"inactive-value":0},model:{value:e.mapForm.autoParseNextLevel,callback:function(t){e.$set(e.mapForm,"autoParseNextLevel",t)},expression:"mapForm.autoParseNextLevel"}})],1):e._e()],1),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{staticClass:"bs-el-button-default",on:{click:e.handleClose}},[e._v(" 取消 ")]),a("el-button",{attrs:{type:"primary"},on:{click:e.submitForm}},[e._v(" 确定 ")])],1)],1),a("input",{ref:"geoJsonFile",staticStyle:{display:"none"},attrs:{accept:".json",name:"file",type:"file"},on:{change:e.handleBatchUpload}})],1)},M=[],R=a(96486),Z=a.n(R),z={name:"EditForm",components:{vueJsonViewer:L()},computed:{autoParseNextLevelShow:function(){return!this.isWhitespace(this.mapForm.geoJson)&&!this.isEmpty(this.mapForm.geoJson)&&0===this.mapForm.uploadedGeoJson},outRangeLabel:function(){return"级别".concat(this.mapForm.level+1)}},data:function(){var e=this,t=function(t,a,o){"0"!==e.mapForm.parentId&&0!==e.mapForm.parentId?h(e.mapForm.parentId).then((function(t){var n=!1;t.forEach((function(t){t.exist&&t.name===a&&t.existId!==e.mapForm.id&&(n=!0)})),n?o(new Error("地图标识已存在")):o()})):o()},a=function(t,a,o){"0"===e.mapForm.parentId?b({id:e.mapForm.id,parentId:e.mapForm.parentId,mapName:a}).then((function(e){e?o(new Error("地图名称已存在")):o()})):o()};return{mapFormVisible:!1,geoJsonVisible:!1,uploadLoading:!1,title:"编辑地图数据",parentName:"顶级",mapForm:{parentId:"0",mapCode:"",name:"",level:0,geoJson:"",uploadedGeoJson:0,autoParseNextLevel:0},rules:{mapCode:[{required:!0,message:"请输入地图标识",trigger:"blur"},{validator:t,trigger:"blur"}],name:[{required:!0,message:"请输入地图名称",trigger:"blur"},{validator:a,trigger:"blur"}],level:[{required:!0,message:"请选择地图级别",trigger:"change"}],geoJson:[{required:!0,message:"请上传地图数据",trigger:"change"}]},levelList:[{value:0,label:"世界"},{value:1,label:"国家"},{value:2,label:"省份"},{value:3,label:"城市"},{value:4,label:"区县"}],mapCodeList:[]}},methods:{init:function(e){this.mapForm=Z().cloneDeep(e),this.isWhitespace(this.mapForm.geoJson)?this.mapForm.geoJson={}:this.mapForm.geoJson=JSON.parse(this.mapForm.geoJson)},handleClose:function(){this.mapFormVisible=!1},submitForm:function(){var e=this;this.$refs.mapForm.validate((function(t){if(!t)return!1;var a;a=e.isWhitespace(e.mapForm.geoJson)||"{}"===e.mapForm.geoJson||"[]"===e.mapForm.geoJson?"":JSON.stringify(e.mapForm.geoJson),u((0,x.Z)((0,x.Z)({},e.mapForm),{},{geoJson:a})).then((function(t){e.mapFormVisible=!1,e.$emit("refresh",{id:e.mapForm.id,parentId:e.mapForm.parentId})}))}))},isWhitespace:function(e){return null==e||/^\s*$/.test(e)},isEmpty:function(e){return"object"===(0,y.Z)(e)?0===Object.keys(e).length&&e.constructor===Object:"string"===typeof e?/^\s*$/.test(e):Array.isArray(e)&&0===e.length},upload:function(){this.$refs.geoJsonFile.click()},handleBatchUpload:function(e){var t=this;this.uploadLoading=!0;var a=e.target.files,o=new FileReader;o.readAsText(a[0],"UTF-8"),o.onload=function(a){var o=a.target.result;try{t.mapForm.geoJson=JSON.parse(o)}catch(n){return t.uploadLoading=!1,t.$message.error("JSON文件格式错误"),!1}t.uploadLoading=!1,e.target.value=""}}}},E=z,V=(0,_.Z)(E,I,M,!1,null,"346c0005",null),T=V.exports,G={name:"MapManagement",directives:{table:r.Z},components:{AddForm:N,EditForm:T,vueJsonViewer:L()},data:function(){return{currentMap:{},currentMapGeoJSon:{},loadingText:"",searchLoading:!1,geoJsonVisible:!1,lazyResolveIds:[],lazyResolveMap:new Map,searchForm:{searchKey:"",level:null,uploadedGeoJson:null,parentId:"0"},levelList:[{label:"世界",value:0},{label:"国家",value:1},{label:"省份",value:2},{label:"城市",value:3},{label:"区县",value:4}],mapList:[],tipped:!1}},mounted:function(){this.init()},methods:{init:function(){var e=this;this.searchLoading=!0,this.loadingText="正在加载地图数据...",p(this.searchForm).then((function(t){e.mapList=t,e.searchLoading=!1,e.tipped||0!==e.mapList.length||e.tip()})).catch((function(t){e.searchLoading=!1}))},getDataList:function(){var e=this;this.lazyResolveMap.clear(),this.$nextTick((function(){e.mapList=[]})),this.$nextTick((function(){e.searchLoading=!0,e.loadingText="正在加载地图数据...",p(e.searchForm).then((function(t){e.mapList=t,e.searchLoading=!1})).catch((function(t){e.searchLoading=!1}));for(var t=0;t<e.lazyResolveIds.length;t++)e.$refs.table.store.states.treeData[e.lazyResolveIds[t]].loaded=!1,e.$refs.table.store.states.treeData[e.lazyResolveIds[t]].expanded=!1}))},refreshData:function(e){var t=this,a=e.parentId;if(this.lazyResolveMap.get(a)){var o=this.lazyResolveMap.get(a),n=o.data,s=o.treeNode,l=o.resolve;return this.$set(this.$refs.table.store.states.lazyTreeNodeMap,a,[]),void this.load(n,s,l)}"0"!==a&&0!==a?F(a).then((function(e){if(a=e.parentId,t.lazyResolveMap.get(a)){var o=t.lazyResolveMap.get(a),n=o.data,s=o.treeNode,l=o.resolve;t.$set(t.$refs.table.store.states.lazyTreeNodeMap,a,[]),t.load(n,s,l),t.$refs.table.toggleRowExpansion(a,!0)}else t.getDataList()})):this.getDataList()},getMoreLevel:function(e){return"级别"+(e+1)},addMap:function(){this.$refs.addForm.mapFormVisible=!0,this.$refs.addForm.init()},load:function(e,t,a){var o=this;this.lazyResolveMap.set(e.id,{data:e,treeNode:t,resolve:a}),this.lazyResolveIds.push(e.id),p({parentId:e.id}).then((function(e){var t=[];e.forEach((function(e){o.mapList.forEach((function(a){a.id===e.id&&t.push(a.id)}))})),o.mapList=o.mapList.filter((function(e){return-1===t.indexOf(e.id)})),a(e)})).catch((function(e){a([])}))},deleteMap:function(e){var t=this;this.$confirm("确定删除该地图？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning",customClass:"bs-el-message-box"}).then((0,l.Z)((0,s.Z)().mark((function a(){return(0,s.Z)().wrap((function(a){while(1)switch(a.prev=a.next){case 0:d(e.id).then((function(a){a?(t.$message({type:"success",message:"删除成功"}),t.refreshData({id:e.id,parentId:e.parentId})):t.deleteMapCascade(e)})).catch((function(){t.$message({type:"error",message:"删除失败"})}));case 1:case"end":return a.stop()}}),a)})))).catch((function(){}))},tip:function(){var e='<span>大屏设计器提供了全国省市区县的地图数据，<a href="https://www.yuque.com/chuinixiongkou/bigscreen/kdrm8g3c8zfgaaq6#xjE8w" style="color: #00a0e9"  target="_blank">点击查看</a></span>';this.$notify({title:"推荐",dangerouslyUseHTMLString:!0,message:e,customClass:"ds-el-notify",type:"warning",duration:5e3})},deleteMapCascade:function(e){var t=this;this.$confirm("该地图存在子级，是否直接删除该地图以及其所有子级？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning",customClass:"bs-el-message-box"}).then((0,l.Z)((0,s.Z)().mark((function a(){return(0,s.Z)().wrap((function(a){while(1)switch(a.prev=a.next){case 0:f(e.id).then((function(){t.$message({type:"success",message:"删除成功"}),t.refreshData({id:e.id,parentId:e.parentId})})).catch((function(){}));case 1:case"end":return a.stop()}}),a)})))).catch((function(){}))},addChild:function(e){this.$refs.addForm.mapFormVisible=!0,this.$refs.addForm.init(e)},editMap:function(e){this.$refs.editForm.mapFormVisible=!0,this.$refs.editForm.init(e)},uploadGeoJson:function(e){this.currentMap=e,this.currentMapGeoJSon={},this.geoJsonVisible=!0},upload:function(){this.$refs.geoJsonFileUpload.click()},handleBatchUpload:function(e){var t=this;this.uploadLoading=!0;var a=e.target.files,o=new FileReader;o.readAsText(a[0],"UTF-8"),o.onload=function(a){var o=a.target.result;try{t.currentMapGeoJSon=JSON.parse(o)}catch(n){return t.uploadLoading=!1,t.$message.error("JSON文件格式错误"),!1}t.uploadLoading=!1,e.target.value=""}},submitUpload:function(){var e=this;return"string"===typeof this.currentMapGeoJSon?(this.$message.error("JSON文件格式错误"),!1):this.currentMapGeoJSon==={}?(this.$message.error("JSON数据不能为空"),!1):(v({id:this.currentMap.id,geoJson:JSON.stringify(this.currentMapGeoJSon)}).then((function(t){e.$message({type:"success",message:"上传成功"}),e.geoJsonVisible=!1,e.refreshData({id:e.currentMap.id,parentId:e.currentMap.parentId})})).catch((function(t){e.$message({type:"error",message:"上传失败"})})),void(this.geoJsonVisible=!1))},isWhitespace:function(e){return null==e||/^\s*$/.test(e)}}},A=G,O=(0,_.Z)(A,o,n,!1,null,"a412da9e",null),D=O.exports;D.install=function(e){e.component(D.name,D)};var P=D},46761:function(e,t,a){var o=a(50124),n=a(48534),s=(a(96869),a(21057),a(68932),function(){var e=(0,n.Z)((0,o.Z)().mark((function e(t,a,n){var s,l,r,i,c;return(0,o.Z)().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,n;case 2:if(s=e.sent,l=s.componentInstance,r=a.value,l.height){e.next=7;break}throw new Error("使用v-table指令,el-table需设置height,例如: height='0'");case 7:if(i=r||100,l){e.next=10;break}return e.abrupt("return");case 10:c=window.innerHeight-t.getBoundingClientRect().top-i,c+=32,l.layout.setHeight(c),l.doLayout();case 14:case"end":return e.stop()}}),e)})));return function(t,a,o){return e.apply(this,arguments)}}()),l=function(e){var t=null;return function(){t||(t=setTimeout((function(){e(),t=null}),500))}};t.Z={bind:function(e,t,a){e.resizeListener=(0,n.Z)((0,o.Z)().mark((function n(){return(0,o.Z)().wrap((function(o){while(1)switch(o.prev=o.next){case 0:return o.next=2,s(e,t,a);case 2:case"end":return o.stop()}}),n)}))),window.addEventListener("resize",l(e.resizeListener))},inserted:function(e,t,a){return(0,n.Z)((0,o.Z)().mark((function n(){return(0,o.Z)().wrap((function(o){while(1)switch(o.prev=o.next){case 0:return o.next=2,s(e,t,a);case 2:case"end":return o.stop()}}),n)})))()},componentUpdated:function(e,t,a){return(0,n.Z)((0,o.Z)().mark((function n(){return(0,o.Z)().wrap((function(o){while(1)switch(o.prev=o.next){case 0:return o.next=2,setTimeout((function(){s(e,t,a)}),500);case 2:case"end":return o.stop()}}),n)})))()},unbind:function(e){window.removeEventListener("resize",l(e.resizeListener))}}}}]);