"use strict";(self["webpackChunk_gcpaas_data_room_ui"]=self["webpackChunk_gcpaas_data_room_ui"]||[]).push([[579],{65864:function(e,t,a){a.d(t,{Z:function(){return c}});var s=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("el-dialog",{staticClass:"bs-dialog-wrap bs-el-dialog",attrs:{width:"700px",title:"提示",visible:e.checkDatasourceVisible,"append-to-body":!0,"close-on-click-modal":!1,"before-close":e.handleClose},on:{"update:visible":function(t){e.checkDatasourceVisible=t}}},[a("div",{staticClass:"text-style"},e._l(e.reasonList,(function(t,s){return a("div",{key:s,staticClass:"item"},[e.reasonList.length>1?a("span",[e._v(" "+e._s(s+1)+"、")]):e._e(),e._v(e._s(t)+" ")])})),0),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{attrs:{type:"primary"},on:{click:e.handleClose}},[e._v(" 确定 ")])],1)])},i=[],r={props:{reasonList:{type:Array,default:function(){return[]}}},data:function(){return{checkDatasourceVisible:!1}},methods:{handleClose:function(){this.checkDatasourceVisible=!1}}},l=r,o=a(1001),n=(0,o.Z)(l,s,i,!1,null,"ea4de222",null),c=n.exports},69579:function(e,t,a){a.r(t),a.d(t,{default:function(){return Ht}});a(34284);var s=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"bs-container",attrs:{id:"box"},on:{mousemove:e.mousemoveOnBox,mouseup:e.mouseupOnBox}},[a("el-row",{directives:[{name:"show",rawName:"v-show",value:null===e.datasetType,expression:"datasetType === null"}],staticClass:"layout",attrs:{type:"flex"}},[a("div",{staticClass:"left-box",style:{transition:e.transition+"s"},attrs:{id:"left-box"}},[a("div",{staticClass:"inner-container"},[a("TypeTree",{ref:"datasetsTypeTree",attrs:{"dataset-type-list":e.datasetTypeList,"app-code":e.appCode},on:{nodeClick:e.nodeClick,refreshData:e.refreshData,expandedNodes:e.expandedNodes,reCategory:e.getTreeList}})],1)]),a("div",{staticClass:"right-box inner-container",style:{transition:e.transition+"s"}},[a("div",{staticClass:"resize  pack-up-box",attrs:{id:"resize"},on:{mousedown:e.mousedown,mouseup:e.mouseup,mousemove:e.mousemove}},[e.isPackUpTree?a("a",{on:{click:e.packUpTree,mousedown:function(t){e.resize=null},mouseup:function(t){e.resize=null},mousemove:function(t){e.resize=null}}},[a("i",{class:!1===e.isPackUpTree?"el-icon-caret-left":"el-icon-caret-right"})]):a("a",{staticClass:"visible-pack-up"},[a("span",[e._v("||")])])]),a("el-form",{ref:"queryForm",staticClass:"filter-container bs-el-form",attrs:{model:e.queryForm},nativeOn:{submit:function(e){e.preventDefault()}}},[a("el-form-item",{staticClass:"filter-item",attrs:{prop:"name"}},[a("el-input",{staticClass:"bs-el-input",attrs:{placeholder:"请输入数据集名称",clearable:""},on:{clear:function(t){return e.handleSearch()}},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.handleSearch()}},model:{value:e.queryForm.name,callback:function(t){e.$set(e.queryForm,"name",t)},expression:"queryForm.name"}})],1),a("el-form-item",{staticClass:"filter-item",attrs:{prop:"labelIds"}},[a("el-select",{staticClass:"bs-el-select",attrs:{"popper-class":"bs-el-select",clearable:"",filterable:"",multiple:"","collapse-tags":"",placeholder:"请选择数据集关联标签"},on:{clear:function(t){return e.handleSearch()}},model:{value:e.queryForm.labelIds,callback:function(t){e.$set(e.queryForm,"labelIds",t)},expression:"queryForm.labelIds"}},e._l(e.labelList,(function(e){return a("el-option",{key:e.id,attrs:{label:e.labelName,value:e.id}})})),1)],1),a("el-form-item",{staticClass:"filter-item"},[a("el-button",{attrs:{loading:e.dataListLoading,type:"primary",icon:"el-icon-search"},on:{click:function(t){return e.handleSearch()}}},[e._v(" 查询 ")])],1),a("el-form-item",{staticClass:"filter-item"},[e.toAdd?a("el-button",{staticClass:"bs-el-button-default",on:{click:e.addDataset}},[e._v(" 新增 ")]):e._e()],1)],1),a("div",{staticClass:"bs-table-box"},[e.isDialog?a("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.dataListLoading,expression:"dataListLoading"}],ref:"userTable",staticClass:"bs-el-table bs-scrollbar",attrs:{"element-loading-text":e.loadingText,data:e.tableData,"header-cell-style":e.sortStyle},on:{"sort-change":e.reSort,"current-change":e.handleCurrentChange,select:e.selectDs,"select-all":e.selectAll}},[a("el-empty",{attrs:{slot:"empty"},slot:"empty"}),e.isDialog&&e.multiple?a("el-table-column",{attrs:{type:"selection",width:"55"}}):e._e(),a("el-table-column",{attrs:{prop:"name",label:"数据集名称",align:"left","show-overflow-tooltip":""},scopedSlots:e._u([{key:"default",fn:function(t){return[e.isDialog&&!e.multiple?a("el-radio",{attrs:{label:t.row},model:{value:e.curRow,callback:function(t){e.curRow=t},expression:"curRow"}},[e._v(" "+e._s(t.row.name)+" ")]):a("span",[e._v(e._s(t.row.name))])]}}],null,!1,1029728320)}),a("el-table-column",{attrs:{prop:"datasetType",label:"数据集类型",align:"center","show-overflow-tooltip":""},scopedSlots:e._u([{key:"default",fn:function(t){return[a("span",[e._v(e._s(e.datasetTypeList.find((function(e){return e.datasetType===t.row.datasetType}))?e.datasetTypeList.find((function(e){return e.datasetType===t.row.datasetType})).name:"其他"))])]}}],null,!1,1755705642)}),a("el-table-column",{attrs:{prop:"labelIds",label:"标签",align:"center","show-overflow-tooltip":""},scopedSlots:e._u([{key:"default",fn:function(t){return[a("span",[e._v(e._s(e.getLabels(t.row.labelIds).join(",")))])]}}],null,!1,2828904765)}),a("el-table-column",{attrs:{prop:"remark",label:"备注",align:"left","show-overflow-tooltip":""}}),e.doEdit||e.isDelete?a("el-table-column",{attrs:{label:"操作",width:"200",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return e.showOperate(t.row.datasetType)?[e.doEdit?a("el-button",{staticClass:"bs-el-button-default",attrs:{disabled:1===t.row.editable&&!e.appCode},on:{click:function(a){return e.toEdit(t.row.id,t.row.datasetType,t.row.name,t.row.typeId)}}},[e._v(" 编辑 ")]):e._e(),e.isDelete?a("el-button",{staticClass:"bs-el-button-default",attrs:{loading:t.row.loading,disabled:1===t.row.editable&&!e.appCode},on:{click:function(a){return e.delDataset(t.row)}}},[e._v(" 删除 ")]):e._e()]:void 0}}],null,!0)}):e._e()],1):a("el-table",{directives:[{name:"table",rawName:"v-table"},{name:"loading",rawName:"v-loading",value:e.dataListLoading,expression:"dataListLoading"}],ref:"userTable",staticClass:"bs-el-table bs-scrollbar",attrs:{height:"0","element-loading-text":e.loadingText,data:e.tableData,"header-cell-style":e.sortStyle},on:{"sort-change":e.reSort,"current-change":e.handleCurrentChange,select:e.selectDs,"select-all":e.selectAll}},[a("el-empty",{attrs:{slot:"empty"},slot:"empty"}),e.isDialog&&e.multiple?a("el-table-column",{attrs:{type:"selection",width:"55"}}):e._e(),a("el-table-column",{attrs:{prop:"name",label:"数据集名称",align:"left","show-overflow-tooltip":""},scopedSlots:e._u([{key:"default",fn:function(t){return[e.isDialog&&!e.multiple?a("el-radio",{attrs:{label:t.row},model:{value:e.curRow,callback:function(t){e.curRow=t},expression:"curRow"}},[e._v(" "+e._s(t.row.name)+" ")]):a("span",[e._v(e._s(t.row.name))])]}}])}),a("el-table-column",{attrs:{prop:"datasetType",label:"数据集类型",align:"center","show-overflow-tooltip":""},scopedSlots:e._u([{key:"default",fn:function(t){return[a("span",[e._v(e._s(e.datasetTypeList.find((function(e){return e.datasetType===t.row.datasetType}))?e.datasetTypeList.find((function(e){return e.datasetType===t.row.datasetType})).name:"其他"))])]}}])}),a("el-table-column",{attrs:{prop:"labelIds",label:"标签",align:"center","show-overflow-tooltip":""},scopedSlots:e._u([{key:"default",fn:function(t){return[a("span",[e._v(e._s(e.getLabels(t.row.labelIds).join(",")))])]}}])}),a("el-table-column",{attrs:{prop:"remark",label:"备注",align:"left","show-overflow-tooltip":""}}),e.doEdit||e.isDelete?a("el-table-column",{attrs:{label:"操作",width:"200",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return e.showOperate(t.row.datasetType)?[e.doEdit?a("el-button",{staticClass:"bs-el-button-default",attrs:{disabled:1===t.row.editable&&!e.appCode},on:{click:function(a){return e.toEdit(t.row.id,t.row.datasetType,t.row.name,t.row.typeId)}}},[e._v(" 编辑 ")]):e._e(),e.isDelete?a("el-button",{staticClass:"bs-el-button-default",attrs:{loading:t.row.loading,disabled:1===t.row.editable&&!e.appCode},on:{click:function(a){return e.delDataset(t.row)}}},[e._v(" 删除 ")]):e._e()]:void 0}}],null,!0)}):e._e()],1)],1),a("div",{staticClass:"bs-pagination"},[a("el-pagination",{staticClass:"bs-el-pagination",attrs:{"popper-class":"bs-el-pagination","current-page":e.current,"page-sizes":[10,20,50,100],"page-size":e.size,total:e.totalCount,background:"","prev-text":"上一页","next-text":"下一页",layout:"total, prev, pager, next, sizes"},on:{"size-change":e.sizeChangeHandle,"current-change":e.currentChangeHandle}})],1)],1)]),a("DatasetTypeDialog",{ref:"DatasetTypeDialog",attrs:{"dataset-type-list":e.datasetTypeList},on:{openAddForm:e.openAddForm}}),a("checkDatasource",{ref:"checkDatasource",attrs:{"reason-list":e.reasonList}}),e.datasetType?a(e.componentData.component,{key:e.componentData.key,ref:"EditForm",tag:"component",attrs:{config:e.componentData.config,"dataset-id":e.datasetId,"dataset-name":e.datasetName,"type-id":e.typeId,"is-edit":e.isEdit,"app-code":e.appCode},on:{back:e.back},scopedSlots:e._u([{key:"output-field-table-column",fn:function(){return[e._t("output-field-table-column")]},proxy:!0}],null,!0)}):e._e()],1)},i=[],r=a(95082),l=a(89584),o=(a(38077),a(60228),a(50886),a(64043),a(7409),a(49693),a(47522),a(70560),a(76801),a(43843),a(97195),a(62506),a(25728),a(86466),a(34338),a(39772),function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"bs-theme-wrap"},[a("div",{staticClass:"tree-box"},[a("div",{staticClass:"ztree-filter-container filter-container"},[a("el-input",{staticClass:"ztree-input bs-el-input",attrs:{placeholder:"请输入数据集分组",clearable:""},on:{clear:function(t){return e.reSearch()}},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.reSearch()}},model:{value:e.queryForm.searchKey,callback:function(t){e.$set(e.queryForm,"searchKey",t)},expression:"queryForm.searchKey"}}),a("el-button",{attrs:{loading:e.loading,type:"primary",icon:"el-icon-search"},on:{click:function(t){return e.reSearch()}}},[e._v(" 查询 ")])],1),a("br",{staticClass:"br"}),a("el-tabs",{model:{value:e.activeName,callback:function(t){e.activeName=t},expression:"activeName"}},[a("el-tab-pane",{attrs:{label:"分组",name:"group"}}),a("el-tab-pane",{attrs:{label:"类型",name:"type"}})],1),a("div",{directives:[{name:"show",rawName:"v-show",value:"group"==e.activeName,expression:"activeName == 'group'"}],staticClass:"left"},[a("div",{staticClass:"ztree ztree-box"},[a("el-scrollbar",{staticClass:"scroll"},[a("el-empty",{directives:[{name:"show",rawName:"v-show",value:e.noData,expression:"noData"}]}),e.categoryData.length?e._e():a("div",{staticStyle:{"text-align":"center"}},[a("el-button",{attrs:{type:"text",icon:"el-icon-plus"},on:{click:e.addRootNode}},[a("span",{staticStyle:{color:"var(--bs-el-color-primary)"}},[e._v("新增根节点")])])],1),a("ul",{directives:[{name:"show",rawName:"v-show",value:!e.noData,expression:"!noData"}],staticClass:"ztree",attrs:{id:"datasetTypeTree"}}),a("div",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],staticClass:"loading",attrs:{"element-loading-text":"正在加载数据","element-loading-spinner":"el-icon-loading"}})],1)],1),a("div",{directives:[{name:"show",rawName:"v-show",value:e.rightClickForm.visible,expression:"rightClickForm.visible"}],staticClass:"ztreeNodeMenu",on:{mouseleave:function(t){e.rightClickForm.visible=!1},mouseenter:function(t){e.rightClickForm.visible=!0}}},[a("div",{staticClass:"node-bottom-menu"},[a("div",{staticClass:"triangle"}),a("ul",[e.isBoth?e._e():a("li",{on:{click:function(t){return e.menuClick(e.editTypeConstant.editOrg)}}},[a("span",{attrs:{slot:"title"},slot:"title"},[e._v("编辑")])]),e.isBoth?e._e():a("li",{on:{click:function(t){return e.menuClick(e.editTypeConstant.deleteOrg)}}},[a("span",{attrs:{slot:"title"},slot:"title"},[e._v("删除")])]),a("li",{on:{click:function(t){return e.menuClick(e.editTypeConstant.addSiblingOrg)}}},[a("span",{attrs:{slot:"title"},slot:"title"},[e._v("新增同级")])]),e.isBoth?e._e():a("li",{on:{click:function(t){return e.menuClick(e.editTypeConstant.addChildOrg)}}},[a("span",{attrs:{slot:"title"},slot:"title"},[e._v("新增子级")])])])]),a("div",{staticClass:"node-top-menu"},[a("ul",[e.isBoth?e._e():a("li",{on:{click:function(t){return e.menuClick(e.editTypeConstant.addChildOrg)}}},[a("span",{attrs:{slot:"title"},slot:"title"},[e._v("新增子级")])]),a("li",{on:{click:function(t){return e.menuClick(e.editTypeConstant.addSiblingOrg)}}},[a("span",{attrs:{slot:"title"},slot:"title"},[e._v("新增同级")])]),e.isBoth?e._e():a("li",{on:{click:function(t){return e.menuClick(e.editTypeConstant.deleteOrg)}}},[a("span",{attrs:{slot:"title"},slot:"title"},[e._v("删除")])]),e.isBoth?e._e():a("li",{on:{click:function(t){return e.menuClick(e.editTypeConstant.editOrg)}}},[a("span",{attrs:{slot:"title"},slot:"title"},[e._v("编辑")])])]),a("div",{staticClass:"triangle"})])])]),a("div",{directives:[{name:"show",rawName:"v-show",value:"type"==e.activeName,expression:"activeName == 'type'"}],staticClass:"left"},[a("div",{staticClass:"left-tab-box"},[a("ul",e._l(e.datasetTypeList,(function(t,s){return a("li",{key:s,class:{"tab-style":!0,"tab-active":t.datasetType==e.curType},on:{click:function(a){return e.getTypeData(t.datasetType)}}},[a("span",[e._v(e._s(t.name))])])})),0)])]),e.editFormVisible?a("CategroyEditForm",{ref:"categroyEditForm",attrs:{"app-code":e.appCode},on:{addOrUpdateNode:e.addOrUpdateNode}}):e._e()],1)])}),n=[],c=(a(91719),a(19755)),d=a.n(c),u=(a(6816),a(96297),a(96),a(91317)),p=a.n(u),m=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return p().prototype.$dataRoomAxios.get("/dataset/page",e,t)},f=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"-1",t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return p().prototype.$dataRoomAxios.post("/dataset/deleteCheck/".concat(e),{},t)},b=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"-1",t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return p().prototype.$dataRoomAxios.get("/dataset/getCountByType/".concat(e),{},t)},h=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return p().prototype.$dataRoomAxios.post("/dataset/checkRepeat",e,t)},g=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return p().prototype.$dataRoomAxios.post("/dataset/add",e,t)},v=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return p().prototype.$dataRoomAxios.post("/dataset/update",e,t)},_=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"-1",t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return p().prototype.$dataRoomAxios.post("/dataset/delete/".concat(e),{},t)},y=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return p().prototype.$dataRoomAxios.post("/dataset/execute/test",e,t)},w=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"-1",t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return p().prototype.$dataRoomAxios.get("/dataset/info/".concat(e),{},t)},C=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return p().prototype.$dataRoomAxios.get("/category/queryTreeList",e,t)},F=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return p().prototype.$dataRoomAxios.post("/category/add",e,t)},x=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return p().prototype.$dataRoomAxios.post("/category/update",e,t)},L=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"-1",t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return p().prototype.$dataRoomAxios.post("/category/delete/".concat(e),{},t)},k=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return p().prototype.$dataRoomAxios.post("/category/checkRepeat",e,t)},D=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("el-dialog",{staticClass:"bs-dialog-wrap dialogClass bs-el-dialog",attrs:{width:"500px",title:e.title,visible:e.dialogFormVisible,"append-to-body":!0,"before-close":e.handleClose},on:{"update:visible":function(t){e.dialogFormVisible=t}}},[a("div",{staticStyle:{margin:"20px"}},[a("el-form",{ref:"ruleForm",staticClass:"bs-el-form",attrs:{model:e.dataForm,rules:e.rules,"label-position":"left","label-width":"90px"}},[a("el-form-item",{attrs:{label:"分组名称",prop:"name"}},[a("el-input",{staticClass:"bs-el-input",attrs:{clearable:""},model:{value:e.dataForm.name,callback:function(t){e.$set(e.dataForm,"name","string"===typeof t?t.trim():t)},expression:"dataForm.name"}})],1)],1)],1),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{staticClass:"bs-el-button-default",on:{click:e.cancel}},[e._v(" 取消 ")]),a("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.submitForm("ruleForm")}}},[e._v(" 确定 ")])],1)])},T=[],S=(a(21057),a(68932),{name:"CategroyEditForm",props:{appCode:{type:String,default:""}},data:function(){var e=this,t=function(t,a,s){var i="";e.nodeFlag&&(i=0===e.radio?e.nodeData.parentId:e.nodeData.id),k((0,r.Z)((0,r.Z)({},e.dataForm),{},{parentId:i})).then((function(e){e?s(new Error("分组名称已存在")):s()}))};return{type:"dataset",dataForm:{id:"",name:"",parentId:""},title:"",dialogFormVisible:!1,radio:0,nodeFlag:!1,rules:{name:[{required:!0,message:"分组名称不能为空",trigger:"blur"},{validator:t,trigger:"blur"}]},nodeData:{}}},watch:{dialogFormVisible:function(e){e||(this.dataForm={id:"",name:"",parentId:""})}},methods:{init:function(e,t){this.nodeFlag=t,this.nodeData=e,t||(this.dataForm.name=e.name,this.dataForm.id=e.id)},cancel:function(){var e=this;this.dialogFormVisible=!1,this.$nextTick((function(){e.$parent.addOrUpdateTreeVisible=!1}))},handleClose:function(){this.dialogFormVisible=!1,this.$parent.addOrUpdateTreeVisible=!1},submitForm:function(e){var t=this;this.$refs[e].validate((function(e){if(!e)return!1;var a="",s="";t.nodeFlag?s=0===t.radio?t.nodeData.parentId:t.nodeData.id:(a=t.dataForm.id,s=t.nodeData.parentId);var i={id:t.dataForm.id,name:t.dataForm.name,parentId:s,type:t.type,moduleCode:t.appCode};a?x(i).then((function(e){t.$message.success("保存成功"),t.cancel();try{t.$emit("addOrUpdateNode",i,t.nodeFlag)}catch(a){t.$parent.initLazyDatasetTypeTree()}})):F(i).then((function(e){i.id=e,t.$message.success("保存成功"),t.cancel();try{t.$emit("addOrUpdateNode",i,t.nodeFlag)}catch(a){t.$parent.initLazyDatasetTypeTree()}}))}))}}}),P=S,E=a(1001),N=(0,E.Z)(P,D,T,!1,null,null,null),I=N.exports,$={name:"DatasetTypeTreeIndex",components:{CategroyEditForm:I},props:{datasetTypeList:{type:Array,default:function(){return["original","custom","storedProcedure","json","script"]}},appCode:{type:String,default:""}},data:function(){return{activeName:"group",categoryData:[],curType:"-1",noData:!1,loading:!1,rightTableIsTransition:"",flatData:[],queryForm:{searchKey:""},ztreeObj:"",nodeData:"",rightClickForm:{visible:!1,org:{}},editTypeConstant:{deleteOrg:"deleteOrg",editOrg:"editOrg",addChildOrg:"addChildOrg",addSiblingOrg:"addSiblingOrg"},editFormVisible:!1,ztreeSetting:{view:{dblClickExpand:!1,showTitle:!1,addHoverDom:function(e,t){var a=d()("#"+t.tId+"_a");a.css({"background-color":"#f6f7fb",cursor:"pointer"})},removeHoverDom:function(e,t){var a=d()("#"+t.tId+"_a");a.css({"background-color":"rgba(0,0,0,0)"})},addDiyDom:this.addDiyDom},callback:{onClick:this.getNodeData,onExpand:this.expandNode}},isBoth:!1}},computed:{},mounted:function(){this.initLazyDatasetTypeTree()},methods:{addRootNode:function(){var e=this;this.editFormVisible=!0,this.$nextTick((function(){e.$refs.categroyEditForm.tableName="r_dataset",e.$refs.categroyEditForm.dialogFormVisible=!0,e.$refs.categroyEditForm.init({parentId:0},!0),e.$refs.categroyEditForm.radio=0,e.$refs.categroyEditForm.title="新增分组"}))},addDiyDom:function(e,t){if("type"!==this.activeName&&(!t.parentNode||2===t.parentNode.id)){var a=d()("#"+t.tId+"_a"),s="<span  id='diyBtn_"+t.id+"' class='treeAddNode'>⋮</span>";a.after(s);var i=d()("#diyBtn_"+t.id);if(i){var r=this;i.bind("mouseenter",(function(){"全部"===t.name&&""===t.id?r.isBoth=!0:r.isBoth=!1,r.nodeData=t,r.rightClickForm.org=t,r.rightClickForm.visible=!0;var e=0,a=document.getElementById(t.tId+"_a").getBoundingClientRect(),s=document.documentElement.clientHeight,i=a.top+34;if(s-i<200){e=i-200,document.querySelector(".node-bottom-menu").style.display="none";var l=document.querySelector(".node-top-menu");l.style.display="",l.style.left=a.right-92+"px",l.style.top=e+20+25+"px",l.style.position="fixed",l.style.width="110px"}else{e=i,document.querySelector(".node-top-menu").style.display="none";var o=document.querySelector(".node-bottom-menu");o.style.display="",o.style.left=a.right-92+"px",o.style.top=e-8+"px",o.style.position="fixed",o.style.width="110px"}})),i.bind("mouseout",(function(){r.rightClickForm.visible=!1}))}}},initLazyDatasetTypeTree:function(){var e=this;this.loading=!0,C({type:"dataset",moduleCode:this.appCode}).then((function(t){e.categoryData=t.map((function(e){return(0,r.Z)({isParent:e.hasChildren},e)})),e.categoryData.unshift({name:"全部",id:"",parentId:"0"}),e.ztreeObj=d().fn.zTree.init(d()("#datasetTypeTree"),e.ztreeSetting,e.categoryData),e.$emit("reCategory")})).then((function(t){e.loading=!1})).catch((function(t){e.loading=!1}))},expandNode:function(e,t,a){var s=this;a.children?a.children.forEach((function(e){s.ztreeObj.showNode(e)})):this.loading=!0},expandedNodes:function(){1===this.rightTableIsTransition?this.$emit("expandedNodes",1):this.$emit("expandedNodes",this.flatTreeData(this.ztreeObj.getNodes()).length),this.flatData=[]},filterNode:function(e){var t=e.name.includes(this.queryForm.searchKey),a=!1;return!(this.recursion(e,a)||t)},recursion:function(e,t){if(e.isParent)for(var a=0;a<e.children.length;a++){if(e.children[a].name.includes(this.queryForm.searchKey))return t=!0,t;t=this.recursion(e.children[a],t)}return t},reSearch:function(){if(this.activeName="group",this.queryForm.searchKey){var e=d().fn.zTree.getZTreeObj("datasetTypeTree"),t=e.getNodesByParam("isHidden",!0);e.showNodes(t);var a=e.getNodesByFilter(this.filterNode);e.hideNodes(a),e.expandAll(!0)}else this.initLazyDatasetTypeTree()},getNodeData:function(e,t,a,s){this.curType="-1",this.$emit("nodeClick",a,this.activeName)},getTypeData:function(e){this.curType=e,this.ztreeObj.cancelSelectedNode(),this.$emit("nodeClick",e,this.activeName)},menuClick:function(e){var t=this;e!==this.editTypeConstant.deleteOrg?(this.editFormVisible=!0,e!==this.editTypeConstant.editOrg?e!==this.editTypeConstant.addSiblingOrg?e===this.editTypeConstant.addChildOrg&&this.$nextTick((function(){t.$refs.categroyEditForm.type="dataset",t.$refs.categroyEditForm.dialogFormVisible=!0,t.$refs.categroyEditForm.init(t.rightClickForm.org,!0,e),t.$refs.categroyEditForm.radio=1,t.$refs.categroyEditForm.title="新增分组"})):this.$nextTick((function(){t.$refs.categroyEditForm.type="dataset",t.$refs.categroyEditForm.dialogFormVisible=!0,t.$refs.categroyEditForm.init(t.rightClickForm.org,!0,e),t.$refs.categroyEditForm.radio=0,t.$refs.categroyEditForm.title="新增分组"})):this.$nextTick((function(){t.$refs.categroyEditForm.type="dataset",t.$refs.categroyEditForm.dialogFormVisible=!0,t.$refs.categroyEditForm.init(t.rightClickForm.org,!1),t.$refs.categroyEditForm.title="编辑分组"}))):b(this.rightClickForm.org.id).then((function(e){0==e?t.deleteOrg(t.rightClickForm.org):t.$message.error("当前节点下存在已定义数据集，无法删除")}))},flatTreeData:function(e){var t=this;return e.forEach((function(e){t.flatData.push(e),e.children&&t.flatTreeData(e.children)})),this.flatData},deleteOrg:function(e){var t=this;this.$confirm("删除数据集分组，确定进行删除操作?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning",customClass:"bs-el-message-box"}).then((function(){e.id&&L(e.id).then((function(a){t.$message.success("操作成功");var s=t.ztreeObj.getNodeByParam("id",e.id,null);t.ztreeObj.removeNode(s),t.redrawTree(),t.$emit("refreshData",e)}))}))},refreshData:function(e){this.$emit("refreshData",e)},addOrUpdateNode:function(e,t){if(t){var a=0===e.parentId?null:this.ztreeObj.getNodeByParam("id",e.parentId,null);this.ztreeObj.addNodes(a,e)}else{var s=this.ztreeObj.getNodeByParam("id",e.id,null);s.name=e.name,this.ztreeObj.editName(s),this.ztreeObj.setEditable(!1)}this.redrawTree()},redrawTree:function(){var e=this;C({type:"dataset",moduleCode:this.appCode}).then((function(t){e.categoryData=t.map((function(e){return(0,r.Z)({isParent:e.hasChildren},e)})),e.categoryData.unshift({name:"全部",id:"",parentId:"0"})})).then((function(t){e.loading=!1})).catch((function(t){e.loading=!1}))}}},O=$,q=(0,E.Z)(O,o,n,!1,null,"5708bbf2",null),j=q.exports,V=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"inner-container",attrs:{"element-loading-text":e.saveText}},[a("el-scrollbar",{staticClass:"data-set-scrollbar"},[a("div",{staticClass:"header"},[a("el-page-header",{staticClass:"bs-el-page-header"},[a("template",{slot:"content"},[a("div",{staticClass:"page-header"},[a("div",{staticClass:"page-header-left"},[e._v(" "+e._s(e.isEdit?e.dataForm.id?"编辑JS数据集":"新增JS数据集":"JS数据集详情")+" ")]),a("div",{staticClass:"page-header-right"},[a("el-button",{staticClass:"bs-el-button-default",on:{click:function(t){return e.openNewWindow("https://www.yuque.com/chuinixiongkou/bigscreen/kv26b7ytvvbq7twi")}}},[e._v(" 帮助 ")]),e.isEdit?a("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.save("form")}}},[e._v(" 保存 ")]):e._e(),a("el-button",{staticClass:"bs-el-button-default",on:{click:e.goBack}},[e._v(" 返回 ")])],1)])])],2)],1),a("el-row",{staticStyle:{margin:"16px 16px 0"}},[a("el-col",{attrs:{span:e.isEdit?16:24}},[a("el-form",{ref:"form",staticClass:"bs-el-form",staticStyle:{padding:"16px 16px 0"},attrs:{model:e.dataForm,rules:e.rules,"label-width":"120px"}},[a("el-row",{attrs:{gutter:20}},[a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:"数据集名称",prop:"name"}},[a("el-input",{staticClass:"bs-el-input",attrs:{clearable:"",disabled:!e.isEdit},model:{value:e.dataForm.name,callback:function(t){e.$set(e.dataForm,"name",t)},expression:"dataForm.name"}})],1)],1),a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:"分组",prop:"typeId"}},[a("el-select",{ref:"selectParentName",staticClass:"bs-el-select",attrs:{"popper-class":"bs-el-select",placeholder:"请选择分组",clearable:"",disabled:!e.isEdit,filterable:"","filter-method":e.selectorFilter},on:{clear:e.clearType,"visible-change":e.setCurrentNode},model:{value:e.dataForm.typeId,callback:function(t){e.$set(e.dataForm,"typeId",t)},expression:"dataForm.typeId"}},[a("el-option",{staticStyle:{height:"auto",padding:"0"},attrs:{label:e.typeName,value:e.dataForm.typeId}},[a("div",{staticClass:"tree-box"},[a("el-tree",{ref:"categorySelectTree",staticClass:"bs-el-tree",attrs:{data:e.categoryData,"node-key":"id",indent:0,props:{label:"name",children:"children"},"default-expand-all":!0,"highlight-current":!0,"expand-on-click-node":!1,"filter-node-method":e.treeFilter},on:{"node-click":e.selectParentCategory},scopedSlots:e._u([{key:"default",fn:function(t){var s=t.data;return a("span",{staticClass:"custom-tree-node"},[a("span",[a("i",{class:s.children&&s.children.length?"el-icon el-icon-folder":"el-icon el-icon-document"}),e._v(" "+e._s(s.name)+" ")])])}}])})],1)])],1)],1)],1)],1),a("el-row",{attrs:{gutter:20}},[a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:"备注",prop:"remark"}},[a("el-input",{staticClass:"bs-el-input",attrs:{disabled:!e.isEdit},model:{value:e.dataForm.remark,callback:function(t){e.$set(e.dataForm,"remark",t)},expression:"dataForm.remark"}})],1)],1),a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:"标签",prop:"labelIds"}},[a("LabelSelect",{attrs:{"dataset-id":e.datasetId,"id-list":e.dataForm.labelIds},on:{commit:function(t){e.dataForm.labelIds=t}}})],1)],1)],1)],1),e.isEdit?a("div",{staticClass:"sql-config"},[a("div",[a("codemirror",{ref:"targetInSql",staticStyle:{"margin-top":"2px"},attrs:{options:e.codemirrorOption},model:{value:e.dataForm.config.script,callback:function(t){e.$set(e.dataForm.config,"script",t)},expression:"dataForm.config.script"}})],1),a("div",{staticClass:"bs-codemirror-bottom-text"},[a("strong",[e._v("请使用 return 将运行结果返回出来，结果数据需要为数组格式")]),a("br"),a("strong",[e._v("动态参数使用： 使用${}将参数包裹，例如：let name = "),a("span",{staticStyle:{color:"red"}},[e._v("${name}。")])])]),a("div",{staticStyle:{"text-align":"center",padding:"16px 0"}},[a("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.scriptExecute()}}},[e._v(" 解析并运行 ")])],1)]):e._e()],1),e.isEdit?a("el-col",{attrs:{span:8}},[a("div",{staticClass:"right-setting"},[a("div",{staticClass:"paramConfig"},[a("div",{staticClass:"title-style bs-title-style"},[e._v(" 动态参数 "),a("el-button",{staticStyle:{float:"right",border:"none","margin-top":"-4px"},attrs:{type:"text"},on:{click:function(t){return e.$refs.paramsSettingDialog.open()}}},[e._v(" 配置 ")])],1),a("div",{staticClass:"field-wrap bs-field-wrap bs-scrollbar"},e._l(e.dataForm.config.paramsList,(function(t){return a("div",{key:t.name,staticClass:"field-item",on:{click:function(t){return e.$refs.paramsSettingDialog.open()}}},[a("span",[e._v(e._s(t.name))]),e._v(" "),a("span",{directives:[{name:"show",rawName:"v-show",value:t.remark,expression:"param.remark"}],staticStyle:{color:"#909399"}},[e._v(" ("+e._s(t.remark)+") ")]),a("el-button",{staticClass:"edit_field",staticStyle:{float:"right",border:"none","margin-top":"2px"},attrs:{type:"text"},on:{click:function(t){return e.$refs.paramsSettingDialog.open()}}},[e._v(" 配置 ")])],1)})),0)]),a("div",{staticClass:"structure"},[a("div",{staticClass:"title-style bs-title-style"},[e._v(" 输出字段 "),a("el-button",{staticStyle:{float:"right",border:"none","margin-top":"-4px"},attrs:{type:"text"},on:{click:function(t){return e.$refs.outputFieldDialog.open()}}},[e._v(" 配置 ")])],1),a("div",{staticClass:"field-wrap bs-field-wrap bs-scrollbar"},e._l(e.outputFieldList,(function(t,s){return a("div",{key:s,staticClass:"field-item",on:{click:function(t){return e.$refs.outputFieldDialog.open()}}},[a("span",[e._v(e._s(t.fieldName))]),e._v(" "),a("span",{directives:[{name:"show",rawName:"v-show",value:t.fieldDesc,expression:"field.fieldDesc"}],staticStyle:{color:"#909399"}},[e._v(" ("+e._s(t.fieldDesc)+")")]),a("el-button",{staticClass:"edit_field",staticStyle:{float:"right",border:"none","margin-top":"2px"},attrs:{type:"text"},on:{click:function(t){return e.$refs.outputFieldDialog.open()}}},[e._v(" 配置 ")])],1)})),0)])])]):e._e()],1),e.isEdit?a("div",{staticClass:"dataPreView",staticStyle:{"margin-top":"12px"}},[a("div",{staticClass:"result-view"},[e._v(" 数据预览 ")]),a("div",{directives:[{name:"loading",rawName:"v-loading",value:e.tableLoading,expression:"tableLoading"}],staticClass:"bs-table-box is-Edit bs-scrollbar"},[a("el-table",{staticClass:"bs-el-table bs-scrollbar",attrs:{align:"center",data:e.dataPreviewList,"max-height":"400",border:!0}},e._l(e.dataPreviewList[0],(function(t,s){return a("el-table-column",{key:s,attrs:{label:s,align:"center","show-overflow-tooltip":"","render-header":e.renderHeader},scopedSlots:e._u([{key:"default",fn:function(t){return[a("span",[e._v(e._s(t.row[s]))])]}}],null,!0)})})),1)],1)]):e._e(),e.isEdit?e._e():a("div",{staticClass:"dataPreView"},[a("el-tabs",{model:{value:e.activeName,callback:function(t){e.activeName=t},expression:"activeName"}},[a("el-tab-pane",{directives:[{name:"loading",rawName:"v-loading",value:e.tableLoading,expression:"tableLoading"}],attrs:{label:"数据预览",name:"data"}},[a("div",{staticClass:"bs-table-box"},[a("el-table",{staticClass:"bs-el-table",attrs:{align:"center",data:e.dataPreviewList,"max-height":"400"}},e._l(e.dataPreviewList[0],(function(t,s){return a("el-table-column",{key:s,attrs:{label:s,align:"center","show-overflow-tooltip":"","render-header":e.renderHeader},scopedSlots:e._u([{key:"default",fn:function(t){return[a("span",[e._v(e._s(t.row[s]))])]}}],null,!0)})})),1)],1)]),a("el-tab-pane",{directives:[{name:"loading",rawName:"v-loading",value:e.tableLoading,expression:"tableLoading"}],attrs:{label:"数据集结构",name:"structure"}},[a("div",{staticClass:"bs-table-box"},[a("el-table",{attrs:{"max-height":"400",data:e.outputFieldList,border:!0,align:"center"}},[a("el-table-column",{attrs:{align:"center","show-overflow-tooltip":"",prop:"fieldName",label:"字段值"}}),a("el-table-column",{attrs:{align:"center",prop:"fieldDesc",label:"字段描述"},scopedSlots:e._u([{key:"default",fn:function(t){return[e.isEdit?a("el-input",{staticClass:"labeldsc bs-el-input",attrs:{size:"small"},model:{value:t.row.fieldDesc,callback:function(a){e.$set(t.row,"fieldDesc",a)},expression:"scope.row.fieldDesc"}}):a("span",[e._v(e._s(t.row.fieldDesc))])]}}],null,!1,967602169)})],1)],1)])],1)],1),a("ParamsSettingDialog",{ref:"paramsSettingDialog",attrs:{"params-list":e.dataForm.config.paramsList},on:{saveParams:e.saveParams}}),a("OutputFieldDialog",{ref:"outputFieldDialog",attrs:{"output-field-list":e.outputFieldList},on:{setFieldList:function(t){e.outputFieldList=t}},scopedSlots:e._u([{key:"output-field-table-column",fn:function(){return[e._t("output-field-table-column")]},proxy:!0}],null,!0)})],1),a("FieldFillDialog",{ref:"fieldFillDialog",on:{fieldDescFill:e.fieldDescFill,fieldDescEdit:e.fieldDescEdit,toSave:e.toSave}})],1)},M=[],A=a(50124),B=a(48534),R=(a(98742),a(57267),a(22462),a(69358),function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[e._l(e.selectLabelListInitial,(function(t){return a("el-tag",{key:t.id,staticStyle:{"margin-right":"2px","margin-left":"2px","background-color":"#2f3440","border-color":"#313640"},attrs:{closable:e.isEdit,"disable-transitions":!1},on:{close:function(a){return e.handleCloseTag(t)}}},[e._v(" "+e._s(t.labelName)+" ")])})),a("el-tooltip",{staticClass:"item",attrs:{content:"添加关联标签",effect:"dark",placement:"bottom"}},[a("el-button",{staticClass:"bs-el-button-default",staticStyle:{"margin-left":"10px"},attrs:{circle:"",icon:"el-icon-plus"},on:{click:e.addLabelRelation}})],1),a("el-button",{attrs:{type:"text"},on:{click:e.manageLabel}},[e._v(" 管理 ")]),a("el-dialog",{staticClass:"bs-dialog-wrap bs-el-dialog",attrs:{"append-to-body":!0,"before-close":e.handleClose,visible:e.dialogFormVisible,title:e.isManage?"标签管理":"选择标签",width:"1000px"},on:{"update:visible":function(t){e.dialogFormVisible=t}}},[a("div",[a("el-form",{staticClass:"bs-el-form filter-container",attrs:{inline:!0}},[a("el-form-item",{attrs:{label:""}},[a("el-input",{staticClass:"bs-el-input",attrs:{clearable:"",placeholder:"请输入标签名称"},on:{clear:e.getDataList},model:{value:e.searchForm.labelName,callback:function(t){e.$set(e.searchForm,"labelName",t)},expression:"searchForm.labelName"}})],1),a("el-form-item",{staticClass:"filter-item",attrs:{prop:"labelType"}},[a("el-select",{staticClass:"bs-el-select",attrs:{"popper-class":"bs-el-select",clearable:"",filterable:"",placeholder:"请选择标签类型"},on:{change:e.selectLabelType},model:{value:e.searchForm.labelType,callback:function(t){e.$set(e.searchForm,"labelType",t)},expression:"searchForm.labelType"}},[a("el-option",{key:"all",attrs:{label:"全部",value:""}}),e._l(e.labelTypeList,(function(t,s){return a("el-option",{key:s,attrs:{label:t,value:t}},[a("span",[e._v(" "+e._s(t)+" ")]),a("span",{staticStyle:{float:"right","padding-right":"20px"}},[a("el-button",{directives:[{name:"show",rawName:"v-show",value:e.isManage,expression:"isManage"}],attrs:{icon:"el-icon-edit",type:"text"},on:{click:function(a){return a.stopPropagation(),e.editLabelType(t)}}}),e.isManage?a("el-button",{attrs:{icon:"el-icon-delete",type:"text"},on:{click:function(a){return a.stopPropagation(),e.deleteLabelType(t)}}}):e._e()],1)])}))],2)],1),a("el-form-item",[a("el-button",{attrs:{type:"primary"},on:{click:function(t){e.current=1,e.getDataList()}}},[e._v(" 查询 ")])],1),a("el-form-item",[a("el-button",{directives:[{name:"show",rawName:"v-show",value:e.isManage,expression:"isManage"}],staticClass:"bs-el-button-default",attrs:{type:"primary"},on:{click:e.insertLabel}},[e._v(" 新增 ")])],1)],1),a("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.labelCheckLoading,expression:"labelCheckLoading"}],ref:"labelTable",staticClass:"bs-el-table bs-scrollbar",attrs:{"element-loading-text":"正在加载中...",data:e.labelList,"row-key":"id",height:"calc(100vh - 450px)"},on:{select:e.labelCheckChange,"select-all":e.selectAll}},[a("el-empty",{attrs:{slot:"empty"},slot:"empty"}),e.isManage?e._e():a("el-table-column",{key:"selection",attrs:{type:"selection",width:"55"}}),a("el-table-column",{key:"labelName",attrs:{label:"标签名称",prop:"labelName","show-overflow-tooltip":""}}),a("el-table-column",{key:"labelType",attrs:{label:"标签类型",prop:"labelType","show-overflow-tooltip":""}}),a("el-table-column",{key:"labelDesc",attrs:{label:"标签说明",prop:"labelDesc","show-overflow-tooltip":""}}),e.isManage?a("el-table-column",{key:"opt",attrs:{align:"center",label:"操作",width:"200"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-button",{staticClass:"bs-el-button-default",on:{click:function(a){return e.editLabel(t.row)}}},[e._v(" 编辑 ")]),a("el-button",{staticClass:"bs-el-button-default",on:{click:function(a){return e.deleteLabel(t.row.id)}}},[e._v(" 删除 ")])]}}],null,!1,3653826865)}):e._e()],1),a("div",{staticClass:"bs-pagination"},[a("el-pagination",{staticClass:"bs-el-pagination",attrs:{"popper-class":"bs-el-pagination","current-page":e.current,"page-size":e.sizeLabel,"page-sizes":[10,20,50,100],total:e.totalCount,background:"",layout:"total, prev, pager, next,sizes,jumper"},on:{"size-change":e.sizeChangeHandle,"current-change":e.currentChangeHandle}})],1)],1),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{directives:[{name:"show",rawName:"v-show",value:!e.isManage,expression:"!isManage"}],staticClass:"bs-el-button-default",on:{click:e.handleClose}},[e._v(" 取消 ")]),a("el-button",{directives:[{name:"show",rawName:"v-show",value:!e.isManage,expression:"!isManage"}],attrs:{type:"primary"},on:{click:e.commitLabel}},[e._v(" 确定 ")]),a("el-button",{directives:[{name:"show",rawName:"v-show",value:e.isManage,expression:"isManage"}],staticClass:"bs-el-button-default",on:{click:e.handleClose}},[e._v(" 返回 ")])],1)]),e.editFormVisible?a("label-edit",{ref:"labelEdit",on:{afterEdit:e.afterEdit}}):e._e(),e.labelTypeEditVisible?a("label-type-edit",{ref:"labelTypeEdit",on:{afterEdit:function(t){return e.afterEdit(!0)}}}):e._e()],2)}),z=[],Z=a(50361),U=a.n(Z),W=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("el-dialog",{staticClass:"bs-dialog-wrap bs-el-dialog",attrs:{"append-to-body":!0,"before-close":e.cancel,title:""!==e.dataForm.id?"编辑标签":"新增标签",visible:e.formVisible},on:{"update:visible":function(t){e.formVisible=t}}},[a("el-form",{ref:"ruleForm",staticClass:"form-container bs-el-form",attrs:{model:e.dataForm,rules:e.rules,"label-position":"right","label-width":"90px"}},[a("el-form-item",{attrs:{label:"标签名称",prop:"labelName"}},[a("el-input",{staticClass:"bs-el-input",attrs:{clearable:"",placeholder:"请输入标签名称",maxlength:"200"},model:{value:e.dataForm.labelName,callback:function(t){e.$set(e.dataForm,"labelName",t)},expression:"dataForm.labelName"}})],1),a("el-form-item",{attrs:{label:"标签类型",prop:"labelType"}},[a("el-select",{ref:"searchSelect",staticClass:"bs-el-select",attrs:{"popper-class":"bs-el-select","allow-create":"",clearable:"",filterable:"",placeholder:"请选择或输入标签类型"},on:{blur:e.selectBlur},nativeOn:{input:function(t){return e.filterData(t)}},model:{value:e.dataForm.labelType,callback:function(t){e.$set(e.dataForm,"labelType",t)},expression:"dataForm.labelType"}},e._l(e.labelTypeList,(function(e,t){return a("el-option",{key:t,attrs:{label:e,value:e}})})),1)],1),a("el-form-item",{attrs:{label:"标签说明",prop:"labelDesc"}},[a("el-input",{staticClass:"bs-el-input",attrs:{clearable:"",placeholder:"请输入标签说明",type:"text"},model:{value:e.dataForm.labelDesc,callback:function(t){e.$set(e.dataForm,"labelDesc",t)},expression:"dataForm.labelDesc"}})],1)],1),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{staticClass:"bs-el-button-default",on:{click:e.cancel}},[e._v(" 取消 ")]),a("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.submitForm("ruleForm")}}},[e._v(" 确定 ")])],1)],1)},K=[],H=function(){return p().prototype.$dataRoomAxios.get("/label/getLabelList")},J=function(e){return p().prototype.$dataRoomAxios.get("/label/list",e)},X=function(){return p().prototype.$dataRoomAxios.get("/label/getLabelType")},G=function(e){return p().prototype.$dataRoomAxios.post("/label/removeLabelByType",e)},Q=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"-1";return p().prototype.$dataRoomAxios.get("/label/removeLabel/".concat(e))},Y=function(e){return p().prototype.$dataRoomAxios.post("/label/checkRepeat",e)},ee=function(e){return p().prototype.$dataRoomAxios.post("/label/addOrUpdateLabel",e)},te=function(e){return p().prototype.$dataRoomAxios.post("/label/updateLabelType",e)},ae=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"-1";return p().prototype.$dataRoomAxios.get("/label/queryDataSetLabelList/".concat(e))},se={name:"LabelEdit",data:function(){return{loading:!1,datasetList:[],typeId:"",dataForm:{id:"",labelName:"",labelType:"",labelDesc:"",relList:[]},formVisible:!0,rules:{labelName:[{required:!0,message:"标签名称不能为空",trigger:"blur"},{validator:this.validateLabelName,trigger:"blur"}],labelType:[{required:!0,message:"标签类型不能为空",trigger:"change"}]},categoryData:[],relVisible:!1,labelTypeList:[],datasetIdList:[]}},watch:{"dataForm.labelType":function(e){e.length>20&&(this.dataForm.labelType=e.substring(0,20))}},methods:{init:function(e){var t=this;this.$nextTick((function(){t.$refs.ruleForm.clearValidate()})),this.dataForm.id=e?e.id:"",this.formVisible=!0,e?(this.dataForm.id=e.id,this.dataForm.labelName=e.labelName,this.dataForm.labelType=e.labelType,this.dataForm.labelDesc=e.labelDesc):(this.dataForm.id="",this.dataForm.labelName="",this.dataForm.labelType="",this.dataForm.labelDesc="")},validateLabelName:function(e,t,a){Y({id:this.dataForm.id,labelName:this.dataForm.labelName}).then((function(e){e?a(new Error("标签名称已存在")):a()}))},handleClose:function(){this.$parent.editFormVisible=!1},cancel:function(){var e=this;this.formVisible=!1,this.$nextTick((function(){e.handleClose()}))},submitForm:function(e){var t=this;this.$refs[e].validate((function(e){if(!e)return!1;t.saveForm(!0)}))},saveForm:function(e){var t=this;ee(this.dataForm).then((function(e){t.$message.success("保存成功"),t.cancel(),t.$emit("afterEdit")}))},selectBlur:function(e){this.dataForm.labelType=e.target.value},filterData:function(){var e=this.$refs.searchSelect.$data.selectedLabel;e.length>20&&(this.$refs.searchSelect.$data.selectedLabel=e.substr(0,20))}}},ie=se,re=(0,E.Z)(ie,W,K,!1,null,"55455aa6",null),le=re.exports,oe=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("el-dialog",{staticClass:"bs-dialog-wrap bs-el-dialog",attrs:{"append-to-body":!0,"before-close":e.handleClose,visible:e.dialogFormVisible,title:"标签类型修改",width:"500px"},on:{"update:visible":function(t){e.dialogFormVisible=t}}},[a("div",{staticStyle:{margin:"20px"}},[a("el-form",{ref:"ruleForm",staticClass:"bs-el-form",attrs:{model:e.dataForm,rules:e.rules,"label-position":"left","label-width":"90px"}},[a("el-form-item",{attrs:{label:"标签类型",prop:"labelType"}},[a("el-input",{staticClass:"bs-el-input",model:{value:e.dataForm.labelType,callback:function(t){e.$set(e.dataForm,"labelType",t)},expression:"dataForm.labelType"}})],1)],1)],1),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{staticClass:"bs-el-button-default",on:{click:e.cancel}},[e._v("取消")]),a("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.submitForm("ruleForm")}}},[e._v("确定")])],1)])},ne=[],ce={name:"LabelTypeEdit",data:function(){return{dialogFormVisible:!1,dataForm:{labelType:"",oldLabelType:""},rules:{labelType:[{required:!0,message:"标签类型不能为空",trigger:"blur"}]}}},methods:{init:function(e){this.dataForm.labelType=e,this.dataForm.oldLabelType=e},handleClose:function(){this.$parent.labelTypeEditVisible=!1},cancel:function(){var e=this;this.dialogFormVisible=!1,this.$nextTick((function(){e.handleClose()}))},submitForm:function(e){var t=this;this.$refs[e].validate((function(e){if(!e)return!1;te(t.dataForm).then((function(){t.$emit("afterEdit"),t.cancel(),t.$message.success("保存成功")}))}))}}},de=ce,ue=(0,E.Z)(de,oe,ne,!1,null,null,null),pe=ue.exports,me=a(5661),fe={name:"LabelSelect",components:{LabelEdit:le,LabelTypeEdit:pe},mixins:[me.a],props:{idList:{type:Array,default:function(){return[]}},isEdit:{type:Boolean,default:!0},datasetId:{type:String,default:""}},data:function(){return{isManage:!1,idListCopy:this.idList,selectLabelList:[],selectLabelListInitial:[],labelList:[],dialogFormVisible:!1,editFormVisible:!1,labelTypeEditVisible:!1,searchForm:{labelName:"",labelType:""},sizeLabel:10,labelTypeList:[],labelCheckLoading:!1}},mounted:function(){var e=this;this.datasetId&&ae(this.datasetId).then((function(t){e.selectLabelListInitial=U()(t),e.selectLabelList=U()(t);var a=[];t.forEach((function(e){a.push(e.id)})),e.$emit("commit",a)}))},watch:{labelList:{handler:function(e){var t=this;e.forEach((function(e){t.selectLabelList.forEach((function(a){e.id===a.id&&t.$nextTick((function(){t.$refs.labelTable.toggleRowSelection(e)}))}))}))},deep:!0},selectLabelList:{handler:function(e){var t=this;this.idListCopy=[],e.forEach((function(e){t.idListCopy.push(e.id)}))},deep:!0}},methods:{init:function(e){var t=this;this.isManage=e,this.$nextTick((function(){t.dialogFormVisible=!0,t.getDataList(),t.getLabelType()}))},getLabelType:function(){var e=this;X().then((function(t){e.labelTypeList=t}))},getDataList:function(){var e=this;this.labelCheckLoading=!0;var t={current:this.current,size:this.sizeLabel,labelName:this.searchForm.labelName,labelType:this.searchForm.labelType};J(t).then((function(t){e.totalCount=t.totalCount,e.labelList=t.list,e.labelCheckLoading=!1})).catch((function(){e.labelCheckLoading=!1}))},selectAll:function(e){var t=this;e.forEach((function(e){t.selectLabelList.some((function(t){return t.id===e.id}))||t.selectLabelList.push(e)}))},insertLabel:function(){var e=this;this.editFormVisible=!0,this.$nextTick((function(){e.$refs.labelEdit.labelTypeList=e.labelTypeList,e.$refs.labelEdit.init()}))},editLabel:function(e){var t=this;this.editFormVisible=!0,this.$nextTick((function(){t.$refs.labelEdit.labelTypeList=t.labelTypeList,t.$refs.labelEdit.init(e)}))},deleteLabel:function(e){var t=this;this.$confirm("确定删除当前标签吗?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning",customClass:"bs-el-message-box"}).then((function(){Q(e).then((function(){t.getDataList(),t.$message.success("删除成功"),t.selectLabelList.some((function(t){return t.id===e}))&&(t.selectLabelList=t.selectLabelList.filter((function(t){return t.id!==e}))),t.selectLabelListInitial=U()(t.selectLabelList)}))})).catch((function(){}))},labelCheckChange:function(e,t){this.selectLabelList.some((function(e){return e.id===t.id}))?this.selectLabelList=this.selectLabelList.filter((function(e){return e.id!==t.id})):this.selectLabelList.push(t)},handleCloseTag:function(e){var t=this;this.idListCopy=[],this.selectLabelListInitial.forEach((function(a,s){a.id===e.id&&t.selectLabelListInitial.splice(s,1)})),this.selectLabelList.forEach((function(a,s){a.id===e.id&&t.selectLabelList.splice(s,1)})),this.selectLabelList.forEach((function(e){t.idListCopy.push(e.id)})),this.$emit("commit",this.idListCopy)},addLabelRelation:function(){this.init(!1)},manageLabel:function(){this.init(!0)},selectLabelType:function(){this.getDataList()},editLabelType:function(e){var t=this;this.labelTypeEditVisible=!0,this.$nextTick((function(){t.$refs.labelTypeEdit.dialogFormVisible=!0,t.$refs.labelTypeEdit.init(e)}))},deleteLabelType:function(e){var t=this;this.$confirm("是否删除当前标签类型? ","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning",customClass:"bs-el-message-box"}).then((function(){G({labelType:e}).then((function(){t.$nextTick((function(){t.getDataList(),t.getLabelType(),t.$message.success("删除成功")}))}))}))},handleClose:function(){this.selectLabelList=U()(this.selectLabelListInitial),this.dialogFormVisible=!1},commitLabel:function(){this.labelCheckLoading=!1,this.dialogFormVisible=!1,this.selectLabelListInitial=U()(this.selectLabelList),this.$emit("commit",this.idListCopy)},afterEdit:function(e){e&&(this.searchForm.labelType=""),this.getDataList(),this.getLabelType()}}},be=fe,he=(0,E.Z)(be,R,z,!1,null,"060994fb",null),ge=he.exports,ve=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("el-dialog",{staticClass:"bs-dialog-wrap bs-el-dialog",attrs:{title:"参数配置",visible:e.dialogVisible,width:"1000px","append-to-body":"","close-on-click-modal":!1,"before-close":e.handleClose},on:{"update:visible":function(t){e.dialogVisible=t}}},[a("div",{staticClass:"bs-table-box"},[a("el-table",{ref:"singleTable",staticClass:"bs-el-table",attrs:{data:e.innerParamsList,border:!0,align:"center"}},[a("el-empty",{attrs:{slot:"empty"},slot:"empty"}),a("el-table-column",{attrs:{prop:"name",label:"参数名称",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-input",{staticClass:"bs-el-input",attrs:{placeholder:"请输入名称",clearable:""},on:{change:function(a){return e.checkParamsName(t.row)}},model:{value:t.row.name,callback:function(a){e.$set(t.row,"name",a)},expression:"scope.row.name"}})]}}])}),a("el-table-column",{attrs:{prop:"require",label:"是否必填",align:"center",width:"200",filterable:""},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-radio-group",{model:{value:t.row.require,callback:function(a){e.$set(t.row,"require",a)},expression:"scope.row.require"}},[a("el-radio",{attrs:{label:1}},[e._v(" 是 ")]),a("el-radio",{attrs:{label:0}},[e._v(" 否 ")])],1)]}}])}),a("el-table-column",{attrs:{prop:"value",label:"参数值",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return["Date"===t.row.type?a("el-date-picker",{attrs:{type:"datetime","value-format":"yyyy-MM-dd HH:mm:ss",placeholder:"选择日期时间"},model:{value:t.row.value,callback:function(a){e.$set(t.row,"value",a)},expression:"scope.row.value"}}):a("el-input",{staticClass:"bs-el-input",attrs:{clearable:"",placeholder:"请输入值"},model:{value:t.row.value,callback:function(a){e.$set(t.row,"value",a)},expression:"scope.row.value"}})]}}])}),a("el-table-column",{attrs:{prop:"remark",label:"备注",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-input",{staticClass:"bs-el-input",attrs:{clearable:"",placeholder:"请输入备注",rows:"2",maxlength:"200"},model:{value:t.row.remark,callback:function(a){e.$set(t.row,"remark",a)},expression:"scope.row.remark"}})]}}])}),a("el-table-column",{attrs:{label:"操作",width:"105",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-button",{staticClass:"no-border",staticStyle:{color:"#e47470"},attrs:{type:"text"},on:{click:function(a){return e.delRow(t.$index)}}},[e._v(" 删除 ")])]}}])},[a("template",{slot:"header"},[a("el-button",{staticClass:"no-border",attrs:{icon:"el-icon-plus",type:"text"},on:{click:e.addParam}},[e._v(" 添加 ")])],1)],2)],1)],1),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{staticClass:"bs-el-button-default",on:{click:e.cancel}},[e._v(" 取消 ")]),a("el-button",{attrs:{type:"primary"},on:{click:e.confirm}},[e._v(" 确定 ")])],1)])],1)},_e=[],ye={name:"ParamsSettingDialog",props:{paramsList:{type:Array,default:function(){return[]}}},computed:{innerParamsList:function(){return U()(this.paramsList)}},data:function(){return{dialogVisible:!1}},methods:{open:function(){this.dialogVisible=!0},close:function(){this.dialogVisible=!1},handleClose:function(){this.dialogVisible=!1},addParam:function(){this.innerParamsList.push({name:"",type:"",value:"",status:1,require:0,remark:""})},delRow:function(e){this.innerParamsList.splice(e,1)},checkParamsName:function(e){var t=this.innerParamsList.filter((function(t){return t.fieldName===e.name}));t.length&&(this.$message.warning("参数名称不可以与字段名相同！"),e.name="")},cancel:function(){this.dialogVisible=!1},confirm:function(){this.$emit("saveParams",this.innerParamsList),this.dialogVisible=!1}}},we=ye,Ce=(0,E.Z)(we,ve,_e,!1,null,"f688b9ee",null),Fe=Ce.exports,xe=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("el-dialog",{staticClass:"bs-dialog-wrap bs-el-dialog",attrs:{title:"输出字段配置",visible:e.dialogVisible,width:"1000px","append-to-body":"","close-on-click-modal":!1,"before-close":e.handleClose},on:{"update:visible":function(t){e.dialogVisible=t}}},[a("div",{staticClass:"bs-table-box"},[a("el-table",{staticClass:"bs-el-table",attrs:{data:e.insideFieldList,border:!0,align:"center"}},[a("el-empty",{attrs:{slot:"empty"},slot:"empty"}),a("el-table-column",{attrs:{align:"left","show-overflow-tooltip":"",prop:"fieldName",label:"字段值"}}),a("el-table-column",{attrs:{align:"center",prop:"fieldDesc",label:"字段描述"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-input",{staticClass:"labeldsc bs-el-input",attrs:{size:"small"},model:{value:t.row.fieldDesc,callback:function(a){e.$set(t.row,"fieldDesc",a)},expression:"scope.row.fieldDesc"}})]}}])}),e._t("output-field-table-column")],2)],1),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{staticClass:"bs-el-button-default",on:{click:e.cancelField}},[e._v(" 取消 ")]),a("el-button",{attrs:{type:"primary"},on:{click:e.setField}},[e._v(" 确定 ")])],1)])],1)},Le=[],ke={name:"OutputFieldDialog",props:{outputFieldList:{type:Array,default:function(){return[]}}},data:function(){return{dialogVisible:!1,structurePreviewListCopy:[],insideFieldList:[]}},methods:{open:function(){this.insideFieldList=U()(this.outputFieldList),this.dialogVisible=!0},close:function(){this.dialogVisible=!1},handleClose:function(){this.dialogVisible=!1},cancelField:function(){this.dialogVisible=!1},setField:function(){var e=this;this.insideFieldList.length?(this.fieldDesc={},this.insideFieldList.forEach((function(t){e.fieldDesc[t.fieldName]=t.fieldDesc})),this.$emit("setFieldList",this.insideFieldList)):this.fieldDesc=null,this.dialogVisible=!1}}},De=ke,Te=(0,E.Z)(De,xe,Le,!1,null,"44a2f126",null),Se=Te.exports,Pe=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("el-dialog",{staticClass:"bs-dialog-wrap bs-el-dialog",attrs:{title:"提示",visible:e.dialogVisible,width:"420px","append-to-body":"","close-on-click-modal":!1},on:{"update:visible":function(t){e.dialogVisible=t}}},[a("p",{staticStyle:{color:"var(--bs-el-text)","line-height":"24px","padding-left":"10px",display:"flex"}},[a("i",{staticClass:"el-icon-warning",staticStyle:{color:"#E6A23C","font-size":"24px","margin-right":"5px"}}),e._v(" 存在字段描述信息为空，请确认 ")]),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{staticClass:"bs-el-button-default",on:{click:e.fieldDescFill}},[e._v(" 使用字段名填充 ")]),a("el-button",{staticClass:"bs-el-button-default",on:{click:e.fieldDescEdit}},[e._v(" 进入编辑 ")]),a("el-button",{attrs:{type:"primary"},on:{click:e.toSave}},[e._v(" 继续保存 ")])],1)])],1)},Ee=[],Ne={name:"FieldFillDialog",data:function(){return{dialogVisible:!1}},methods:{open:function(){this.dialogVisible=!0},close:function(){this.dialogVisible=!1},fieldDescFill:function(){this.$emit("fieldDescFill")},fieldDescEdit:function(){this.$emit("fieldDescEdit")},toSave:function(){this.$emit("toSave")}}},Ie=Ne,$e=(0,E.Z)(Ie,Pe,Ee,!1,null,"4ead2288",null),Oe=$e.exports,qe=a(75055),je=(a(96876),{name:"JsEditForm",components:{codemirror:qe.codemirror,FieldFillDialog:Oe,ParamsSettingDialog:Fe,OutputFieldDialog:Se,LabelSelect:ge},props:{config:{type:Object,default:function(){}},isEdit:{type:Boolean,default:!1},datasetId:{type:String,default:null},typeId:{type:String,default:""},appCode:{type:String,default:""}},data:function(){var e=this,t=function(t,a,s){h({id:e.datasetId,name:a,moduleCode:e.appCode}).then((function(e){e?s(new Error("数据集名称已存在")):s()}))};return{autoFill:!0,dataForm:{id:"",name:"",typeId:"",remark:"",labelIds:[],config:{script:"",paramsList:[]}},rules:{name:[{required:!0,message:"请输入数据集名称",trigger:"blur"},{validator:t,trigger:"blur"}],typeId:[{required:!0,message:"请选择分组",trigger:"blur"}]},codemirrorOption:{mode:"text/javascript",lineNumbers:!0,lineWrapping:!0,theme:"nord",extraKey:{Ctrl:"autocomplete"},hintOptions:{completeSingle:!0}},activeName:"data",dataPreviewList:[],outputFieldList:[],structurePreviewListCopy:[],typeName:"",categoryData:[],fieldsetVisible:!1,paramsVisible:!1,tableLoading:!1,saveloading:!1,saveText:"",isSet:!1,passTest:!1,fieldDesc:null}},watch:{"dataForm.config.script":function(e){e||(this.passTest=!1)}},mounted:function(){this.init()},methods:{init:function(){var e=this;return(0,B.Z)((0,A.Z)().mark((function t(){return(0,A.Z)().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,C({tableName:"dataset",moduleCode:e.appCode});case 2:e.categoryData=t.sent,e.typeId&&(e.dataForm.typeId=e.typeId,e.$nextTick((function(){try{e.typeName=e.$refs.categorySelectTree.getNode(e.dataForm.typeId).data.name}catch(t){console.error(t)}}))),e.datasetId&&w(e.datasetId).then((function(t){var a=t.id,s=t.name,i=t.typeId,r=t.remark,l=t.datasetType,o=t.moduleCode,n=t.editable,c=t.sourceId,d=t.config,u=d.script,p=d.paramsList,m=d.fieldDesc,f=d.fieldList;e.dataForm={id:a,name:s,typeId:i,remark:r,datasetType:l,moduleCode:o,editable:n,sourceId:c,config:{script:u,paramsList:p},labelIds:e.dataForm.labelIds},e.fieldDesc=m,e.outputFieldList=f,e.scriptExecute(!0)}));case 5:case"end":return t.stop()}}),t)})))()},save:function(e){var t=this,a=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!1!==this.passTest)if(this.outputFieldList.length){if(!a){var s=this.outputFieldList.some((function(e){return""===e.fieldDesc||!e.hasOwnProperty("fieldDesc")}));if(s)return void this.$refs.fieldFillDialog.open()}this.$refs[e].validate((function(e){if(e){t.saveloading=!0,t.saveText="正在保存...";var a=t.datasetId,s=t.dataForm,i=t.appCode,r=t.fieldDesc,l=t.outputFieldList,o={id:a,name:s.name,typeId:s.typeId,remark:s.remark,datasetType:"js",moduleCode:i,editable:i?1:0,labelIds:s.labelIds,config:{className:"com.gccloud.dataset.entity.config.JsDataSetConfig",script:s.config.script,fieldDesc:r,paramsList:s.config.paramsList,fieldList:l}},n=""===t.dataForm.id?g:v;n(o).then((function(){t.$message.success("操作成功"),t.$parent.init(!1),t.$parent.setType=null,t.saveloading=!1,t.saveText="",t.goBack()})).catch((function(){t.saveloading=!1,t.saveText=""}))}}))}else this.$message.warning("该执行脚本未生成输出字段，请重新检查");else this.$message.error("请确保脚本不为空且执行通过")},saveParams:function(e){this.dataForm.config.paramsList=e},setField:function(){},fieldDescFill:function(){var e=this;this.fieldDesc={},this.outputFieldList.forEach((function(t){""!==t.fieldDesc&&t.hasOwnProperty("fieldDesc")?e.fieldDesc[t.fieldName]=t.fieldDesc:(t.fieldDesc=t.fieldName,e.fieldDesc[t.fieldName]=t.fieldName)})),this.save("form"),this.$refs.fieldFillDialog.close()},fieldDescEdit:function(){this.$refs.fieldFillDialog.close(),this.fieldsetVisible=!0},toSave:function(){var e=this;this.fieldDesc={},this.outputFieldList.forEach((function(t){e.fieldDesc[t.fieldName]=t.fieldDesc})),this.save("form",!0),this.$refs.fieldFillDialog.close()},buildFieldDesc:function(){var e=this,t={};this.outputFieldList.forEach((function(a){e.fieldDesc.hasOwnProperty(a.fieldName)&&(a.fieldDesc=e.fieldDesc[a.fieldName]),t[a.fieldName]=a.fieldDesc})),this.fieldDesc=t},scriptExecute:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this.dataForm.config.script){var a=this.dataForm.config.script,s=null;try{var i=a.replace(/\${(.*?)}/g,(function(t,a){var s=e.dataForm.config.paramsList.find((function(e){return e.name===a})).value;return null===s||void 0===s||""===s?"''":isNaN(s)?"'".concat(s,"'"):s}));s=new Function(i)}catch(u){this.passTest=!1;var r=a.match(/\${(.*?)}/g),l=[];return void(r?(r.forEach((function(t){var a=t.replace(/\${(.*?)}/g,"$1"),s=e.dataForm.config.paramsList.find((function(e){return e.name===a}));s||l.push(a)})),this.autoFill&&l.length>0&&(this.addParams(l),l=[])):(console.info(u),this.$message.error("脚本执行错误，请检查脚本，具体错误：".concat(u))))}var o=s();if(!Array.isArray(o))return this.passTest=!1,void this.$message.error("脚本执行结果不是数组，请检查脚本");var n=[];if(o.forEach((function(e){Object.keys(e).forEach((function(e){n.includes(e)||n.push(e)}))})),0===this.outputFieldList.length&&(this.outputFieldList=n.map((function(e){return{fieldName:e,fieldDesc:""}}))),this.outputFieldList.length!==n.length){var c=[];n.forEach((function(t){var a=e.outputFieldList.find((function(e){return e.fieldName===t}));a?c.push(a):c.push({fieldName:t,fieldDesc:""})})),this.outputFieldList=c}if(this.outputFieldList.length===n.length){var d=[];n.forEach((function(t){var a=e.outputFieldList.find((function(e){return e.fieldName===t}));a?d.push(a):d.push({fieldName:t,fieldDesc:""})})),this.outputFieldList=d}this.outputFieldList.length&&this.fieldDesc&&!t&&this.buildFieldDesc(),this.outputFieldList.length>0?(this.dataPreviewList=o,this.passTest=!0,t||this.$message.success("脚本执行通过")):this.passTest=!1}else this.passTest=!1,this.$message.error("请填写脚本")},addParams:function(e){var t=this;e.forEach((function(e){t.dataForm.config.paramsList.push({name:e,type:"",value:"",status:1,require:0,remark:""})})),this.$nextTick((function(){t.$refs.paramsSettingDialog.open()}))},clearType:function(){this.typeName="",this.dataForm.typeId=""},setCurrentNode:function(e){if(e){var t=this.dataForm.typeId||null;this.$refs.categorySelectTree.setCurrentKey(t)}},selectParentCategory:function(e){this.dataForm.typeId=e.id,this.typeName=e.name,this.$refs.selectParentName.blur()},goBack:function(){this.$emit("back")},renderHeader:function(e,t){var a=t.column,s=(t.index,a.label.length),i=14;return a.minWidth=s*i<120?120:s*i,e("span",{class:"cell-content",style:{width:"100%"}},[a.label])},openNewWindow:function(e){window.open(e,"_blank")},selectorFilter:function(e){this.$refs.categorySelectTree.filter(e)},treeFilter:function(e,t){return!e||-1!==t.name.indexOf(e)}}}),Ve=je,Me=(0,E.Z)(Ve,V,M,!1,null,"5bd66e10",null),Ae=Me.exports,Be=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{directives:[{name:"loading",rawName:"v-loading",value:e.saveLoading,expression:"saveLoading"}],staticClass:"inner-container ",attrs:{"element-loading-text":e.saveText}},[a("el-scrollbar",{staticClass:"data-set-scrollbar"},[a("div",{staticClass:"header"},[a("el-page-header",{staticClass:"bs-el-page-header"},[a("template",{slot:"content"},[a("div",{staticClass:"page-header"},[a("div",{staticClass:"page-header-left"},[e._v(" "+e._s(e.isEdit?e.dataForm.id?"编辑JSON数据集":"新增JSON数据集":"JSON数据集详情")+" ")]),a("div",{staticClass:"page-header-right"},[a("el-button",{staticClass:"bs-el-button-default",on:{click:function(t){return e.openNewWindow("https://www.yuque.com/chuinixiongkou/bigscreen/json_dataset")}}},[e._v(" 帮助 ")]),e.isEdit?a("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.save("form")}}},[e._v(" 保存 ")]):e._e(),a("el-button",{staticClass:"bs-el-button-default",on:{click:e.goBack}},[e._v(" 返回 ")])],1)])])],2)],1),a("el-row",{staticStyle:{margin:"16px 16px 0"}},[a("el-col",{attrs:{span:e.isEdit?16:24}},[a("el-form",{ref:"form",staticClass:"bs-el-form",staticStyle:{padding:"16px 16px 0"},attrs:{model:e.dataForm,rules:e.rules,"label-width":"120px"}},[a("el-row",{attrs:{gutter:20}},[a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:"数据集名称",prop:"name"}},[a("el-input",{staticClass:"bs-el-input",attrs:{clearable:"",disabled:!e.isEdit},model:{value:e.dataForm.name,callback:function(t){e.$set(e.dataForm,"name",t)},expression:"dataForm.name"}})],1)],1),a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:"分组",prop:"typeId"}},[a("el-select",{ref:"selectParentName",staticClass:"bs-el-select",attrs:{"popper-class":"bs-el-select",placeholder:"请选择分组",clearable:"",disabled:!e.isEdit,filterable:"","filter-method":e.selectorFilter},on:{clear:e.clearType,"visible-change":e.setCurrentNode},model:{value:e.dataForm.typeId,callback:function(t){e.$set(e.dataForm,"typeId",t)},expression:"dataForm.typeId"}},[a("el-option",{staticStyle:{height:"auto",padding:"0"},attrs:{label:e.typeName,value:e.dataForm.typeId}},[a("div",[a("el-tree",{ref:"categorySelectTree",staticClass:"bs-el-tree",attrs:{data:e.categoryData,"node-key":"id",indent:0,props:{label:"name",children:"children"},"default-expand-all":!0,"highlight-current":!0,"expand-on-click-node":!1,"filter-node-method":e.treeFilter},on:{"node-click":e.selectParentCategory},scopedSlots:e._u([{key:"default",fn:function(t){var s=t.data;return a("span",{staticClass:"custom-tree-node"},[a("span",[a("i",{class:s.children&&s.children.length?"el-icon el-icon-folder":"el-icon el-icon-document"}),e._v(" "+e._s(s.name)+" ")])])}}])})],1)])],1)],1)],1)],1),a("el-row",{attrs:{gutter:20}},[a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:"备注",prop:"remark"}},[a("el-input",{staticClass:"bs-el-input",attrs:{disabled:!e.isEdit},model:{value:e.dataForm.remark,callback:function(t){e.$set(e.dataForm,"remark",t)},expression:"dataForm.remark"}})],1)],1),a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:"标签",prop:"labelIds"}},[a("LabelSelect",{attrs:{"dataset-id":e.datasetId,"id-list":e.dataForm.labelIds},on:{commit:function(t){e.dataForm.labelIds=t}}})],1)],1)],1)],1),a("div",{staticClass:"card-border"},[e.isEdit?a("vue-json-editor",{attrs:{"show-btns":!1,mode:"code"},on:{"has-error":e.onError},model:{value:e.dataForm.json,callback:function(t){e.$set(e.dataForm,"json",t)},expression:"dataForm.json"}}):a("vue-json-viewer",{attrs:{value:e.dataForm.json,"expand-depth":5,sort:""}})],1),e.isEdit?a("div",{staticStyle:{"text-align":"center",padding:"16px 0"}},[a("el-button",{attrs:{type:"primary"},on:{click:e.analysisJSON}},[e._v(" 解析并运行 ")])],1):e._e()],1),e.isEdit?a("el-col",{attrs:{span:8}},[a("div",{staticClass:"structure"},[a("div",{staticClass:"title-style bs-title-style"},[e._v(" 输出字段 "),a("el-button",{staticStyle:{float:"right",border:"none","margin-top":"-4px"},attrs:{type:"text"},on:{click:function(t){e.fieldsetVisible=!0}}},[e._v(" 配置 ")])],1),a("div",{staticClass:"field-wrap bs-field-wrap"},e._l(e.structurePreviewList,(function(t){return a("div",{key:t.fieldName,staticClass:"field-item",on:{click:function(t){e.fieldsetVisible=!0}}},[a("span",[e._v(e._s(t.fieldName))]),e._v(" "),a("span",{directives:[{name:"show",rawName:"v-show",value:t.fieldDesc,expression:"field.fieldDesc"}],staticStyle:{color:"#909399"}},[e._v("("+e._s(t.fieldDesc)+")")]),a("el-button",{staticClass:"edit_field",staticStyle:{float:"right",border:"none","margin-top":"2px"},attrs:{type:"text"},on:{click:function(t){e.fieldsetVisible=!0}}},[e._v(" 配置 ")])],1)})),0)])]):e._e()],1),e.isEdit?a("div",{staticClass:"dataPreView",staticStyle:{"margin-top":"12px"}},[a("div",{staticClass:"result-view"},[e._v(" 数据预览 ")]),a("div",{staticClass:"bs-table-box is-Edit"},[a("el-table",{staticClass:"bs-el-table",attrs:{align:"center",data:e.dataPreviewList,"max-height":"400"}},e._l(e.dataPreviewList[0],(function(t,s){return a("el-table-column",{key:s,attrs:{label:s,align:"center","show-overflow-tooltip":"","render-header":e.renderHeader},scopedSlots:e._u([{key:"default",fn:function(t){return[a("span",[e._v(e._s(t.row[s]))])]}}],null,!0)})})),1)],1)]):e._e(),a("el-dialog",{staticClass:"bs-dialog-wrap bs-el-dialog",attrs:{title:"提示",visible:e.fieldDescVisible,width:"420px","append-to-body":"","close-on-click-modal":!1,"custom-class":"fieldDescCheck"},on:{"update:visible":function(t){e.fieldDescVisible=t}}},[a("p",{staticStyle:{color:"var(--bs-el-text)","line-height":"24px","padding-left":"10px",display:"flex"}},[a("i",{staticClass:"el-icon-warning",staticStyle:{color:"#E6A23C","font-size":"24px","margin-right":"5px"}}),e._v("存在字段描述信息为空，请确认 ")]),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{staticClass:"bs-el-button-default",on:{click:e.fieldDescFill}},[e._v("使用字段名填充")]),a("el-button",{staticClass:"bs-el-button-default",on:{click:e.fieldDescEdit}},[e._v("进入编辑")]),a("el-button",{attrs:{type:"primary"},on:{click:e.toSave}},[e._v("继续保存")])],1)]),a("el-dialog",{staticClass:"bs-dialog-wrap bs-el-dialog",attrs:{title:"输出字段配置",visible:e.fieldsetVisible,width:"1000px","append-to-body":"","close-on-click-modal":!1,"before-close":e.cancelField},on:{"update:visible":function(t){e.fieldsetVisible=t}}},[a("div",{staticClass:"bs-table-box"},[a("el-table",{staticClass:"bs-el-table",attrs:{data:e.structurePreviewListCopy,border:!0,align:"center"}},[a("el-empty",{attrs:{slot:"empty"},slot:"empty"}),a("el-table-column",{attrs:{align:"left","show-overflow-tooltip":"",prop:"fieldName",label:"字段值"}}),a("el-table-column",{attrs:{align:"center",prop:"fieldDesc",label:"字段描述"},scopedSlots:e._u([{key:"default",fn:function(t){return[e.isEdit?a("el-input",{staticClass:"labeldsc bs-el-input",attrs:{size:"small"},model:{value:t.row.fieldDesc,callback:function(a){e.$set(t.row,"fieldDesc",a)},expression:"scope.row.fieldDesc"}}):a("span",[e._v(e._s(t.row.fieldDesc))])]}}])}),e._t("output-field-table-column")],2)],1),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{staticClass:"bs-el-button-default",on:{click:e.cancelField}},[e._v(" 取消 ")]),a("el-button",{attrs:{type:"primary"},on:{click:e.setField}},[e._v(" 确定 ")])],1)])],1)],1)},Re=[],ze=(a(12826),a(48324),a(19434)),Ze=a(90699),Ue=a.n(Ze),We={props:{isEdit:{type:Boolean,default:!1},datasetId:{type:String,default:null},datasetName:{type:String,default:""},typeId:{type:String,default:""},appCode:{type:String,default:""}},data:function(){return{dataForm:{},dataPreviewList:[],structurePreviewList:[],structurePreviewListCopy:[],typeName:"",categoryData:[],current:1,size:10,totalCount:0,fieldDescVisible:!1,fieldsetVisible:!1,tableLoading:!1,saveLoading:!1,saveText:"",typeSelect:[{value:"String"},{value:"Integer"},{value:"Double"},{value:"Long"},{value:"Date"}]}},methods:{fieldDescFill:function(){this.structurePreviewList.forEach((function(e){""!==e.fieldDesc&&e.hasOwnProperty("fieldDesc")||(e.fieldDesc=e.fieldName)})),this.save("form"),this.fieldDescVisible=!1},fieldDescEdit:function(){this.fieldDescVisible=!1,this.fieldsetVisible=!0},toSave:function(){this.save("form",!0),this.fieldDescVisible=!1},cancelField:function(){this.structurePreviewListCopy=U()(this.structurePreviewList),this.fieldsetVisible=!1},setField:function(){this.structurePreviewList=U()(this.structurePreviewListCopy),this.fieldsetVisible=!1},clearType:function(){this.typeName="",this.dataForm.typeId=""},setCurrentNode:function(e){if(e){var t=this.dataForm.typeId||null;this.$refs.categorySelectTree.setCurrentKey(t)}},selectParentCategory:function(e){this.dataForm.typeId=e.id,this.typeName=e.name,this.$refs.selectParentName.blur()},goBack:function(){this.$emit("back")},sizeChangeHandle:function(e){this.size=e,this.current=1,this.datasetTest(!1)},currentChangeHandle:function(e){this.current=e,this.datasetTest(!1)},renderHeader:function(e,t){var a=t.column,s=(t.index,a.label.length),i=14;return a.minWidth=s*i<120?120:s*i,e("span",{class:"cell-content",style:{width:"100%"}},[a.label])},openNewWindow:function(e){window.open(e,"_blank")}}},Ke={name:"JsonEditForm",components:{vueJsonEditor:ze.Z,vueJsonViewer:Ue(),LabelSelect:ge},mixins:[We],data:function(){var e=this,t=function(t,a,s){h({id:e.datasetId,name:a,moduleCode:e.appCode}).then((function(e){e?s(new Error("数据集名称已存在")):s()}))};return{dataForm:{id:"",name:"",typeId:"",datasetType:"json",remark:"",labelIds:[],json:"",fieldDesc:{},fieldList:[]},rules:{name:[{required:!0,message:"请输入数据集名称",trigger:"blur"},{validator:t,trigger:"blur"}],typeId:[{required:!0,message:"请选择分组",trigger:"blur"}]},passTest:!1}},mounted:function(){this.init()},methods:{init:function(){var e=this;return(0,B.Z)((0,A.Z)().mark((function t(){return(0,A.Z)().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,C({tableName:"dataset",moduleCode:e.appCode});case 2:if(e.categoryData=t.sent,e.typeId&&(e.dataForm.typeId=e.typeId,e.$nextTick((function(){try{e.typeName=e.$refs.categorySelectTree.getNode(e.dataForm.typeId).data.name}catch(t){console.error(t)}}))),e.datasetId){t.next=7;break}return e.dataForm.json=[],t.abrupt("return");case 7:w(e.datasetId).then((function(t){e.dataForm.id=t.id,e.dataForm.name=t.name,e.dataForm.typeId=t.typeId,e.dataForm.remark=t.remark,e.dataForm.datasetType=t.datasetType,e.dataForm.moduleCode=t.moduleCode,e.dataForm.editable=t.editable,e.dataForm.sourceId=t.sourceId,e.dataForm.fieldDesc=t.config.fieldDesc,e.dataForm.json=JSON.parse(t.config.json),e.dataForm.typeId&&e.$nextTick((function(){try{e.typeName=e.$refs.categorySelectTree.getNode(e.dataForm.typeId).data.name}catch(t){console.error(t)}})),e.analysisJSON(null,!0)}));case 8:case"end":return t.stop()}}),t)})))()},save:function(e){var t=this,a=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this.passTest)if(this.structurePreviewList.length){if(!a){var s=this.structurePreviewList.some((function(e){return""===e.fieldDesc||!e.hasOwnProperty("fieldDesc")}));if(s)return void(this.fieldDescVisible=!0)}this.$refs[e].validate((function(e){if(e){t.dataForm.fieldList=t.structurePreviewList.length?t.structurePreviewList:[];var a=null;a=t.dataForm.id?v:g;var s={id:t.dataForm.id,name:t.dataForm.name,typeId:t.dataForm.typeId,datasetType:"json",remark:t.dataForm.remark,moduleCode:t.appCode,editable:t.appCode?1:0,labelIds:t.dataForm.labelIds,config:{className:"com.gccloud.dataset.entity.config.JsonDataSetConfig",json:JSON.stringify(t.dataForm.json),fieldDesc:t.dataForm.fieldDesc,fieldList:t.dataForm.fieldList}};a(s).then((function(){t.$message.success("保存成功"),t.$parent.init(!1),t.$parent.setType=null,t.saveLoading=!1,t.saveText="",t.goBack()})).catch((function(){t.saveLoading=!1,t.saveText=""}))}}))}else this.$message.warning("该JSON未生成输出字段，请重新检查");else this.$message.error("请确保JSON不为空且解析通过")},fieldDescFill:function(){var e=this;this.dataForm.fieldDesc={},this.structurePreviewList.forEach((function(t){""!==t.fieldDesc&&t.hasOwnProperty("fieldDesc")?e.dataForm.fieldDesc[t.fieldName]=t.fieldDesc:(t.fieldDesc=t.fieldName,e.dataForm.fieldDesc[t.fieldName]=t.fieldName)})),this.save("form"),this.fieldDescVisible=!1},toSave:function(){var e=this;this.dataForm.fieldDesc={},this.structurePreviewList.forEach((function(t){e.dataForm.fieldDesc[t.fieldName]=t.fieldDesc})),this.save("form",!0),this.fieldDescVisible=!1},setField:function(){var e=this;this.structurePreviewList=U()(this.structurePreviewListCopy),this.structurePreviewList.length?(this.dataForm.fieldDesc={},this.structurePreviewList.forEach((function(t){e.dataForm.fieldDesc[t.fieldName]=t.fieldDesc}))):this.dataForm.fieldDesc=null,this.fieldsetVisible=!1},onError:function(){this.passTest=!1},analysisJSON:function(e){var t=this,a=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if("[object Object]"===Object.prototype.toString.call(this.dataForm.json))this.structurePreviewList=Object.keys(this.dataForm.json).map((function(e){return{fieldName:e,fieldDesc:""}})),this.dataPreviewList=[U()(this.dataForm.json)],this.passTest=!0;else if("[object Array]"===Object.prototype.toString.call(this.dataForm.json))if("[object Object]"===Object.prototype.toString.call(this.dataForm.json[0]))this.structurePreviewList=Object.keys(this.dataForm.json[0]).map((function(e){return{fieldName:e,fieldDesc:""}})),this.dataPreviewList=U()(this.dataForm.json),this.passTest=!0;else try{this.structurePreviewList=Object.keys(JSON.parse(this.dataForm.json[0])).map((function(e){return{fieldName:e,fieldDesc:""}})),this.dataPreviewList=[],this.dataForm.json.forEach((function(e){t.dataPreviewList.push(JSON.parse(e))})),this.passTest=!0}catch(i){this.passTest=!1,this.$message.warning("JSON格式错误")}else try{var s=JSON.parse(this.dataForm.json);if("[object Object]"===Object.prototype.toString.call(s))this.structurePreviewList=Object.keys(s).map((function(e){return{fieldName:e,fieldDesc:""}})),this.dataPreviewList=[U()(s)],this.passTest=!0;else if("[object Array]"===Object.prototype.toString.call(s))if("[object Object]"===Object.prototype.toString.call(s[0]))this.structurePreviewList=Object.keys(s[0]).map((function(e){return{fieldName:e,fieldDesc:""}})),this.dataPreviewList=U()(s),this.passTest=!0;else try{this.structurePreviewList=Object.keys(JSON.parse(s[0])).map((function(e){return{fieldName:e,fieldDesc:""}})),this.dataPreviewList=[],s.forEach((function(e){t.dataPreviewList.push(JSON.parse(e))})),this.passTest=!0}catch(i){this.passTest=!1,this.$message.warning("JSON格式错误")}}catch(i){this.passTest=!1,this.$message.warning("JSON格式错误")}this.structurePreviewList.length&&this.dataForm.fieldDesc&&this.buildFieldDesc(),this.passTest&&!a&&this.$message.success("脚本执行通过"),this.structurePreviewListCopy=U()(this.structurePreviewList)},buildFieldDesc:function(){var e=this,t={};this.structurePreviewList.forEach((function(a){e.dataForm.fieldDesc.hasOwnProperty(a.fieldName)&&(a.fieldDesc=e.dataForm.fieldDesc[a.fieldName]),t[a.fieldName]=a.fieldDesc})),this.dataForm.fieldDesc=t},selectorFilter:function(e){this.$refs.categorySelectTree.filter(e)},treeFilter:function(e,t){return!e||-1!==t.name.indexOf(e)}}},He=Ke,Je=(0,E.Z)(He,Be,Re,!1,null,"156d5a3e",null),Xe=Je.exports,Ge=a(46761),Qe=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{directives:[{name:"loading",rawName:"v-loading",value:e.saveLoading,expression:"saveLoading"}],staticClass:"inner-container",attrs:{"element-loading-text":e.saveText}},[a("el-scrollbar",{staticClass:"data-set-scrollbar"},[a("div",{staticClass:"header"},[a("el-page-header",{staticClass:"bs-el-page-header"},[a("template",{slot:"content"},[a("div",{staticClass:"page-header"},[a("div",{staticClass:"page-header-left"},[e._v(" "+e._s(e.isEdit?e.dataForm.id?"编辑脚本数据集":"新增脚本数据集":"脚本数据集详情")+" ")]),a("div",{staticClass:"page-header-right"},[a("el-button",{staticClass:"bs-el-button-default",on:{click:function(t){return e.openNewWindow("https://www.yuque.com/chuinixiongkou/bigscreen/groovy_dataset")}}},[e._v(" 帮助 ")]),e.isEdit?a("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.save("form")}}},[e._v(" 保存 ")]):e._e(),a("el-button",{staticClass:"bs-el-button-default",on:{click:e.goBack}},[e._v(" 返回 ")])],1)])])],2)],1),a("el-row",{staticStyle:{margin:"16px 16px 0"}},[a("el-col",{attrs:{span:e.isEdit?16:24}},[a("el-form",{ref:"form",staticClass:"bs-el-form",staticStyle:{padding:"16px 16px 0"},attrs:{model:e.dataForm,rules:e.rules,"label-width":"120px"}},[a("el-row",{attrs:{gutter:20}},[a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:"数据集名称",prop:"name"}},[a("el-input",{staticClass:"bs-el-input",attrs:{clearable:"",disabled:!e.isEdit},model:{value:e.dataForm.name,callback:function(t){e.$set(e.dataForm,"name",t)},expression:"dataForm.name"}})],1)],1),a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:"分组",prop:"typeId"}},[a("el-select",{ref:"selectParentName",staticClass:"bs-el-select",attrs:{"popper-class":"bs-el-select",placeholder:"请选择分组",clearable:"",disabled:!e.isEdit,filterable:"","filter-method":e.selectorFilter},on:{clear:e.clearType,"visible-change":e.setCurrentNode},model:{value:e.dataForm.typeId,callback:function(t){e.$set(e.dataForm,"typeId",t)},expression:"dataForm.typeId"}},[a("el-option",{staticStyle:{height:"auto",padding:"0"},attrs:{label:e.typeName,value:e.dataForm.typeId}},[a("div",{staticClass:"tree-box"},[a("el-tree",{ref:"categorySelectTree",staticClass:"bs-el-tree",attrs:{data:e.categoryData,"node-key":"id",indent:0,props:{label:"name",children:"children"},"default-expand-all":!0,"highlight-current":!0,"expand-on-click-node":!1,"filter-node-method":e.treeFilter},on:{"node-click":e.selectParentCategory},scopedSlots:e._u([{key:"default",fn:function(t){var s=t.data;return a("span",{staticClass:"custom-tree-node"},[a("span",[a("i",{class:s.children&&s.children.length?"el-icon el-icon-folder":"el-icon el-icon-document"}),e._v(" "+e._s(s.name)+" ")])])}}])})],1)])],1)],1)],1)],1),a("el-row",{attrs:{gutter:20}},[a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:"备注",prop:"remark"}},[a("el-input",{staticClass:"bs-el-input",attrs:{disabled:!e.isEdit},model:{value:e.dataForm.remark,callback:function(t){e.$set(e.dataForm,"remark",t)},expression:"dataForm.remark"}})],1)],1),a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:"缓存",prop:"cache"}},[a("el-radio-group",{staticClass:"bs-el-radio-group",model:{value:e.dataForm.cache,callback:function(t){e.$set(e.dataForm,"cache",t)},expression:"dataForm.cache"}},[a("el-radio",{attrs:{label:1}},[e._v(" 开启 ")]),a("el-radio",{attrs:{label:0}},[e._v(" 关闭 ")])],1),a("el-tooltip",{staticClass:"item",attrs:{effect:"light",content:"开启缓存:会在首次调用该数据集时，将结果缓存，在接下来的十分钟内，若再次被调用则直接返回缓存中的数据，注意：在当前数据集编辑页面缓存不生效",placement:"top"}},[a("i",{staticClass:"el-icon-warning-outline",staticStyle:{color:"#E3C98C","margin-left":"16px","font-size":"14px"}})])],1)],1)],1),a("el-row",[a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:"标签",prop:"labelIds"}},[a("LabelSelect",{attrs:{"dataset-id":e.datasetId,"id-list":e.dataForm.labelIds},on:{commit:function(t){e.dataForm.labelIds=t}}})],1)],1)],1)],1),e.isEdit?a("div",{staticClass:"sql-config"},[a("div",[a("el-button-group",[a("el-button",{staticClass:"bs-el-button-default",attrs:{plain:"",type:"primary"},on:{click:function(t){return e.example("es")}}},[e._v(" ES案例 ")])],1),a("div",{staticClass:"code-out"},[a("codemirror",{ref:"targetInSql",staticStyle:{"margin-top":"2px"},attrs:{options:e.cOptions},model:{value:e.dataForm.script,callback:function(t){e.$set(e.dataForm,"script",t)},expression:"dataForm.script"}})],1)],1),a("div",{staticStyle:{"text-align":"center",padding:"16px 0"}},[a("el-button",{attrs:{type:"primary"},on:{click:e.toExecute}},[e._v(" 解析并运行 ")])],1)]):e._e()],1),e.isEdit?a("el-col",{attrs:{span:8}},[a("div",{staticClass:"right-setting"},[a("div",{staticClass:"paramConfig"},[a("div",{staticClass:"title-style bs-title-style"},[e._v(" 脚本参数 "),a("el-button",{staticStyle:{float:"right",border:"none","margin-top":"-4px"},attrs:{type:"text"},on:{click:e.openParamsConfig}},[e._v(" 配置 ")])],1),a("div",{staticClass:"field-wrap bs-field-wrap bs-scrollbar"},e._l(e.dataForm.paramsList,(function(t){return a("div",{key:t.name,staticClass:"field-item",on:{click:e.openParamsConfig}},[a("span",[e._v(e._s(t.name))]),e._v(" "),a("span",{directives:[{name:"show",rawName:"v-show",value:t.remark,expression:"param.remark"}],staticStyle:{color:"#909399"}},[e._v("("+e._s(t.remark)+")")]),a("el-button",{staticClass:"edit_field",staticStyle:{float:"right",border:"none","margin-top":"2px"},attrs:{type:"text"},on:{click:e.openParamsConfig}},[e._v(" 配置 ")])],1)})),0)]),a("div",{staticClass:"structure"},[a("div",{staticClass:"title-style bs-title-style"},[e._v(" 输出字段 "),a("el-button",{staticStyle:{float:"right",border:"none","margin-top":"-4px"},attrs:{type:"text"},on:{click:function(t){e.fieldsetVisible=!0}}},[e._v(" 配置 ")])],1),a("div",{staticClass:"field-wrap bs-field-wrap bs-scrollbar"},e._l(e.structurePreviewList,(function(t){return a("div",{key:t.fieldName,staticClass:"field-item",on:{click:function(t){e.fieldsetVisible=!0}}},[a("span",[e._v(e._s(t.fieldName))]),e._v(" "),a("span",{directives:[{name:"show",rawName:"v-show",value:t.fieldDesc,expression:"field.fieldDesc"}],staticStyle:{color:"#909399"}},[e._v("("+e._s(t.fieldDesc)+")")]),a("el-button",{staticClass:"edit_field",staticStyle:{float:"right",border:"none","margin-top":"2px"},attrs:{type:"text"},on:{click:function(t){e.fieldsetVisible=!0}}},[e._v(" 配置 ")])],1)})),0)])])]):e._e()],1),e.isEdit?a("div",{staticClass:"dataPreView",staticStyle:{"margin-top":"12px"}},[a("div",{staticClass:"result-view"},[e._v(" 数据预览 ")]),a("div",{directives:[{name:"loading",rawName:"v-loading",value:e.tableLoading,expression:"tableLoading"}],staticClass:"bs-table-box is-Edit bs-scrollbar"},[a("el-table",{staticClass:"bs-el-table bs-scrollbar",attrs:{align:"center",data:e.dataPreviewList,"max-height":"400"}},e._l(e.dataPreviewList[0]?e.dataPreviewList[0]:e.noDataTableDisplayFields,(function(t,s){return a("el-table-column",{key:s,attrs:{label:s,align:"center","show-overflow-tooltip":"","render-header":e.renderHeader},scopedSlots:e._u([{key:"default",fn:function(t){return[a("span",[e._v(e._s(t.row[s]))])]}}],null,!0)})})),1)],1)]):e._e(),a("el-dialog",{staticClass:"bs-dialog-wrap bs-el-dialog",attrs:{title:"提示",visible:e.fieldDescVisible,width:"420px","append-to-body":"","close-on-click-modal":!1,"custom-class":"fieldDescCheck"},on:{"update:visible":function(t){e.fieldDescVisible=t}}},[a("p",{staticStyle:{color:"var(--bs-el-text)","line-height":"24px","padding-left":"10px",display:"flex"}},[a("i",{staticClass:"el-icon-warning",staticStyle:{color:"#E6A23C","font-size":"24px","margin-right":"5px"}}),e._v("存在字段描述信息为空，请确认 ")]),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{staticClass:"bs-el-button-default",on:{click:e.fieldDescFill}},[e._v("使用字段名填充")]),a("el-button",{staticClass:"bs-el-button-default",on:{click:e.fieldDescEdit}},[e._v("进入编辑")]),a("el-button",{attrs:{type:"primary"},on:{click:e.toSave}},[e._v("继续保存")])],1)]),a("el-dialog",{staticClass:"bs-dialog-wrap bs-el-dialog",attrs:{title:"输出字段配置",visible:e.fieldsetVisible,width:"1000px","append-to-body":"","close-on-click-modal":!1,"before-close":e.cancelField},on:{"update:visible":function(t){e.fieldsetVisible=t}}},[a("div",{staticClass:"bs-table-box"},[a("el-table",{staticClass:"bs-el-table",attrs:{data:e.structurePreviewListCopy,border:!0,align:"center"}},[a("el-empty",{attrs:{slot:"empty"},slot:"empty"}),a("el-table-column",{attrs:{align:"left","show-overflow-tooltip":"",prop:"fieldName",label:"字段值"}}),a("el-table-column",{attrs:{align:"center",prop:"fieldDesc",label:"字段描述"},scopedSlots:e._u([{key:"default",fn:function(t){return[e.isEdit?a("el-input",{staticClass:"labeldsc bs-el-input",attrs:{size:"small"},model:{value:t.row.fieldDesc,callback:function(a){e.$set(t.row,"fieldDesc",a)},expression:"scope.row.fieldDesc"}}):a("span",[e._v(e._s(t.row.fieldDesc))])]}}])}),e._t("output-field-table-column")],2)],1),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{staticClass:"bs-el-button-default",on:{click:e.cancelField}},[e._v(" 取消 ")]),a("el-button",{attrs:{type:"primary"},on:{click:e.setField}},[e._v(" 确定 ")])],1)]),a("el-dialog",{staticClass:"bs-dialog-wrap bs-el-dialog",attrs:{title:"脚本参数配置",visible:e.paramsVisible,width:"1000px","append-to-body":"","close-on-click-modal":!1,"before-close":e.cancelParam},on:{"update:visible":function(t){e.paramsVisible=t}}},[a("div",{staticClass:"bs-table-box"},[a("el-table",{ref:"singleTable",staticClass:"bs-el-table",attrs:{data:e.paramsListCopy,border:!0,align:"center"}},[a("el-empty",{attrs:{slot:"empty"},slot:"empty"}),a("el-table-column",{attrs:{prop:"name",label:"参数名称",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-input",{staticClass:"bs-el-input",attrs:{disabled:!e.isSet,placeholder:"请输入名称",clearable:""},on:{change:function(a){return e.checkParamsName(t.row)}},model:{value:t.row.name,callback:function(a){e.$set(t.row,"name",a)},expression:"scope.row.name"}})]}}])}),a("el-table-column",{attrs:{prop:"type",label:"参数类型",align:"center",width:"200",filterable:""},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-select",{staticClass:"bs-el-select",attrs:{"popper-class":"bs-el-select",placeholder:"请选择",disabled:!e.isSet},model:{value:t.row.type,callback:function(a){e.$set(t.row,"type",a)},expression:"scope.row.type"}},e._l(e.typeSelect,(function(e){return a("el-option",{key:e.value,attrs:{label:e.value,value:e.value}})})),1)]}}])}),a("el-table-column",{attrs:{prop:"require",label:"是否必填",align:"center",width:"200",filterable:""},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-radio-group",{staticClass:"bs-el-radio-group",attrs:{disabled:!e.isSet},model:{value:t.row.require,callback:function(a){e.$set(t.row,"require",a)},expression:"scope.row.require"}},[a("el-radio",{attrs:{label:1}},[e._v(" 是 ")]),a("el-radio",{attrs:{label:0}},[e._v(" 否 ")])],1)]}}])}),a("el-table-column",{attrs:{prop:"value",label:"参数值",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return["Date"===t.row.type?a("el-date-picker",{attrs:{type:"datetime","value-format":"yyyy-MM-dd HH:mm:ss",placeholder:"选择日期时间"},model:{value:t.row.value,callback:function(a){e.$set(t.row,"value",a)},expression:"scope.row.value"}}):a("el-input",{staticClass:"bs-el-input",attrs:{clearable:"",placeholder:"请输入值"},model:{value:t.row.value,callback:function(a){e.$set(t.row,"value",a)},expression:"scope.row.value"}})]}}])}),a("el-table-column",{attrs:{prop:"remark",label:"备注",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-input",{staticClass:"bs-el-input",attrs:{disabled:!e.isSet,clearable:"",placeholder:"请输入备注",rows:"2",maxlength:"200"},model:{value:t.row.remark,callback:function(a){e.$set(t.row,"remark",a)},expression:"scope.row.remark"}})]}}])}),e.isSet?a("el-table-column",{attrs:{label:"操作",width:"105",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-button",{staticClass:"no-border",staticStyle:{color:"#e47470"},attrs:{type:"text"},on:{click:function(a){return e.delRow(t.$index)}}},[e._v(" 删除 ")])]}}],null,!1,891024780)},[a("template",{slot:"header"},[a("el-button",{staticClass:"no-border",attrs:{icon:"el-icon-plus",type:"text"},on:{click:e.addParam}},[e._v(" 添加 ")])],1)],2):e._e()],1)],1),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{staticClass:"bs-el-button-default",on:{click:e.cancelParam}},[e._v("取消")]),a("el-button",{attrs:{type:"primary"},on:{click:e.setParam}},[e._v("确定")])],1)]),a("el-dialog",{staticClass:"bs-dialog-wrap bs-el-dialog",attrs:{title:"脚本案例",visible:e.exampleVisible,width:"1000px",height:"1000px","append-to-body":"","close-on-click-modal":!1},on:{"update:visible":function(t){e.exampleVisible=t}}},[a("div",{staticClass:"code-inner"},[a("codemirror",{ref:"example",staticStyle:{"margin-top":"2px"},attrs:{options:e.cOptions},model:{value:e.currentExample,callback:function(t){e.currentExample=t},expression:"currentExample"}})],1),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{staticClass:"bs-el-button-default",on:{click:function(t){e.exampleVisible=!1}}},[e._v("关闭")]),a("el-button",{attrs:{type:"primary"},on:{click:e.useExample}},[e._v("使用该案例")])],1)])],1)],1)},Ye=[],et=(a(752),a(19649),a(21694),a(76265),a(53123),{name:"ScriptEditForm",components:{codemirror:qe.codemirror,LabelSelect:ge},mixins:[We],data:function(){var e=this,t=function(t,a,s){h({id:e.datasetId,name:a,moduleCode:e.appCode}).then((function(e){e?s(new Error("数据集名称已存在")):s()}))};return{dataForm:{id:"",name:"",typeId:"",datasetType:"script",remark:"",cache:0,labelIds:[],script:"",paramsList:[],fieldDesc:{},fieldList:[]},rules:{name:[{required:!0,message:"请输入数据集名称",trigger:"blur"},{validator:t,trigger:"blur"}],typeId:[{required:!0,message:"请选择分组",trigger:"blur"}]},cOptions:{mode:"text/x-groovy",lineNumbers:!0,lineWrapping:!0,theme:"nord",extraKey:{Ctrl:"autocomplete"},hintOptions:{completeSingle:!0}},paramsVisible:!1,paramsListCopy:[],isSet:!1,passTest:!1,fieldDesc:null,exampleVisible:!1,currentExample:"",exampleList:{es:'import com.gccloud.dataset.utils.ElasticsearchDsService;\n\ndef dsl = \'\'\'\n{\n    "query":{\n       "match_all":{}\n    }\n}\n\'\'\'\ndef host = "127.0.0.1"\nint port = 9200\ndef username = "elastic"\ndef password = "pwd"\ndef path = "/_search"\n\n/**\n * query方法的参数说明：\n * host es的ip\n * port es的端口\n * username es的用户名，如果没有可以不填\n * password es的密码，如果没有可以不填\n * path es的查询路径\n * dsl 查询的dsl，示例见上面\n * return 查询结果，List<Map>格式\n */\nreturn ElasticsearchDsService.query(host, port, username, password, path, dsl);\n'}}},computed:{noDataTableDisplayFields:function(){var e={};return this.structurePreviewList.forEach((function(t){e[t.fieldName]=""})),e}},watch:{"dataForm.script":function(){this.passTest=!1}},mounted:function(){this.init()},methods:{init:function(){var e=this;return(0,B.Z)((0,A.Z)().mark((function t(){return(0,A.Z)().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,C({type:"dataset",moduleCode:e.appCode});case 2:if(e.categoryData=t.sent,e.typeId&&(e.dataForm.typeId=e.typeId,e.$nextTick((function(){try{e.typeName=e.$refs.categorySelectTree.getNode(e.dataForm.typeId).data.name}catch(t){console.error(t)}}))),e.datasetId){t.next=6;break}return t.abrupt("return");case 6:w(e.datasetId).then((function(t){e.dataForm.id=t.id,e.dataForm.name=t.name,e.dataForm.typeId=t.typeId,e.dataForm.remark=t.remark,e.dataForm.cache=t.cache,e.dataForm.datasetType=t.datasetType,e.dataForm.moduleCode=t.moduleCode,e.dataForm.editable=t.editable,e.dataForm.sourceId=t.sourceId,e.dataForm.script=t.config.script,e.dataForm.paramsList=t.config.paramsList?t.config.paramsList:[],e.dataForm.fieldDesc=t.config.fieldDesc,e.dataForm.fieldList=t.config.fieldList,e.paramsListCopy=U()(e.dataForm.paramsList),e.scriptExecute(!0)}));case 7:case"end":return t.stop()}}),t)})))()},save:function(e){var t=this,a=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!1!==this.passTest)if(this.structurePreviewList.length){if(!a){var s=this.structurePreviewList.some((function(e){return""===e.fieldDesc||!e.hasOwnProperty("fieldDesc")}));if(s)return void(this.fieldDescVisible=!0)}this.$refs[e].validate((function(e){if(!e)return!1;if(t.dataForm.paramsList.length>0){var a=t.dataForm.paramsList.map((function(e){return e.name})),s=new Set(a);if(s.size!==a.length)return void t.$message.error("参数名称不能重复，请重新输入")}t.dataForm.fieldList=t.structurePreviewList.length?t.structurePreviewList:[];var i={};t.structurePreviewList.length>0&&(t.structurePreviewList.forEach((function(e){i[e.fieldName]=e.fieldDesc})),t.dataForm.fieldDesc=i),t.saveLoading=!0,t.saveText="正在保存...";var r=""===t.dataForm.id?g:v,l={id:t.dataForm.id,name:t.dataForm.name,typeId:t.dataForm.typeId,datasetType:"script",remark:t.dataForm.remark,cache:t.dataForm.cache,sourceId:t.dataForm.sourceId,moduleCode:t.appCode,editable:t.appCode?1:0,labelIds:t.dataForm.labelIds,config:{className:"com.gccloud.dataset.entity.config.GroovyDataSetConfig",script:t.dataForm.script,paramsList:t.dataForm.paramsList,fieldList:t.dataForm.fieldList,fieldDesc:t.dataForm.fieldDesc}};r(l).then((function(){t.$message.success("保存成功"),t.$parent.init(!1),t.$parent.setType=null,t.saveLoading=!1,t.saveText="",t.goBack()})).catch((function(){t.saveLoading=!1,t.saveText=""}))}))}else this.$message.warning("该执行脚本未生成输出字段，请重新检查");else this.$message.error("请确保脚本不为空且执行通过")},scriptExecute:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]&&arguments[0],a={script:this.dataForm.script,params:this.dataForm.paramsList,dataSetType:"script"};this.saveLoading=!0,y(a).then((function(a){t||e.$message.success("脚本执行通过"),e.dataPreviewList=a.data?a.data:[],e.structurePreviewList=[],a.data.length&&(e.structurePreviewList=Object.keys(a.data[0]).map((function(e){return{fieldName:e,fieldDesc:""}}))),e.structurePreviewList.length&&e.dataForm.fieldDesc&&e.buildFieldDesc(),e.structurePreviewListCopy=U()(e.structurePreviewList),e.saveLoading=!1,e.passTest=!0})).catch((function(t){e.passTest=!1,e.saveLoading=!1}))},toExecute:function(){this.dataForm.paramsList.length?(this.isSet=!1,this.paramsVisible=!0):this.scriptExecute()},buildFieldDesc:function(){var e=this,t={};this.structurePreviewList.forEach((function(a){e.dataForm.fieldDesc.hasOwnProperty(a.fieldName)&&(a.fieldDesc=e.dataForm.fieldDesc[a.fieldName]),t[a.fieldName]=a.fieldDesc})),this.dataForm.fieldDesc=t},openParamsConfig:function(){this.isSet=!0,this.paramsVisible=!0},cancelParam:function(){this.paramsListCopy=U()(this.dataForm.paramsList),this.paramsVisible=!1},setParam:function(){this.isSet?this.dataForm.paramsList=U()(this.paramsListCopy):(this.scriptExecute(),this.paramsListCopy=U()(this.dataForm.paramsList)),this.paramsVisible=!1},checkParamsName:function(e){var t=this.structurePreviewList.filter((function(t){return t.fieldName===e.name}));t.length&&(this.$message.warning("参数名称不可以与字段名相同！"),e.name="")},delRow:function(e){this.paramsListCopy.splice(e,1)},addParam:function(){this.paramsListCopy.push({name:"",type:"",value:"",status:1,require:0,remark:""})},selectorFilter:function(e){this.$refs.categorySelectTree.filter(e)},treeFilter:function(e,t){return!e||-1!==t.name.indexOf(e)},example:function(e){this.exampleVisible=!0,this.currentExample=this.exampleList[e]},useExample:function(){this.dataForm.script=this.currentExample,this.exampleVisible=!1}}}),tt=et,at=(0,E.Z)(tt,Qe,Ye,!1,null,"1a882c6a",null),st=at.exports,it=a(65864),rt=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{directives:[{name:"loading",rawName:"v-loading",value:e.saveLoading,expression:"saveLoading"}],staticClass:"inner-container",attrs:{"element-loading-text":e.saveText}},[a("el-scrollbar",{staticClass:"data-set-scrollbar"},[a("div",{staticClass:"header"},[a("el-page-header",{staticClass:"bs-el-page-header"},[a("template",{slot:"content"},[a("div",{staticClass:"page-header"},[a("div",{staticClass:"page-header-left"},[e._v(" "+e._s(e.isEdit?e.dataForm.id?"编辑自助数据集":"新增自助数据集":"自助数据集详情")+" ")]),a("div",{staticClass:"page-header-right"},[a("el-button",{staticClass:"bs-el-button-default",on:{click:function(t){return e.openNewWindow("https://www.yuque.com/chuinixiongkou/bigscreen/self_dataset")}}},[e._v(" 帮助 ")]),e.isEdit?a("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.save("form")}}},[e._v(" 保存 ")]):e._e(),a("el-button",{staticClass:"back bs-el-button-default",on:{click:e.goBack}},[e._v(" 返回 ")])],1)])])],2)],1),a("el-row",{staticStyle:{margin:"16px 16px 0"}},[a("el-col",{attrs:{span:e.isEdit?16:24}},[a("el-form",{ref:"form",staticClass:"bs-el-form",staticStyle:{padding:"16px 16px 0"},attrs:{model:e.dataForm,rules:e.rules,"label-width":"120px"}},[a("el-row",{attrs:{gutter:20}},[a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:"数据集名称",prop:"name"}},[a("el-input",{staticClass:"bs-el-input",attrs:{clearable:"",disabled:!e.isEdit},model:{value:e.dataForm.name,callback:function(t){e.$set(e.dataForm,"name",t)},expression:"dataForm.name"}})],1)],1),a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:"分组",prop:"typeId"}},[a("el-select",{ref:"selectParentName",staticClass:"bs-el-select",attrs:{"popper-class":"bs-el-select",placeholder:"请选择分组",clearable:"",disabled:!e.isEdit,filterable:"","filter-method":e.selectorFilter},on:{clear:e.clearType,"visible-change":e.setCurrentNode},model:{value:e.dataForm.typeId,callback:function(t){e.$set(e.dataForm,"typeId",t)},expression:"dataForm.typeId"}},[a("el-option",{staticStyle:{height:"auto",padding:"0"},attrs:{label:e.typeName,value:e.dataForm.typeId}},[a("div",[a("el-tree",{ref:"categorySelectTree",staticClass:"bs-el-tree",attrs:{data:e.categoryData,"node-key":"id",indent:0,props:{label:"name",children:"children"},"default-expand-all":!0,"highlight-current":!0,"expand-on-click-node":!1,"filter-node-method":e.treeFilter},on:{"node-click":e.selectParentCategory},scopedSlots:e._u([{key:"default",fn:function(t){var s=t.data;return a("span",{staticClass:"custom-tree-node"},[a("span",[a("i",{class:s.children&&s.children.length?"el-icon el-icon-folder":"el-icon el-icon-document"}),e._v(" "+e._s(s.name)+" ")])])}}])})],1)])],1)],1)],1)],1),a("el-row",{attrs:{gutter:20}},[a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:"备注",prop:"remark"}},[a("el-input",{staticClass:"bs-el-input",attrs:{disabled:!e.isEdit},model:{value:e.dataForm.remark,callback:function(t){e.$set(e.dataForm,"remark",t)},expression:"dataForm.remark"}})],1)],1),a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:"数据源",prop:"sourceId"}},[a("el-select",{staticClass:"bs-el-select",attrs:{clearable:"",filterable:"","popper-class":"bs-el-select",placeholder:"请选择数据源",disabled:!e.isEdit},model:{value:e.dataForm.sourceId,callback:function(t){e.$set(e.dataForm,"sourceId",t)},expression:"dataForm.sourceId"}},e._l(e.sourceList,(function(e){return a("el-option",{key:e.id,attrs:{label:e.sourceName,value:e.id}})})),1)],1)],1)],1),a("el-row",{attrs:{gutter:20}},[a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:"缓存",prop:"cache"}},[a("el-radio-group",{staticClass:"bs-el-radio-group",model:{value:e.dataForm.cache,callback:function(t){e.$set(e.dataForm,"cache",t)},expression:"dataForm.cache"}},[a("el-radio",{attrs:{label:1}},[e._v(" 开启 ")]),a("el-radio",{attrs:{label:0}},[e._v(" 关闭 ")])],1),a("el-tooltip",{staticClass:"item",attrs:{effect:"light",content:"开启缓存:会在首次调用该数据集时，将结果缓存，在接下来的十分钟内，若再次被调用则直接返回缓存中的数据，注意：在当前数据集编辑页面缓存不生效",placement:"top"}},[a("i",{staticClass:"el-icon-warning-outline",staticStyle:{color:"#E3C98C","margin-left":"16px","font-size":"14px"}})])],1)],1),a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:"语法类型",prop:"syntaxType"}},[a("el-radio-group",{staticClass:"bs-el-radio-group",model:{value:e.dataForm.syntaxType,callback:function(t){e.$set(e.dataForm,"syntaxType",t)},expression:"dataForm.syntaxType"}},[a("el-radio",{attrs:{label:"normal"}},[e._v(" 普通 ")]),a("el-radio",{attrs:{label:"mybatis"}},[e._v(" Mybatis ")])],1),a("el-tooltip",{staticClass:"item",attrs:{effect:"light",content:"Mybatis类型可使用动态标签来处理sql，如if、choose、where，具体用法可参考示例",placement:"top"}},[a("i",{staticClass:"el-icon-warning-outline",staticStyle:{color:"#E3C98C","margin-left":"16px","font-size":"14px"}})])],1)],1)],1),a("el-row",{attrs:{gutter:20}},[a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:"标签",prop:"labelIds"}},[a("LabelSelect",{attrs:{"dataset-id":e.datasetId,"id-list":e.dataForm.labelIds},on:{commit:function(t){e.dataForm.labelIds=t}}})],1)],1)],1)],1),e.isEdit?a("div",{staticClass:"sql-config"},[a("div",[a("codemirror",{ref:"targetInSql",staticStyle:{"margin-top":"2px"},attrs:{options:e.cOptions},model:{value:e.dataForm.sqlProcess,callback:function(t){e.$set(e.dataForm,"sqlProcess",t)},expression:"dataForm.sqlProcess"}}),"mybatis"===e.dataForm.syntaxType?a("div",{staticClass:"bs-codemirror-bottom-text"},[e._v(" 示例： "),a("strong",[a("br"),e._v(" 1、常规使用 "),a("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:"${参数名称}会将参数值直接填充到sql中，#{参数名称}会将参数值进行转义（比如字符串类型会添加''）后填充到sql中",placement:"top-start"}},[a("i",{staticClass:"el-icon-question"})]),e._v(" select * from table where table_field = "),a("span",{staticStyle:{color:"#CC7832"}},[e._v("${参数名称}")]),e._v(" ( 或 "),a("span",{staticStyle:{color:"#CC7832"}},[e._v("#{参数名称}")]),e._v(" )"),a("br"),e._v(" 2、条件判断 "),a("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:"支持Mybatis的所有动态标签，如if、choose、where等，具体用法请参考Mybatis官方文档",placement:"top-start"}},[a("i",{staticClass:"el-icon-question"})]),e._v(" select * from table where 1=1 "),a("span",{staticStyle:{color:"#2F67A7"}},[e._v("<if test=\"参数名称 != null and 参数名称 !=''\">")]),e._v(" and table_field = "),a("span",{staticStyle:{color:"#CC7832"}},[e._v("${参数名称}")]),e._v(" "),a("span",{staticStyle:{color:"#2F67A7"}},[e._v("</if>")])],1)]):a("div",{staticClass:"bs-codemirror-bottom-text"},[e._v(" 示例： "),a("strong",[a("br"),e._v(" 1、常规使用 select * from table where table_field = "),a("span",{staticStyle:{color:"#CC7832"}},[e._v("${参数名称}")]),a("br"),e._v(" 2、标签使用 "),a("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:"<参数名称></参数名称>为非空标签, 当该参数值为空时, 标签部分不进行处理",placement:"top-start"}},[a("i",{staticClass:"el-icon-question"})]),e._v(" select * from table where 1=1 "),a("span",{staticStyle:{color:"#2F67A7"}},[e._v("<参数名称>")]),e._v(" and table_field = "),a("span",{staticStyle:{color:"#CC7832"}},[e._v("${参数名称}")]),e._v(" "),a("span",{staticStyle:{color:"#2F67A7"}},[e._v("</参数名称>")])],1)])],1),a("div",{staticStyle:{"text-align":"center",padding:"16px 0"}},[a("el-button",{attrs:{type:"primary"},on:{click:e.buildParamsAndRun}},[e._v(" 解析并运行 ")])],1)]):e._e()],1),e.isEdit?a("el-col",{attrs:{span:8}},[a("div",{staticClass:"right-setting"},[a("div",{staticClass:"paramConfig"},[a("div",{staticClass:"title-style bs-title-style"},[e._v(" SQL参数 "),a("el-button",{staticStyle:{float:"right",border:"none","margin-top":"-4px"},attrs:{type:"text"},on:{click:e.openParamsConfig}},[e._v(" 配置 ")])],1),a("div",{staticClass:"field-wrap bs-field-wrap bs-scrollbar"},e._l(e.dataForm.paramsList,(function(t){return a("div",{key:t.name,staticClass:"field-item",on:{click:e.openParamsConfig}},[a("span",[e._v(e._s(t.name))]),e._v(" "),a("span",{directives:[{name:"show",rawName:"v-show",value:t.remark,expression:"param.remark"}],staticStyle:{color:"#909399"}},[e._v("("+e._s(t.remark)+")")]),a("el-button",{staticClass:"edit_field",staticStyle:{float:"right",border:"none","margin-top":"2px"},attrs:{type:"text"},on:{click:e.openParamsConfig}},[e._v(" 配置 ")])],1)})),0)]),a("div",{staticClass:"structure"},[a("div",{staticClass:"title-style bs-title-style"},[e._v(" 输出字段 "),a("el-button",{staticStyle:{float:"right",border:"none","margin-top":"-4px"},attrs:{type:"text"},on:{click:function(t){e.fieldsetVisible=!0}}},[e._v(" 配置 ")])],1),a("div",{staticClass:"field-wrap bs-field-wrap bs-scrollbar"},e._l(e.sortedStructurePreviewList,(function(t){return a("div",{key:t.fieldName,staticClass:"field-item",on:{click:function(t){e.fieldsetVisible=!0}}},[a("span",[e._v(e._s(t.fieldName))]),e._v(" "),a("span",{directives:[{name:"show",rawName:"v-show",value:t.fieldDesc,expression:"field.fieldDesc"}],staticStyle:{color:"#909399"}},[e._v("("+e._s(t.fieldDesc)+")")]),a("el-button",{staticClass:"edit_field",staticStyle:{float:"right",border:"none","margin-top":"2px"},attrs:{type:"text"},on:{click:function(t){e.fieldsetVisible=!0}}},[e._v(" 配置 ")])],1)})),0)])])]):e._e()],1),e.isEdit?a("div",{staticClass:"dataPreView",staticStyle:{"margin-top":"12px"}},[a("div",{staticClass:"result-view"},[e._v(" 数据预览 ")]),a("div",{staticClass:"bs-table-box is-Edit"},[a("el-table",{staticClass:"bs-el-table bs-scrollbar",attrs:{align:"center",data:e.dataPreviewList,"max-height":"400"}},e._l(e.sortedTablePreviewList,(function(t,s){return a("el-table-column",{key:s,attrs:{label:t,align:"center","show-overflow-tooltip":"","render-header":e.renderHeader},scopedSlots:e._u([{key:"default",fn:function(s){return[a("span",[e._v(e._s(s.row[t]))])]}}],null,!0)})})),1)],1),a("div",{staticClass:"bs-pagination"},[a("el-pagination",{staticClass:"bs-el-pagination",attrs:{"popper-class":"bs-el-pagination","current-page":e.current,"page-sizes":[10,20,50,100],"page-size":e.size,total:e.totalCount,background:"","prev-text":"上一页","next-text":"下一页",layout:"total, prev, pager, next,sizes"},on:{"size-change":e.sizeChangeHandle,"current-change":e.currentChangeHandle}})],1)]):e._e(),e.isEdit?e._e():a("div",{staticClass:"dataPreView"},[a("el-tabs",{model:{value:e.activeName,callback:function(t){e.activeName=t},expression:"activeName"}},[a("el-tab-pane",{directives:[{name:"loading",rawName:"v-loading",value:e.tableLoading,expression:"tableLoading"}],attrs:{label:"数据预览",name:"data"}},[a("div",{staticClass:"bs-table-box"},[a("el-table",{attrs:{align:"center",data:e.dataPreviewList,"max-height":"400",border:!0}},e._l(e.dataPreviewList[0],(function(t,s){return a("el-table-column",{key:s,attrs:{label:s,align:"center","show-overflow-tooltip":"","render-header":e.renderHeader},scopedSlots:e._u([{key:"default",fn:function(t){return[a("span",[e._v(e._s(t.row[s]))])]}}],null,!0)})})),1)],1),a("div",{staticClass:"bs-pagination"},[a("el-pagination",{staticClass:"bs-el-pagination",attrs:{"popper-class":"bs-el-pagination","current-page":e.current,"page-sizes":[10,20,50,100],"page-size":e.size,total:e.totalCount,background:"","prev-text":"上一页","next-text":"下一页",layout:"total, prev, pager, next,sizes"},on:{"size-change":e.sizeChangeHandle,"current-change":e.currentChangeHandle}})],1)]),a("el-tab-pane",{directives:[{name:"loading",rawName:"v-loading",value:e.tableLoading,expression:"tableLoading"}],attrs:{label:"数据集结构",name:"structure"}},[a("div",{staticClass:"bs-table-box"},[a("el-table",{attrs:{"max-height":"400",data:e.structurePreviewList,border:!0,align:"center"}},[a("el-table-column",{attrs:{align:"center","show-overflow-tooltip":"",prop:"fieldName",label:"字段值"}}),a("el-table-column",{attrs:{align:"center","show-overflow-tooltip":"",prop:"fieldType",label:"字段类型"}}),a("el-table-column",{attrs:{align:"center",prop:"fieldDesc",label:"字段描述"},scopedSlots:e._u([{key:"default",fn:function(t){return[e.isEdit?a("el-input",{staticClass:"labeldsc bs-el-input",attrs:{size:"small"},model:{value:t.row.fieldDesc,callback:function(a){e.$set(t.row,"fieldDesc",a)},expression:"scope.row.fieldDesc"}}):a("span",[e._v(e._s(t.row.fieldDesc))])]}}],null,!1,967602169)}),a("el-table-column",{attrs:{align:"center",prop:"orderNum",label:"字段排序",sortable:""},scopedSlots:e._u([{key:"default",fn:function(t){return[e.isEdit?a("el-input",{staticClass:"labeldsc bs-el-input",attrs:{size:"small"},model:{value:t.row.orderNum,callback:function(a){e.$set(t.row,"orderNum",a)},expression:"scope.row.orderNum"}}):a("span",[e._v(e._s(t.row.orderNum))])]}}],null,!1,327887513)}),a("el-table-column",{attrs:{align:"center",prop:"sourceTable",label:"字段来源"},scopedSlots:e._u([{key:"default",fn:function(t){return[e.isEdit?a("el-select",{staticClass:"bs-el-select",attrs:{"popper-class":"bs-el-select",clearable:"",filterable:""},model:{value:t.row.sourceTable,callback:function(a){e.$set(t.row,"sourceTable",a)},expression:"scope.row.sourceTable"}},e._l(e.tableNameList,(function(e){return a("el-option",{key:e,attrs:{label:e,value:e}})})),1):a("span",[e._v(e._s(t.row.sourceTable))])]}}],null,!1,270052133)})],1)],1)])],1)],1),a("el-dialog",{staticClass:"bs-dialog-wrap bs-el-dialog",attrs:{title:"提示",visible:e.fieldDescVisible,width:"420px","append-to-body":"","close-on-click-modal":!1,"custom-class":"fieldDescCheck"},on:{"update:visible":function(t){e.fieldDescVisible=t}}},[a("p",{staticStyle:{color:"var(--bs-el-text)","line-height":"24px","padding-left":"10px",display:"flex"}},[a("i",{staticClass:"el-icon-warning",staticStyle:{color:"#E6A23C","font-size":"24px","margin-right":"5px"}}),e._v(" 存在字段描述信息为空，请确认 ")]),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{staticClass:"bs-el-button-default",on:{click:e.fieldDescFill}},[e._v("使用字段名填充")]),a("el-button",{staticClass:"bs-el-button-default",on:{click:e.fieldDescEdit}},[e._v("进入编辑")]),a("el-button",{attrs:{type:"primary"},on:{click:e.toSave}},[e._v("继续保存")])],1)]),a("el-dialog",{staticClass:"bs-dialog-wrap bs-el-dialog",attrs:{title:"输出字段配置",visible:e.fieldsetVisible,width:"1000px","append-to-body":"","close-on-click-modal":!1,"before-close":e.cancelField},on:{"update:visible":function(t){e.fieldsetVisible=t}}},[a("div",{staticClass:"bs-table-box"},[a("el-table",{staticClass:"bs-el-table",attrs:{data:e.structurePreviewListCopy,border:!0,align:"center"}},[a("el-empty",{attrs:{slot:"empty"},slot:"empty"}),a("el-table-column",{attrs:{align:"left","show-overflow-tooltip":"",prop:"fieldName",label:"字段值"}}),a("el-table-column",{attrs:{align:"center","show-overflow-tooltip":"",prop:"fieldType",label:"字段类型"}}),a("el-table-column",{attrs:{align:"center",prop:"fieldDesc",label:"字段描述"},scopedSlots:e._u([{key:"default",fn:function(t){return[e.isEdit?a("el-input",{staticClass:"labeldsc bs-el-input",attrs:{size:"small"},model:{value:t.row.fieldDesc,callback:function(a){e.$set(t.row,"fieldDesc",a)},expression:"scope.row.fieldDesc"}}):a("span",[e._v(e._s(t.row.fieldDesc))])]}}])}),a("el-table-column",{attrs:{align:"center",prop:"orderNum",label:"字段排序",sortable:""},scopedSlots:e._u([{key:"default",fn:function(t){return[e.isEdit?a("el-input",{staticClass:"labeldsc bs-el-input",attrs:{size:"small"},model:{value:t.row.orderNum,callback:function(a){e.$set(t.row,"orderNum",a)},expression:"scope.row.orderNum"}}):a("span",[e._v(e._s(t.row.orderNum))])]}}])}),a("el-table-column",{attrs:{align:"center",prop:"sourceTable",label:"字段来源"},scopedSlots:e._u([{key:"default",fn:function(t){return[e.isEdit?a("el-select",{staticClass:"bs-el-select",attrs:{"popper-class":"bs-el-select",clearable:"",filterable:""},model:{value:t.row.sourceTable,callback:function(a){e.$set(t.row,"sourceTable",a)},expression:"scope.row.sourceTable"}},e._l(e.tableNameList,(function(e){return a("el-option",{key:e,attrs:{label:e,value:e}})})),1):a("span",[e._v(e._s(t.row.sourceTable))])]}}])}),e._t("output-field-table-column")],2)],1),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{staticClass:"bs-el-button-default",on:{click:e.cancelField}},[e._v(" 取消 ")]),a("el-button",{attrs:{type:"primary"},on:{click:e.setField}},[e._v(" 确定 ")])],1)]),a("el-dialog",{staticClass:"bs-dialog-wrap bs-el-dialog",attrs:{title:"SQL参数配置",visible:e.paramsVisible,width:"1000px","append-to-body":"","close-on-click-modal":!1,"before-close":e.cancelParam},on:{"update:visible":function(t){e.paramsVisible=t}}},[a("div",{staticClass:"bs-table-box"},[a("el-table",{ref:"singleTable",staticClass:"bs-el-table",attrs:{data:e.paramsListCopy,border:!0,align:"center"}},[a("el-empty",{attrs:{slot:"empty"},slot:"empty"}),a("el-table-column",{attrs:{prop:"name",label:"参数名称",align:"center"}}),a("el-table-column",{attrs:{prop:"type",label:"参数类型",align:"center",width:"200",filterable:""},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-select",{staticClass:"bs-el-select",attrs:{"popper-class":"bs-el-select",placeholder:"请选择"},model:{value:t.row.type,callback:function(a){e.$set(t.row,"type",a)},expression:"scope.row.type"}},e._l(e.typeSelect,(function(e){return a("el-option",{key:e.value,attrs:{label:e.value,value:e.value}})})),1)]}}])}),a("el-table-column",{attrs:{prop:"require",label:"是否必填",align:"center",width:"200",filterable:""},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-radio-group",{staticClass:"bs-el-radio-group",model:{value:t.row.require,callback:function(a){e.$set(t.row,"require",a)},expression:"scope.row.require"}},[a("el-radio",{attrs:{label:1}},[e._v(" 是 ")]),a("el-radio",{attrs:{label:0}},[e._v(" 否 ")])],1)]}}])}),a("el-table-column",{attrs:{prop:"value",label:"参数值",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-form",{ref:"form",attrs:{model:t.row}},[a("el-form-item",{staticClass:"form-item-value",attrs:{"show-message":1===t.row.require,prop:"value",rules:e.getRules(t.row)}},["Date"===t.row.type?a("el-date-picker",{attrs:{type:"datetime","value-format":"yyyy-MM-dd HH:mm:ss",placeholder:"选择日期时间"},model:{value:t.row.value,callback:function(a){e.$set(t.row,"value",a)},expression:"scope.row.value"}}):a("el-input",{staticClass:"bs-el-input",attrs:{clearable:"",placeholder:"请输入值"},model:{value:t.row.value,callback:function(a){e.$set(t.row,"value",a)},expression:"scope.row.value"}})],1)],1)]}}])}),a("el-table-column",{attrs:{prop:"remark",label:"备注",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-input",{staticClass:"bs-el-input",attrs:{clearable:"",placeholder:"请输入备注",rows:"2",maxlength:"200"},model:{value:t.row.remark,callback:function(a){e.$set(t.row,"remark",a)},expression:"scope.row.remark"}})]}}])}),a("el-table-column",{attrs:{label:"操作",width:"105",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-button",{staticClass:"no-border",staticStyle:{color:"#e47470"},attrs:{type:"text"},on:{click:function(a){return e.delRow(t.$index)}}},[e._v(" 删除 ")])]}}])},[a("template",{slot:"header"},[a("el-button",{staticClass:"no-border",attrs:{icon:"el-icon-plus",type:"text"},on:{click:e.addParam}},[e._v(" 添加 ")])],1)],2)],1)],1),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{staticClass:"bs-el-button-default",on:{click:e.cancelParam}},[e._v(" 取消 ")]),a("el-button",{attrs:{type:"primary"},on:{click:e.setParam}},[e._v(" 确定 ")])],1)])],1)],1)},lt=[],ot=(a(65137),a(59012),a(79866),a(16669)),nt=(a(54086),{name:"CustomEditForm",components:{codemirror:qe.codemirror,LabelSelect:ge},mixins:[We],data:function(){var e=this,t=function(t,a,s){h({id:e.datasetId,name:a,moduleCode:e.appCode}).then((function(e){e?s(new Error("数据集名称已存在")):s()}))};return{dataForm:{id:"",name:"",typeId:"",datasetType:"custom",remark:"",labelIds:[],sourceId:"",cache:0,sqlProcess:"select * from 表名称",paramsList:[],fieldDesc:{},fieldList:[],script:"",cacheCoherence:null,syntaxType:"normal"},rules:{name:[{required:!0,message:"请输入数据集名称",trigger:"blur"},{validator:t,trigger:"blur"}],sourceId:[{required:!0,message:"请选择数据源",trigger:"blur"}],typeId:[{required:!0,message:"请选择分组",trigger:"blur"}]},cOptions:{mode:"text/x-mysql",lineNumbers:!0,lineWrapping:!0,theme:"nord",extraKey:{Ctrl:"autocomplete"},hintOptions:{completeSingle:!0}},sourceList:[],activeName:"data",msg:"",exception:"",passTest:!1,paramsVisible:!1,tableNameList:[],paramsListCopy:[],isTest:!1}},computed:{checkPass:function(){return{sqlProcess:this.dataForm.sqlProcess,script:this.dataForm.script,paramsList:this.dataForm.paramsList}},noDataTableDisplayFields:function(){var e={};return this.structurePreviewList.forEach((function(t){e[t.fieldName]=""})),e},sortedStructurePreviewList:function(){var e=this.structurePreviewList;return e.sort((function(e,t){return e.orderNum-t.orderNum})),e},sortedTablePreviewList:function(){var e=this,t=this.dataPreviewList[0]?this.dataPreviewList[0]:this.noDataTableDisplayFields,a=Object.keys(t);return a.sort((function(t,a){return e.structurePreviewListCopy.findIndex((function(e){return e.fieldName===t}))-e.structurePreviewListCopy.findIndex((function(e){return e.fieldName===a}))})),a}},watch:{checkPass:{handler:function(e){this.passTest=!1},deep:!0}},mounted:function(){this.init()},methods:{init:function(){var e=this;return(0,B.Z)((0,A.Z)().mark((function t(){return(0,A.Z)().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,C({type:"dataset",moduleCode:e.appCode});case 2:if(e.categoryData=t.sent,e.typeId&&(e.dataForm.typeId=e.typeId,e.$nextTick((function(){try{e.typeName=e.$refs.categorySelectTree.getNode(e.dataForm.typeId).data.name}catch(t){console.error(t)}}))),e.getDataSource(),e.datasetId){t.next=7;break}return t.abrupt("return");case 7:w(e.datasetId).then((function(t){e.dataForm.id=t.id,e.dataForm.name=t.name,e.dataForm.typeId=t.typeId,e.dataForm.remark=t.remark,e.dataForm.datasetType=t.datasetType,e.dataForm.moduleCode=t.moduleCode,e.dataForm.editable=t.editable,e.dataForm.sourceId=t.sourceId,e.dataForm.cache=t.cache,e.dataForm.sqlProcess=t.config.sqlProcess,e.dataForm.paramsList=t.config.paramsList?t.config.paramsList:[],e.dataForm.fieldDesc=t.config.fieldDesc,e.dataForm.fieldList=t.config.fieldList,e.dataForm.cacheCoherence=t.config.cacheCoherence,e.dataForm.syntaxType=t.config.syntaxType?t.config.syntaxType:"normal",e.dataForm.name=e.datasetName,e.paramsListCopy=U()(e.dataForm.paramsList),e.dataForm.typeId&&e.$nextTick((function(){try{e.typeName=e.$refs.categorySelectTree.getNode(e.dataForm.typeId).data.name}catch(t){console.error(t)}})),e.datasetTest(!1)}));case 8:case"end":return t.stop()}}),t)})))()},getRules:function(e){return[{required:1===e.require,message:"参数值不能为空",trigger:["blur","change"]}]},getDataSource:function(){var e=this,t={sourceName:"",sourceType:"",moduleCode:this.appCode};(0,ot.Ax)(t).then((function(t){e.sourceList=t}))},openParamsConfig:function(){this.isTest=!1,this.paramsVisible=!0},delRow:function(e){this.paramsListCopy.splice(e,1)},addParam:function(){this.paramsListCopy.push({name:"",type:"",value:"",status:1,require:0,remark:""})},cancelParam:function(){this.paramsListCopy=U()(this.dataForm.paramsList),this.paramsVisible=!1},setParam:function(){for(var e=0;e<this.paramsListCopy.length;e++){var t=this.paramsListCopy[e];if(1===t.require&&(""===t.value||null===t.value))return void this.$message.error("第".concat(e+1,"行参数值不能为空"))}this.dataForm.paramsList=U()(this.paramsListCopy),this.isTest&&this.datasetTest(),this.paramsVisible=!1},save:function(e){var t=this,a=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!1!==this.passTest)if(this.structurePreviewList.length){if(!a){var s=this.structurePreviewList.some((function(e){return""===e.fieldDesc||!e.hasOwnProperty("fieldDesc")}));if(s)return void(this.fieldDescVisible=!0)}for(var i=/[\u4e00-\u9fa5]/,r=!1,l="",o=0;o<this.structurePreviewList.length;o++)if(i.test(this.structurePreviewList[o].fieldName)){r=!0,l=this.structurePreviewList[o].fieldName;break}r?this.$confirm("[".concat(l,"]字段中包含汉字, 是否保继续保存？"),"提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning",customClass:"bs-el-message-box"}).then((function(){t.saveFun(e)})).catch((function(){})):this.saveFun(e)}else this.$message.warning("该自助数据集未生成输出字段，请重新检查");else this.$message.error("请确保数据集SQL加工脚本不为空且运行通过")},saveFun:function(e){var t=this;this.$refs[e].validate((function(e){if(!e)return!1;if(t.dataForm.paramsList.length>0){var a=t.dataForm.paramsList.map((function(e){return e.name})),s=new Set(a);if(s.size!==a.length)return void t.$message.error("参数名称不能重复，请重新输入")}var i={};t.structurePreviewList.length>0&&(t.structurePreviewList.forEach((function(e){i[e.fieldName]=e.fieldDesc})),t.dataForm.fieldDesc=i),t.dataForm.fieldList=t.structurePreviewList,t.saveLoading=!0,t.saveText="正在保存...";var r=""===t.dataForm.id?g:v,l={id:t.dataForm.id,name:t.dataForm.name,typeId:t.dataForm.typeId,datasetType:"custom",remark:t.dataForm.remark,sourceId:t.dataForm.sourceId,cache:t.dataForm.cache,moduleCode:t.appCode,editable:t.appCode?1:0,labelIds:t.dataForm.labelIds,config:{className:"com.gccloud.dataset.entity.config.CustomDataSetConfig",sourceId:t.dataForm.sourceId,sqlProcess:t.dataForm.sqlProcess,paramsList:t.dataForm.paramsList,fieldList:t.dataForm.fieldList,fieldDesc:t.dataForm.fieldDesc,syntaxType:t.dataForm.syntaxType}};r(l).then((function(e){t.$message.success("保存成功"),t.$parent.init(!1),t.$parent.setType=null,t.saveLoading=!1,t.saveText="",t.goBack()})).catch((function(){t.saveLoading=!1,t.saveText=""})),t.saveLoading=!1,t.saveText=""}))},buildParamsAndRun:function(){var e=this;this.isTest=!0;var t=/\${(.*?)}/g,a=(0,l.Z)(new Set((0,l.Z)(this.dataForm.sqlProcess.matchAll(t)).map((function(e){return e[1]})))),s=/#{(.*?)}/g,i=(0,l.Z)(new Set((0,l.Z)(this.dataForm.sqlProcess.matchAll(s)).map((function(e){return e[1]}))));a.push.apply(a,(0,l.Z)(i));var r=this.dataForm.paramsList.map((function(e){return e.name})),o=[];a.forEach((function(t){if(r.includes(t)){var a=e.dataForm.paramsList.find((function(e){return e.name===t}));o.push(a)}else o.push({name:t,type:"String",value:"",status:1,require:0,remark:""})})),this.dataForm.paramsList=U()(o),this.paramsListCopy=U()(this.dataForm.paramsList),this.dataForm.paramsList.length?this.paramsVisible=!0:this.datasetTest()},datasetTest:function(){var e=this,t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];if(""!==this.dataForm.sourceId)if(""!==this.dataForm.sqlProcess){if(this.dataForm.paramsList.length>0){var a=this.dataForm.paramsList.map((function(e){return e.name})),s=new Set(a);if(s.size!==a.length)return void this.$message.error("参数名称不能重复，请重新输入")}!0===t&&(this.current=1),this.saveLoading=!0;var i={dataSourceId:this.dataForm.sourceId,script:this.dataForm.sqlProcess,params:this.dataForm.paramsList,dataSetType:"custom",syntaxType:this.dataForm.syntaxType,size:this.size,current:this.current};y(i).then((function(a){e.dataPreviewList=a.data.list,e.structurePreviewList=a.structure,e.structurePreviewList.forEach((function(t){var a=e.dataForm.fieldList.find((function(e){return e.fieldName===t.fieldName}));a&&(t.fieldDesc=a.fieldDesc,t.orderNum=a.orderNum,t.sourceTable=a.sourceTable)})),e.structurePreviewList.forEach((function(t){t.hasOwnProperty("orderNum")||e.$set(t,"orderNum",0),t.hasOwnProperty("sourceTable")||e.$set(t,"sourceTable",""),t.hasOwnProperty("fieldDesc")||e.$set(t,"fieldDesc","")})),e.totalCount=a.data.totalCount,e.tableNameList=a.tableNameList,e.tableNameList&&1===e.tableNameList.length&&e.structurePreviewList.forEach((function(t){t.sourceTable=e.tableNameList[0]})),e.structurePreviewListCopy=U()(e.structurePreviewList).sort((function(e,t){return e.orderNum-t.orderNum}));var s=!1;e.dataForm.paramsList.forEach((function(t){var a=e.structurePreviewList.filter((function(e){return e.fieldName===t.name}));a.length&&(s=!0)})),s?(e.$message.warning("参数名称不可以与字段名相同！"),e.passTest=!1):(t&&e.$message.success("脚本执行通过"),e.exception="",e.msg="",e.passTest=!0),e.saveLoading=!1})).catch((function(t){e.passTest=!1,e.saveLoading=!1}))}else this.$message.error("请输入数据集SQL加工脚本");else this.$message.error("请选择数据源")},selectorFilter:function(e){this.$refs.categorySelectTree.filter(e)},treeFilter:function(e,t){return!e||-1!==t.name.indexOf(e)}}}),ct=nt,dt=(0,E.Z)(ct,rt,lt,!1,null,"048d9a88",null),ut=dt.exports,pt=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{directives:[{name:"loading",rawName:"v-loading",value:e.saveLoading,expression:"saveLoading"}],staticClass:"inner-container",attrs:{"element-loading-text":e.saveText}},[a("el-scrollbar",{staticClass:"data-set-scrollbar"},[a("div",{staticClass:"header"},[a("el-page-header",{staticClass:"bs-el-page-header"},[a("template",{slot:"content"},[a("div",{staticClass:"page-header"},[a("div",{staticClass:"page-header-left"},[e._v(" "+e._s(e.isEdit?e.dataForm.id?"编辑原始数据集":"新增原始数据集":"原始数据集详情")+" ")]),a("div",{staticClass:"page-header-right"},[a("el-button",{staticClass:"bs-el-button-default",on:{click:function(t){return e.openNewWindow("https://www.yuque.com/chuinixiongkou/bigscreen/ry3ggnrts7q3ro1g")}}},[e._v(" 帮助 ")]),e.isEdit?a("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.save("form")}}},[e._v(" 保存 ")]):e._e(),a("el-button",{staticClass:"bs-el-button-default",on:{click:e.goBack}},[e._v(" 返回 ")])],1)])])],2)],1),a("el-row",{staticStyle:{margin:"16px 16px 0"}},[a("el-col",{attrs:{span:e.isEdit?16:24}},[a("el-form",{ref:"form",staticClass:"bs-el-form",staticStyle:{padding:"16px 16px 0"},attrs:{model:e.dataForm,rules:e.rules,"label-width":"120px"}},[a("el-row",{attrs:{gutter:20}},[a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:"数据集名称",prop:"name"}},[a("el-input",{staticClass:"bs-el-input",attrs:{clearable:"",disabled:!e.isEdit},model:{value:e.dataForm.name,callback:function(t){e.$set(e.dataForm,"name",t)},expression:"dataForm.name"}})],1)],1),a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:"分组",prop:"typeId"}},[a("el-select",{ref:"selectParentName",staticClass:"bs-el-select",attrs:{"popper-class":"bs-el-select",placeholder:"请选择分组",clearable:"",filterable:"",disabled:!e.isEdit,"filter-method":e.selectorFilter},on:{clear:e.clearType,"visible-change":e.setCurrentNode},model:{value:e.dataForm.typeId,callback:function(t){e.$set(e.dataForm,"typeId",t)},expression:"dataForm.typeId"}},[a("el-option",{staticStyle:{height:"auto",padding:"0"},attrs:{label:e.typeName,value:e.dataForm.typeId}},[a("div",[a("el-tree",{ref:"categorySelectTree",staticClass:"bs-el-tree",attrs:{data:e.categoryData,"node-key":"id",indent:0,props:{label:"name",children:"children"},"default-expand-all":!0,"highlight-current":!0,"expand-on-click-node":!1,"filter-node-method":e.treeFilter},on:{"node-click":e.selectParentCategory},scopedSlots:e._u([{key:"default",fn:function(t){var s=t.data;return a("span",{staticClass:"custom-tree-node"},[a("span",[a("i",{class:s.children&&s.children.length?"el-icon el-icon-folder":"el-icon el-icon-document"}),e._v(" "+e._s(s.name)+" ")])])}}])})],1)])],1)],1)],1)],1),a("el-row",{attrs:{gutter:20}},[a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:"数据源",prop:"sourceId"}},[a("el-select",{staticClass:"bs-el-select",attrs:{"popper-class":"bs-el-select",clearable:"",filterable:"",disabled:!e.isEdit},on:{change:e.setSource},model:{value:e.dataForm.sourceId,callback:function(t){e.$set(e.dataForm,"sourceId",t)},expression:"dataForm.sourceId"}},e._l(e.sourceList,(function(e){return a("el-option",{key:e.id,attrs:{label:e.sourceName,value:e.id}})})),1)],1)],1),a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:"关联原始表",prop:"tableName"}},[a("el-select",{directives:[{name:"loading",rawName:"v-loading",value:e.selectorLoading,expression:"selectorLoading"}],staticClass:"bs-el-select",attrs:{"element-loading-spinner":"el-icon-loading","popper-class":"bs-el-select",clearable:"",filterable:"",disabled:!e.isEdit},on:{change:e.setTable},model:{value:e.dataForm.tableName,callback:function(t){e.$set(e.dataForm,"tableName",t)},expression:"dataForm.tableName"}},[a("el-option-group",{attrs:{label:"表"}},e._l(e.tableList,(function(e){return a("el-option",{key:e.name,attrs:{label:e.name,value:e.name}})})),1),a("el-option-group",{attrs:{label:"视图"}},e._l(e.viewList,(function(e){return a("el-option",{key:e.name,attrs:{label:e.name,value:e.name}})})),1)],1)],1)],1)],1),a("el-row",{attrs:{gutter:20}},[a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:"输出字段",prop:"fieldInfo"}},[a("el-select",{staticClass:"bs-el-select",attrs:{"popper-class":"bs-el-select",placeholder:"请选择字段（为空时默认选择全部字段）",clearable:"",filterable:"",multiple:"","collapse-tags":"",disabled:!e.isEdit},on:{change:e.setFields},model:{value:e.dataForm.fieldInfo,callback:function(t){e.$set(e.dataForm,"fieldInfo",t)},expression:"dataForm.fieldInfo"}},[e.fieldList.length?a("el-option",{attrs:{label:"全选",value:"全选"}},[a("el-checkbox",{nativeOn:{click:function(e){e.preventDefault()}},model:{value:e.isSelectAll,callback:function(t){e.isSelectAll=t},expression:"isSelectAll"}},[e._v(" 全选 ")])],1):e._e(),e._l(e.fieldList,(function(t){return a("el-option",{key:t.columnName,attrs:{label:t.columnName,value:t.columnName}},[a("el-checkbox",{nativeOn:{click:function(e){e.preventDefault()}},model:{value:t.isCheck,callback:function(a){e.$set(t,"isCheck",a)},expression:"field.isCheck"}},[e._v(" "+e._s(t.columnName)+" ")])],1)}))],2)],1)],1),a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:"是否去重",prop:"repeatStatus"}},[a("el-radio-group",{staticClass:"bs-el-radio-group",attrs:{disabled:!e.isEdit},on:{change:e.repeatStatusChange},model:{value:e.dataForm.repeatStatus,callback:function(t){e.$set(e.dataForm,"repeatStatus",t)},expression:"dataForm.repeatStatus"}},[a("el-radio",{attrs:{label:1}},[e._v(" 是 ")]),a("el-radio",{attrs:{label:0}},[e._v(" 否 ")])],1)],1)],1)],1),a("el-row",{attrs:{gutter:20}},[a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:"备注",prop:"remark"}},[a("el-input",{staticClass:"bs-el-input",attrs:{disabled:!e.isEdit},model:{value:e.dataForm.remark,callback:function(t){e.$set(e.dataForm,"remark",t)},expression:"dataForm.remark"}})],1)],1),a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:"缓存",prop:"cache"}},[a("el-radio-group",{staticClass:"bs-el-radio-group",model:{value:e.dataForm.cache,callback:function(t){e.$set(e.dataForm,"cache",t)},expression:"dataForm.cache"}},[a("el-radio",{attrs:{label:1}},[e._v(" 开启 ")]),a("el-radio",{attrs:{label:0}},[e._v(" 关闭 ")])],1),a("el-tooltip",{staticClass:"item",attrs:{effect:"light",content:"开启缓存:会在首次调用该数据集时，将结果缓存，在接下来的十分钟内，若再次被调用则直接返回缓存中的数据，注意：在当前数据集编辑页面缓存不生效",placement:"top"}},[a("i",{staticClass:"el-icon-warning-outline",staticStyle:{color:"#E3C98C","margin-left":"16px","font-size":"14px"}})])],1)],1)],1),a("el-row",[a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:"标签",prop:"labelIds"}},[a("LabelSelect",{attrs:{"dataset-id":e.datasetId,"id-list":e.dataForm.labelIds},on:{commit:function(t){e.dataForm.labelIds=t}}})],1)],1)],1)],1)],1),e.isEdit?a("el-col",{attrs:{span:8}},[a("div",{staticClass:"structure"},[a("div",{staticClass:"title-style bs-title-style"},[e._v(" 输出字段 "),a("el-button",{staticStyle:{float:"right",border:"none","margin-top":"-4px"},attrs:{type:"text"},on:{click:function(t){e.fieldsetVisible=!0}}},[e._v(" 配置 ")])],1),a("div",{staticClass:"field-wrap bs-field-wrap bs-scrollbar"},e._l(e.sortedStructurePreviewList,(function(t){return a("div",{key:t.fieldName,staticClass:"field-item",on:{click:function(t){e.fieldsetVisible=!0}}},[a("span",[e._v(e._s(t.fieldName))]),e._v(" "),a("span",{directives:[{name:"show",rawName:"v-show",value:t.fieldDesc,expression:"field.fieldDesc"}],staticStyle:{color:"#909399"}},[e._v(" ("+e._s(t.fieldDesc)+") ")]),a("el-button",{staticClass:"edit_field",staticStyle:{float:"right",border:"none","margin-top":"2px"},attrs:{type:"text"},on:{click:function(t){e.fieldsetVisible=!0}}},[e._v(" 配置 ")])],1)})),0)])]):e._e()],1),e.isEdit?a("div",{staticClass:"dataPreView",staticStyle:{"margin-top":"12px"}},[a("div",{staticClass:"result-view"},[e._v(" 数据预览 ")]),a("div",{directives:[{name:"loading",rawName:"v-loading",value:e.tableLoading,expression:"tableLoading"}],staticClass:"bs-table-box is-Edit bs-scrollbar"},[a("el-table",{staticClass:"bs-el-table bs-scrollbar",attrs:{align:"center",data:e.dataPreviewList,"max-height":"100%",border:!0}},e._l(e.sortedTablePreviewList,(function(t,s){return a("el-table-column",{key:s,attrs:{label:t,align:"center","show-overflow-tooltip":"","render-header":e.renderHeader},scopedSlots:e._u([{key:"default",fn:function(s){return[a("span",[e._v(e._s(s.row[t]))])]}}],null,!0)})})),1)],1),a("div",{staticClass:"bs-pagination"},[a("el-pagination",{staticClass:"bs-el-pagination",attrs:{"popper-class":"bs-el-pagination","current-page":e.current,"page-sizes":[10,20,50,100],"page-size":e.size,total:e.totalCount,background:"","prev-text":"上一页","next-text":"下一页",layout:"total, prev, pager, next,sizes"},on:{"size-change":e.sizeChangeHandle,"current-change":e.currentChangeHandle}})],1)]):e._e(),a("el-dialog",{staticClass:"bs-dialog-wrap bs-el-dialog",attrs:{title:"提示",visible:e.fieldDescVisible,width:"420px","append-to-body":"","close-on-click-modal":!1,"custom-class":"fieldDescCheck"},on:{"update:visible":function(t){e.fieldDescVisible=t}}},[a("p",{staticStyle:{color:"var(--bs-el-text)","line-height":"24px","padding-left":"10px",display:"flex"}},[a("i",{staticClass:"el-icon-warning",staticStyle:{color:"#E6A23C","font-size":"24px","margin-right":"5px"}}),e._v("存在字段描述信息为空，请确认 ")]),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{staticClass:"bs-el-button-default",on:{click:e.fieldDescFill}},[e._v("使用字段名填充")]),a("el-button",{staticClass:"bs-el-button-default",on:{click:e.fieldDescEdit}},[e._v("进入编辑")]),a("el-button",{attrs:{type:"primary"},on:{click:e.toSave}},[e._v("继续保存")])],1)]),a("el-dialog",{staticClass:"bs-dialog-wrap bs-el-dialog",attrs:{title:"输出字段配置",visible:e.fieldsetVisible,width:"1000px","append-to-body":"","close-on-click-modal":!1,"before-close":e.cancelField},on:{"update:visible":function(t){e.fieldsetVisible=t}}},[a("div",{staticClass:"bs-table-box"},[a("el-table",{staticClass:"bs-el-table",attrs:{data:e.structurePreviewListCopy,border:!0,align:"center"}},[a("el-empty",{attrs:{slot:"empty"},slot:"empty"}),a("el-table-column",{attrs:{align:"left","show-overflow-tooltip":"",prop:"fieldName",label:"字段值"}}),a("el-table-column",{attrs:{align:"center","show-overflow-tooltip":"",prop:"fieldType",label:"字段类型"}}),a("el-table-column",{attrs:{align:"center",prop:"fieldDesc",label:"字段描述"},scopedSlots:e._u([{key:"default",fn:function(t){return[e.isEdit?a("el-input",{staticClass:"labeldsc bs-el-input",attrs:{size:"small"},model:{value:t.row.fieldDesc,callback:function(a){e.$set(t.row,"fieldDesc",a)},expression:"scope.row.fieldDesc"}}):a("span",[e._v(e._s(t.row.fieldDesc))])]}}])}),a("el-table-column",{attrs:{align:"center",prop:"orderNum",label:"字段排序",sortable:""},scopedSlots:e._u([{key:"default",fn:function(t){return[e.isEdit?a("el-input",{staticClass:"labeldsc bs-el-input",attrs:{size:"small"},model:{value:t.row.orderNum,callback:function(a){e.$set(t.row,"orderNum",a)},expression:"scope.row.orderNum"}}):a("span",[e._v(e._s(t.row.orderNum))])]}}])}),a("el-table-column",{attrs:{align:"center",prop:"sourceTable",label:"字段来源"}}),e._t("output-field-table-column")],2)],1),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{staticClass:"bs-el-button-default",on:{click:e.cancelField}},[e._v(" 取消 ")]),a("el-button",{attrs:{type:"primary"},on:{click:e.setField}},[e._v(" 确定 ")])],1)])],1)],1)},mt=[],ft=(a(6203),a(73964),{name:"OriginalEditForm",components:{LabelSelect:ge},mixins:[We],data:function(){var e=this,t=function(t,a,s){h({id:e.datasetId,name:a,moduleCode:e.appCode}).then((function(e){e?s(new Error("数据集名称已存在")):s()}))};return{dataForm:{id:"",name:"",typeId:"",datasetType:"original",remark:"",cache:0,labelIds:[],sourceId:"",repeatStatus:1,tableName:"",fieldInfo:[],fieldDesc:{},fieldList:[]},rules:{name:[{required:!0,message:"数据集名称不能为空",trigger:"blur"},{validator:t,trigger:"blur"}],sourceId:[{required:!0,message:"请选择数据源",trigger:"blur"}],tableName:[{required:!0,message:"请选择原始表",trigger:"change"}],repeatStatus:[{required:!0,message:"请选择是否去重",trigger:"blur"}],typeId:[{required:!0,message:"请选择分组",trigger:"blur"}]},sourceList:[],tableList:[],viewList:[],fieldList:[],isSelectAll:!1,activeName:"data",currentCount:0,selectorLoading:!1,oldStructurePreviewList:[],isInit:!1}},computed:{noDataTableDisplayFields:function(){var e={};return this.structurePreviewList.forEach((function(t){e[t.fieldName]=""})),e},sortedTablePreviewList:function(){var e=this,t=this.dataPreviewList[0]?this.dataPreviewList[0]:this.noDataTableDisplayFields,a=Object.keys(t);return a.sort((function(t,a){return e.structurePreviewListCopy.findIndex((function(e){return e.fieldName===t}))-e.structurePreviewListCopy.findIndex((function(e){return e.fieldName===a}))})),a},sortedStructurePreviewList:function(){var e=this.structurePreviewList;return e.sort((function(e,t){return e.orderNum-t.orderNum})),e}},watch:{"dataForm.fieldInfo":{handler:function(e){try{this.setCheck();var t={};this.fieldList.forEach((function(a){(0===e.length||e.includes(a.columnName))&&(t[a.columnName]=a.columnComment)})),this.getPreViewData(t)}catch(a){console.error(a)}},deep:!0,immediate:!0},sortedStructurePreviewList:function(e){this.structurePreviewListCopy=U()(e)}},mounted:function(){this.init()},methods:{init:function(){var e=this;return(0,B.Z)((0,A.Z)().mark((function t(){return(0,A.Z)().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,C({type:"dataset",moduleCode:e.appCode});case 2:if(e.categoryData=t.sent,e.typeId&&(e.dataForm.typeId=e.typeId,e.$nextTick((function(){try{e.typeName=e.$refs.categorySelectTree.getNode(e.dataForm.typeId).data.name}catch(t){console.error(t)}}))),e.queryAllSource(),e.datasetId){t.next=7;break}return t.abrupt("return");case 7:w(e.datasetId).then((function(t){e.dataForm.id=t.id,e.dataForm.name=t.name,e.dataForm.typeId=t.typeId,e.dataForm.remark=t.remark,e.dataForm.cache=t.cache,e.dataForm.datasetType=t.datasetType,e.dataForm.moduleCode=t.moduleCode,e.dataForm.editable=t.editable,e.dataForm.sourceId=t.sourceId,e.dataForm.tableName=t.config.tableName,e.dataForm.repeatStatus=t.config.repeatStatus,e.dataForm.fieldList=t.config.fieldList,e.dataForm.fieldDesc=t.config.fieldDesc,e.oldStructurePreviewList=U()(t.config.fieldList),e.dataForm.fieldInfo=t.config.fieldInfo?t.config.fieldInfo.split(","):[],e.dataForm.typeId&&e.$nextTick((function(){try{e.typeName=e.$refs.categorySelectTree.getNode(e.dataForm.typeId).data.name}catch(t){console.error(t)}})),e.isInit=!0,e.queryAllTable(),e.queryAllField()}));case 8:case"end":return t.stop()}}),t)})))()},getData:function(){var e=this,t=[];0===this.dataForm.fieldInfo.length&&(t=this.fieldList.map((function(e){return e.columnName})));var a={dataSourceId:this.dataForm.sourceId,script:JSON.stringify({fieldInfo:0===this.dataForm.fieldInfo.length?t:this.dataForm.fieldInfo,tableName:this.dataForm.tableName,repeatStatus:this.dataForm.repeatStatus}),params:[],dataSetType:"original",size:this.size,current:this.current};this.tableLoading=!0,y(a).then((function(t){null==e.dataForm.fieldList&&(e.dataForm.fieldList=U()(t.structure)),e.dataPreviewList=U()(t.data.list),e.totalCount=t.data.totalCount,e.tableLoading=!1})).catch((function(){e.dataPreviewList=[],e.totalCount=0,e.tableLoading=!1}))},save:function(e){var t=this,a=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this.structurePreviewList.length){if(!a){var s=this.structurePreviewList.some((function(e){return""===e.fieldDesc}));if(s)return void(this.fieldDescVisible=!0)}this.$refs[e].validate((function(e){if(!e)return t.saveLoading=!1,t.saveText="",!1;var a={};t.structurePreviewList.forEach((function(e){a[e.fieldName]=e.fieldDesc}));var s={id:t.dataForm.id,name:t.dataForm.name,typeId:t.dataForm.typeId,remark:t.dataForm.remark,cache:t.dataForm.cache,datasetType:"original",sourceId:t.dataForm.sourceId,labelIds:t.dataForm.labelIds,config:{className:"com.gccloud.dataset.entity.config.OriginalDataSetConfig",sourceId:t.dataForm.sourceId,tableName:t.dataForm.tableName,fieldInfo:t.dataForm.fieldInfo.length?t.dataForm.fieldInfo.join(","):"",fieldDesc:a,fieldList:t.structurePreviewList,repeatStatus:t.dataForm.repeatStatus},moduleCode:t.appCode,editable:t.appCode?1:0};t.saveLoading=!0,t.saveText="正在保存...";var i=t.dataForm.id?v:g;i(s).then((function(e){t.goBack(),t.$message.success("保存成功"),t.$parent.init(!1),t.$parent.setType=null,t.saveLoading=!1,t.saveText=""})).catch((function(){t.$message.error("保存失败"),t.saveLoading=!1,t.saveText=""}))}))}else this.$message.warning("该原始数据集未生成输出字段，请重新检查")},queryAllSource:function(){var e=this,t={sourceName:"",sourceType:"",moduleCode:this.appCode};(0,ot.Ax)(t).then((function(t){e.sourceList=t}))},setSource:function(e){this.dataForm.tableName="",this.dataForm.fieldInfo=[],this.tableList=[],this.fieldList=[],this.dataForm.sourceId&&this.queryAllTable()},queryAllTable:function(){var e=this;(0,ot.ZK)(this.dataForm.sourceId).then((function(t){e.tableList=t})).catch((function(){e.tableList=[]})),this.selectorLoading=!0,(0,ot.VZ)(this.dataForm.sourceId).then((function(t){e.viewList=t,e.selectorLoading=!1})).catch((function(){e.viewList=[],e.selectorLoading=!1}))},setTable:function(e){var t=this;return(0,B.Z)((0,A.Z)().mark((function e(){return(0,A.Z)().wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(t.fieldList=[],t.dataForm.tableName){e.next=4;break}return t.dataForm.fieldInfo=[],e.abrupt("return");case 4:return e.next=6,t.queryAllField();case 6:t.dataForm.fieldInfo=[];case 7:case"end":return e.stop()}}),e)})))()},repeatStatusChange:function(){this.getPreViewData()},queryAllField:function(){var e=this;return new Promise((function(t,a){(0,ot.FD)(e.dataForm.sourceId,e.dataForm.tableName).then((function(a){var s={};e.fieldList=a.map((function(t){return s[t.columnName]=t.columnComment,t.isCheck=!1,e.dataForm.fieldInfo.includes(t.columnName)&&(t.isCheck=!0),t})),t()})).catch((function(){e.fieldList=[],a()}))}))},setFields:function(e){e.includes("全选")&&(e.length>this.fieldList.length?this.dataForm.fieldInfo=[]:this.dataForm.fieldInfo=this.fieldList.map((function(e){return e.columnName})))},setCheck:function(){var e=this;this.fieldList.forEach((function(t){e.dataForm.fieldInfo.includes(t.columnName)?t.isCheck=!0:t.isCheck=!1})),this.fieldList.length&&this.dataForm.fieldInfo.length===this.fieldList.length?this.isSelectAll=!0:this.isSelectAll=!1},getPreViewData:function(e){var t=this;if(this.dataPreviewList=[],this.structurePreviewList=[],this.structurePreviewListCopy=[],this.dataForm.sourceId&&this.dataForm.tableName){var a=[];0===this.dataForm.fieldInfo.length&&(a=this.fieldList.map((function(e){return e.columnName})));var s={dataSourceId:this.dataForm.sourceId,script:JSON.stringify({fieldInfo:this.dataForm.fieldInfo.length?this.dataForm.fieldInfo:a,tableName:this.dataForm.tableName,repeatStatus:this.dataForm.repeatStatus}),params:[],dataSetType:"original",size:this.size,current:this.current};this.tableLoading=!0,y(s).then((function(a){t.dataPreviewList=a.data.list,t.structurePreviewList=a.structure,t.isInit?(t.structurePreviewList=t.dataForm.fieldList,t.isInit=!1):t.structurePreviewList.forEach((function(a){if(a.hasOwnProperty("orderNum")||t.$set(a,"orderNum",0),a.hasOwnProperty("sourceTable")||t.$set(a,"sourceTable",t.dataForm.tableName),!a.hasOwnProperty("fieldDesc")){var s="";e&&e[a.fieldName]&&(s=e[a.fieldName]),t.$set(a,"fieldDesc",s),t.structurePreviewList.forEach((function(e){var a=t.oldStructurePreviewList.find((function(t){return t.fieldName===e.fieldName}));a&&a.fieldDesc&&(e.fieldDesc=a.fieldDesc)}))}})),t.structurePreviewListCopy=U()(t.structurePreviewList).sort((function(e,t){return e.orderNum-t.orderNum})),t.totalCount=a.data.totalCount,t.currentCount=a.data.currentCount,t.tableLoading=!1})).catch((function(e){t.dataPreviewList=[],t.structurePreviewList=[],t.structurePreviewListCopy=[],t.totalCount=0,t.currentCount=0,t.tableLoading=!1}))}},sizeChangeHandle:function(e){this.size=e,this.current=1,this.getData()},currentChangeHandle:function(e){this.current=e,this.getData()},selectorFilter:function(e){this.$refs.categorySelectTree.filter(e)},treeFilter:function(e,t){return!e||-1!==t.name.indexOf(e)},setField:function(){this.structurePreviewList=U()(this.structurePreviewListCopy),this.oldStructurePreviewList=U()(this.structurePreviewListCopy),this.fieldsetVisible=!1}}}),bt=ft,ht=(0,E.Z)(bt,pt,mt,!1,null,"3f91f218",null),gt=ht.exports,vt=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"inner-container",attrs:{"element-loading-text":e.saveText}},[a("el-scrollbar",{staticClass:"data-set-scrollbar"},[a("div",{staticClass:"header"},[a("el-page-header",{staticClass:"bs-el-page-header"},[a("template",{slot:"content"},[a("div",{staticClass:"page-header"},[a("div",{staticClass:"page-header-left"},[e._v(" "+e._s(e.isEdit?e.dataForm.id?"编辑HTTP数据集":"新增HTTP数据集":"HTTP数据集详情")+" ")]),a("div",{staticClass:"page-header-right"},[a("el-button",{staticClass:"bs-el-button-default",on:{click:function(t){return e.openNewWindow("https://www.yuque.com/chuinixiongkou/bigscreen/htag6vmt5oin15ib")}}},[e._v(" 帮助 ")]),e.isEdit?a("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.save("form")}}},[e._v(" 保存 ")]):e._e(),a("el-button",{staticClass:"bs-el-button-default",on:{click:e.goBack}},[e._v(" 返回 ")])],1)])])],2)],1),a("el-row",{staticStyle:{margin:"16px 16px 0"}},[a("el-col",{attrs:{span:e.isEdit?16:24}},[a("el-form",{ref:"form",staticClass:"bs-el-form",staticStyle:{padding:"16px 16px 0"},attrs:{model:e.dataForm,rules:e.rules,"label-width":"120px"}},[a("el-row",{attrs:{gutter:20}},[a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:"数据集名称",prop:"name"}},[a("el-input",{staticClass:"bs-el-input",attrs:{clearable:"",disabled:!e.isEdit},model:{value:e.dataForm.name,callback:function(t){e.$set(e.dataForm,"name",t)},expression:"dataForm.name"}})],1)],1),a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:"分组",prop:"typeId"}},[a("el-select",{ref:"selectParentName",staticClass:"bs-el-select",attrs:{"popper-class":"bs-el-select",placeholder:"请选择分组",filterable:"",clearable:"",disabled:!e.isEdit},on:{clear:e.clearType,"visible-change":e.setCurrentNode},model:{value:e.dataForm.typeId,callback:function(t){e.$set(e.dataForm,"typeId",t)},expression:"dataForm.typeId"}},[a("el-option",{staticStyle:{height:"auto",padding:"0"},attrs:{label:e.typeName,value:e.dataForm.typeId}},[a("div",{staticClass:"tree-box"},[a("el-tree",{ref:"categorySelectTree",staticClass:"bs-el-tree",attrs:{data:e.categoryData,"node-key":"id",indent:0,props:{label:"name",children:"children"},"default-expand-all":!0,"highlight-current":!0,"expand-on-click-node":!1},on:{"node-click":e.selectParentCategory},scopedSlots:e._u([{key:"default",fn:function(t){var s=t.data;return a("span",{staticClass:"custom-tree-node"},[a("span",[a("i",{class:s.children&&s.children.length?"el-icon el-icon-folder":"el-icon el-icon-document"}),e._v(" "+e._s(s.name)+" ")])])}}])})],1)])],1)],1)],1)],1),a("el-row",{attrs:{gutter:20}},[a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:"备注",prop:"remark"}},[a("el-input",{staticClass:"bs-el-input",attrs:{disabled:!e.isEdit},model:{value:e.dataForm.remark,callback:function(t){e.$set(e.dataForm,"remark",t)},expression:"dataForm.remark"}})],1)],1),a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:"调用方式",prop:"config.requestType"}},[a("el-select",{staticClass:"bs-el-select",attrs:{"popper-class":"bs-el-select"},on:{change:function(t){return e.changeRequestType(t)}},model:{value:e.dataForm.config.requestType,callback:function(t){e.$set(e.dataForm.config,"requestType",t)},expression:"dataForm.config.requestType"}},[a("el-option",{attrs:{label:"前台代理",value:"frontend"}}),a("el-option",{attrs:{label:"后台代理",value:"backend"}})],1)],1)],1)],1),a("el-row",[a("el-col",{attrs:{span:24}},[a("el-form-item",{staticClass:"bs-el-input-url",attrs:{label:"请求地址",prop:"config.url"}},[a("el-input",{staticClass:"bs-el-input",attrs:{autocomplete:"off",placeholder:"请输入请求地址",clearable:""},model:{value:e.dataForm.config.url,callback:function(t){e.$set(e.dataForm.config,"url",t)},expression:"dataForm.config.url"}})],1)],1)],1),a("el-row",[a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:"请求类型",prop:"config.method"}},[a("el-radio-group",{staticClass:"bs-el-radio-group",model:{value:e.dataForm.config.method,callback:function(t){e.$set(e.dataForm.config,"method",t)},expression:"dataForm.config.method"}},[a("el-radio",{attrs:{label:"get"}},[e._v(" GET ")]),a("el-radio",{attrs:{label:"post"}},[e._v(" POST ")])],1)],1)],1),a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:"标签",prop:"labelIds"}},[a("LabelSelect",{attrs:{"dataset-id":e.datasetId,"id-list":e.dataForm.labelIds},on:{commit:function(t){e.dataForm.labelIds=t}}})],1)],1)],1),"backend"===e.dataForm.config.requestType?a("el-row",[a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:"缓存",prop:"cache"}},[a("el-radio-group",{staticClass:"bs-el-radio-group",model:{value:e.dataForm.cache,callback:function(t){e.$set(e.dataForm,"cache",t)},expression:"dataForm.cache"}},[a("el-radio",{attrs:{label:1}},[e._v(" 开启 ")]),a("el-radio",{attrs:{label:0}},[e._v(" 关闭 ")])],1),a("el-tooltip",{staticClass:"item",attrs:{effect:"light",content:"开启缓存:会在首次调用该数据集时，将结果缓存，在接下来的十分钟内，若再次被调用则直接返回缓存中的数据，注意：在当前数据集编辑页面缓存不生效",placement:"top"}},[a("i",{staticClass:"el-icon-warning-outline",staticStyle:{color:"#E3C98C","margin-left":"16px","font-size":"14px"}})])],1)],1)],1):e._e(),a("el-tabs",{staticClass:"bs-el-tabs tabs-box",model:{value:e.activeName,callback:function(t){e.activeName=t},expression:"activeName"}},[a("el-tab-pane",{attrs:{label:"请求头",name:"head"}},[a("el-form-item",{attrs:{prop:"config.headers","label-width":"0px"}},[e._l(e.dataForm.config.headers,(function(t,s){return a("el-row",{key:s,attrs:{gutter:10,span:24}},[a("el-col",{attrs:{span:11}},[a("el-form-item",{attrs:{label:"键",prop:"config.headers."+s+".key","label-width":"50px",rules:e.rules.key}},[a("el-input",{staticClass:"bs-el-input",attrs:{placeholder:"请输入键",clearable:""},on:{blur:function(t){e.dataForm.config.headers[s].key=e.inputChange(t)}},model:{value:e.dataForm.config.headers[s].key,callback:function(t){e.$set(e.dataForm.config.headers[s],"key",t)},expression:"dataForm.config.headers[index].key"}})],1)],1),a("el-col",{attrs:{span:11}},[a("el-form-item",{attrs:{label:"值",prop:"config.headers."+s+".value","label-width":"50px",rules:e.rules.value}},[a("el-input",{staticClass:"bs-el-input",attrs:{placeholder:"请输入值",clearable:""},on:{blur:function(t){e.dataForm.config.headers[s].value=e.inputChange(t)}},model:{value:e.dataForm.config.headers[s].value,callback:function(t){e.$set(e.dataForm.config.headers[s],"value",t)},expression:"dataForm.config.headers[index].value"}})],1)],1),a("el-col",{staticStyle:{"text-align":"center"},attrs:{span:2}},[a("span",{staticClass:"delete-btn",on:{click:function(t){return e.delHeader(s)}}},[e._v(" 移除 ")])])],1)})),a("el-row",[a("el-col",{attrs:{span:12,offset:6}},[a("div",{staticClass:"add-btn",on:{click:e.addHeader}},[e._v(" 增加 ")])])],1)],2)],1),a("el-tab-pane",{attrs:{label:"请求参数",name:"param"}},[a("el-form-item",{attrs:{prop:"config.params","label-width":"0px",rules:"get"===e.dataForm.config.method?e.rules.params:[{required:!1}]}},[e._l(e.dataForm.config.params,(function(t,s){return a("el-row",{key:s,attrs:{gutter:10,span:24}},[a("el-col",{attrs:{span:11}},[a("el-form-item",{attrs:{label:"键",prop:"config.params."+s+".key","label-width":"50px",rules:e.rules.key}},[a("el-input",{staticClass:"bs-el-input",attrs:{placeholder:"请输入键",clearable:""},on:{blur:function(t){e.dataForm.config.params[s].key=e.inputChange(t)}},model:{value:e.dataForm.config.params[s].key,callback:function(t){e.$set(e.dataForm.config.params[s],"key",t)},expression:"dataForm.config.params[index].key"}})],1)],1),a("el-col",{attrs:{span:11}},[a("el-form-item",{attrs:{label:"值",prop:"config.params."+s+".value","label-width":"50px",rules:e.rules.value}},[a("el-input",{staticClass:"bs-el-input",attrs:{placeholder:"请输入值",clearable:""},on:{blur:function(t){e.dataForm.config.params[s].value=e.inputChange(t)}},model:{value:e.dataForm.config.params[s].value,callback:function(t){e.$set(e.dataForm.config.params[s],"value",t)},expression:"dataForm.config.params[index].value"}})],1)],1),a("el-col",{staticStyle:{"text-align":"center"},attrs:{span:2}},[a("span",{staticClass:"delete-btn",on:{click:function(t){return e.delParam(s)}}},[e._v(" 移除 ")])])],1)})),a("el-row",[a("el-col",{attrs:{span:12,offset:6}},[a("div",{staticClass:"add-btn",on:{click:e.addParam}},[e._v(" 增加 ")])])],1)],2)],1),"post"===e.dataForm.config.method?a("el-tab-pane",{attrs:{label:"请求体",name:"second"}},[a("el-form-item",{attrs:{prop:"requestScript","label-width":"0px"}},[a("el-input",{staticClass:"bs-el-input",attrs:{type:"textarea",autosize:{minRows:10,maxRows:10},clearable:""},model:{value:e.dataForm.config.body,callback:function(t){e.$set(e.dataForm.config,"body",t)},expression:"dataForm.config.body"}}),a("div",{staticClass:"bs-codemirror-bottom-text"},[a("strong",[e._v("请求体设置规则： 请在脚本中直接输入请求体内容，如涉及变量，请按照${XX}格式进行设置"),a("br"),e._v(" 例如："),a("span",{staticStyle:{color:"red"}},[e._v('{"name":${name}}')])])])],1)],1):e._e(),a("el-tab-pane",{attrs:{label:"请求脚本",name:"reqScript"}},[a("el-form-item",{attrs:{prop:"requestScript","label-width":"0px"}},["reqScript"===e.activeName?a("codemirror",{staticClass:"code",attrs:{options:e.codemirrorOption},model:{value:e.dataForm.config.requestScript,callback:function(t){e.$set(e.dataForm.config,"requestScript","string"===typeof t?t.trim():t)},expression:"dataForm.config.requestScript"}}):e._e(),a("div",{staticClass:"bs-codemirror-bottom-text"},[e._v(" prometheus快捷设置: "),a("el-button",{attrs:{type:"text"},on:{click:function(t){return e.setRange(5)}}},[e._v("5分钟")]),a("el-button",{attrs:{type:"text"},on:{click:function(t){return e.setRange(15)}}},[e._v("15分钟")]),a("el-button",{attrs:{type:"text"},on:{click:function(t){return e.setRange(30)}}},[e._v("半小时")]),a("el-button",{attrs:{type:"text"},on:{click:function(t){return e.setRange(60)}}},[e._v("1小时")]),a("el-button",{attrs:{type:"text"},on:{click:function(t){return e.setRange(600)}}},[e._v("6小时")]),a("br"),a("strong",[e._v("请求脚本设置规则： 请求脚本已经内置参数req，可参考下面的示例进行配置: "),a("br"),e._v(" 如修改请求地址中对应参数 : "),a("span",{staticStyle:{color:"red"}},[e._v("req.url.age=17")]),a("br"),e._v(" 如修改请求头中对应参数 : "),a("span",{staticStyle:{color:"red"}},[e._v("req.headers.name='tom'")]),a("br"),e._v(" 如修改请求参数中对应参数 : "),a("span",{staticStyle:{color:"red"}},[e._v("req.params.age=17")]),a("br"),e._v(" 如修改请求体中对应参数 : "),a("span",{staticStyle:{color:"red"}},[e._v('req.data=\'{"name":"223"}\'')])])],1)],1)],1),a("el-tab-pane",{attrs:{label:"响应脚本",name:"respScript"}},[a("el-form-item",{attrs:{prop:"responseScript","label-width":"0px"}},["respScript"===e.activeName?a("codemirror",{staticClass:"code",attrs:{options:e.codemirrorOption},model:{value:e.dataForm.config.responseScript,callback:function(t){e.$set(e.dataForm.config,"responseScript","string"===typeof t?t.trim():t)},expression:"dataForm.config.responseScript"}}):e._e(),"frontend"===e.dataForm.config.requestType?a("div",{staticClass:"bs-codemirror-bottom-text"},[a("strong",[a("el-button",{attrs:{type:"text"},on:{click:e.setPrometheus}},[e._v("点击设置Prometheus")]),a("br"),e._v("响应脚本设置规则： 接口返回数据已经内置到参数resp中，可直接使用，但是必须要返回设置后的数据。"),a("br"),e._v(" 例如："),a("span",{staticStyle:{color:"red"}},[e._v("return resp.data")])],1)]):a("div",{staticClass:"bs-codemirror-bottom-text"},[a("strong",[e._v("响应脚本设置规则： 接口返回数据已经内置到参数responseString(已转为字符串)中，如果需要处理成JSON格式推荐使用JsonSlurper类。 "),a("br"),e._v(" 例如： "),a("br"),a("span",{staticStyle:{color:"red"}},[e._v(" import groovy.json.JsonSlurper"),a("br"),e._v(" def jsonSlurper = new JsonSlurper()"),a("br"),e._v(" def responseMap= jsonSlurper.parseText(responseString)"),a("br"),e._v(" return responseMap.data.list"),a("br")])])])],1)],1)],1)],1),e.isEdit?a("div",{staticClass:"sql-config"},[a("div",{staticStyle:{"text-align":"center",padding:"16px 0"}},[a("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.scriptExecute()}}},[e._v(" 解析并运行 ")])],1)]):e._e()],1),e.isEdit?a("el-col",{attrs:{span:8}},[a("div",{staticClass:"right-setting"},[a("div",{staticClass:"paramConfig"},[a("div",{staticClass:"title-style bs-title-style"},[e._v(" 动态参数 "),a("el-button",{staticStyle:{float:"right",border:"none","margin-top":"-4px"},attrs:{type:"text"},on:{click:function(t){return e.openParamsSetDialog(!1)}}},[e._v(" 配置 ")])],1),a("div",{staticClass:"field-wrap bs-field-wrap bs-scrollbar"},e._l(e.dataForm.config.paramsList,(function(t){return a("div",{key:t.name,staticClass:"field-item",on:{click:function(t){return e.openParamsSetDialog(!1)}}},[a("span",[e._v(e._s(t.name))]),e._v(" "),a("span",{directives:[{name:"show",rawName:"v-show",value:t.remark,expression:"param.remark"}],staticStyle:{color:"#909399"}},[e._v(" ("+e._s(t.remark)+") ")]),a("el-button",{staticClass:"edit_field",staticStyle:{float:"right",border:"none","margin-top":"2px"},attrs:{type:"text"},on:{click:function(t){return e.openParamsSetDialog(!1)}}},[e._v(" 配置 ")])],1)})),0)]),a("div",{staticClass:"structure"},[a("div",{staticClass:"title-style bs-title-style"},[e._v(" 输出字段 "),a("el-button",{staticStyle:{float:"right",border:"none","margin-top":"-4px"},attrs:{type:"text"},on:{click:function(t){return e.$refs.outputFieldDialog.open()}}},[e._v(" 配置 ")])],1),a("div",{staticClass:"field-wrap bs-field-wrap bs-scrollbar"},e._l(e.outputFieldList,(function(t,s){return a("div",{key:s,staticClass:"field-item",on:{click:function(t){return e.$refs.outputFieldDialog.open()}}},[a("span",[e._v(e._s(t.fieldName))]),e._v(" "),a("span",{directives:[{name:"show",rawName:"v-show",value:t.fieldDesc,expression:"field.fieldDesc"}],staticStyle:{color:"#909399"}},[e._v(" ("+e._s(t.fieldDesc)+")")]),a("el-button",{staticClass:"edit_field",staticStyle:{float:"right",border:"none","margin-top":"2px"},attrs:{type:"text"},on:{click:function(t){return e.$refs.outputFieldDialog.open()}}},[e._v(" 配置 ")])],1)})),0)])])]):e._e()],1),e.isEdit?a("div",{staticClass:"dataPreView",staticStyle:{"margin-top":"12px"}},[a("div",{staticClass:"result-view"},[e._v(" 数据预览 ")]),a("div",{directives:[{name:"loading",rawName:"v-loading",value:e.tableLoading,expression:"tableLoading"}],staticClass:"bs-table-box is-Edit bs-scrollbar"},[a("el-table",{staticClass:"bs-el-table bs-scrollba preview-table",attrs:{align:"center",data:e.dataPreviewList,"max-height":"300",border:!0}},e._l(e.dataPreviewList[0],(function(t,s){return a("el-table-column",{key:s,attrs:{label:s,align:"center","show-overflow-tooltip":"","render-header":e.renderHeader},scopedSlots:e._u([{key:"default",fn:function(t){return[a("span",[e._v(e._s(t.row[s]))])]}}],null,!0)})})),1)],1)]):e._e(),e.isEdit?e._e():a("div",{staticClass:"dataPreView"},[a("el-tabs",{model:{value:e.activeName,callback:function(t){e.activeName=t},expression:"activeName"}},[a("el-tab-pane",{directives:[{name:"loading",rawName:"v-loading",value:e.tableLoading,expression:"tableLoading"}],attrs:{label:"数据预览",name:"data"}},[a("div",{staticClass:"bs-table-box"},[e.dataPreviewList&&e.dataPreviewList.length?a("el-table",{staticClass:"bs-el-table",attrs:{align:"center",data:e.dataPreviewList,"max-height":"400"}},e._l(e.dataPreviewList[0],(function(t,s){return a("el-table-column",{key:s,attrs:{label:s,align:"center","show-overflow-tooltip":"","render-header":e.renderHeader},scopedSlots:e._u([{key:"default",fn:function(t){return[a("span",[e._v(e._s(t.row[s]))])]}}],null,!0)})})),1):a("el-empty")],1)]),a("el-tab-pane",{directives:[{name:"loading",rawName:"v-loading",value:e.tableLoading,expression:"tableLoading"}],attrs:{label:"数据集结构",name:"structure"}},[a("div",{staticClass:"bs-table-box"},[a("el-table",{attrs:{"max-height":"400",data:e.outputFieldList,border:!0,align:"center"}},[a("el-table-column",{attrs:{align:"center","show-overflow-tooltip":"",prop:"fieldName",label:"字段值"}}),a("el-table-column",{attrs:{align:"center",prop:"fieldDesc",label:"字段描述"},scopedSlots:e._u([{key:"default",fn:function(t){return[e.isEdit?a("el-input",{staticClass:"labeldsc bs-el-input",attrs:{size:"small"},model:{value:t.row.fieldDesc,callback:function(a){e.$set(t.row,"fieldDesc",a)},expression:"scope.row.fieldDesc"}}):a("span",[e._v(e._s(t.row.fieldDesc))])]}}],null,!1,967602169)})],1)],1)])],1)],1),a("ParamsSettingDialog",{ref:"paramsSettingDialog",attrs:{"params-list":e.dataForm.config.paramsList,"new-params-list":e.newParamsList},on:{saveParams:e.saveParams,saveNewParams:e.saveNewParams,getData:e.getData,getPramsList:e.getPramsList}}),a("OutputFieldDialog",{ref:"outputFieldDialog",attrs:{"output-field-list":e.outputFieldList},on:{setFieldList:function(t){e.outputFieldList=t}}})],1),a("FieldFillDialog",{ref:"fieldFillDialog",on:{fieldDescFill:e.fieldDescFill,fieldDescEdit:e.fieldDescEdit,toSave:e.toSave}})],1)},_t=[],yt=a(66347),wt=(a(268),function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("el-dialog",{staticClass:"bs-dialog-wrap bs-el-dialog",attrs:{title:"参数配置",visible:e.dialogVisible,width:"1000px","append-to-body":"","close-on-click-modal":!1,"before-close":e.handleClose},on:{"update:visible":function(t){e.dialogVisible=t}}},[a("el-form",{ref:"form",attrs:{model:e.form,rules:e.formRules}},[a("div",{staticClass:"bs-table-box"},[a("el-table",{ref:"singleTable",staticClass:"bs-el-table",attrs:{data:e.form.params,border:!0,align:"center"}},[a("el-empty",{attrs:{slot:"empty"},slot:"empty"}),a("el-table-column",{attrs:{prop:"name",label:"参数名称",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-input",{staticClass:"bs-el-input",attrs:{placeholder:"请输入名称",clearable:"",readonly:""},on:{change:function(a){return e.checkParamsName(t.row)}},model:{value:t.row.name,callback:function(a){e.$set(t.row,"name",a)},expression:"scope.row.name"}})]}}])}),a("el-table-column",{attrs:{prop:"require",label:"是否必填",align:"center",width:"200",filterable:""},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-radio-group",{attrs:{disabled:e.isUpdate},model:{value:t.row.require,callback:function(a){e.$set(t.row,"require",a)},expression:"scope.row.require"}},[a("el-radio",{attrs:{label:1}},[e._v(" 是 ")]),a("el-radio",{attrs:{label:0}},[e._v(" 否 ")])],1)]}}])}),a("el-table-column",{attrs:{prop:"value",label:"参数值",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return["Date"===t.row.type?a("el-date-picker",{attrs:{type:"datetime","value-format":"yyyy-MM-dd HH:mm:ss",placeholder:"选择日期时间"},model:{value:t.row.value,callback:function(a){e.$set(t.row,"value",a)},expression:"scope.row.value"}}):a("el-form-item",{staticStyle:{"margin-bottom":"0"},attrs:{prop:"params."+t.$index+".value",rules:t.row.require?e.formRules.value:null}},[a("el-input",{staticClass:"bs-el-input",attrs:{clearable:"",placeholder:"请输入值"},model:{value:t.row.value,callback:function(a){e.$set(t.row,"value",a)},expression:"scope.row.value"}})],1)]}}])}),a("el-table-column",{attrs:{prop:"remark",label:"备注",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-input",{staticClass:"bs-el-input",attrs:{clearable:"",placeholder:"请输入备注",rows:"2",readonly:e.isUpdate,maxlength:"200"},model:{value:t.row.remark,callback:function(a){e.$set(t.row,"remark",a)},expression:"scope.row.remark"}})]}}])})],1)],1)]),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{staticClass:"bs-el-button-default",on:{click:e.cancel}},[e._v(" 取消 ")]),a("el-button",{attrs:{type:"primary"},on:{click:e.confirm}},[e._v(" 确定 ")])],1)],1)],1)}),Ct=[],Ft={name:"HttpParamsSettingDialog",props:{paramsList:{type:Array,default:function(){return[]}},newParamsList:{type:Array,default:function(){return[]}}},data:function(){return{isUpdate:!1,dialogVisible:!1,form:{params:[]},formRules:{value:[{required:!0,message:"参数值不能为空",trigger:"blur"}]}}},methods:{open:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.$emit("getPramsList"),this.form.params=e?this.newParamsList:U()(this.paramsList),this.isUpdate=e,this.dialogVisible=!0},close:function(){this.$refs.form.clearValidate(),this.dialogVisible=!1},handleClose:function(){this.$refs.form.clearValidate(),this.dialogVisible=!1},checkParamsName:function(e){var t=this.form.params.filter((function(t){return t.fieldName===e.name}));t.length&&(this.$message.warning("参数名称不可以与字段名相同！"),e.name="")},cancel:function(){this.$refs.form.clearValidate(),this.dialogVisible=!1},confirm:function(){var e=this;this.$refs.form.validate((function(t){t&&(e.isUpdate?(e.$emit("saveNewParams",U()(e.form.params)),e.$emit("getData")):e.$emit("saveParams",U()(e.form.params)),e.dialogVisible=!1)}))}}},xt=Ft,Lt=(0,E.Z)(xt,wt,Ct,!1,null,"430b9024",null),kt=Lt.exports,Dt=a(78658),Tt={name:"HttpEditForm",components:{codemirror:qe.codemirror,FieldFillDialog:Oe,ParamsSettingDialog:kt,OutputFieldDialog:Se,LabelSelect:ge},props:{config:{type:Object,default:function(){}},isEdit:{type:Boolean,default:!1},datasetId:{type:String,default:null},typeId:{type:String,default:""},appCode:{type:String,default:""}},data:function(){var e=this,t=function(t,a,s){h({id:e.datasetId,name:a,moduleCode:e.appCode}).then((function(e){e?s(new Error("数据集名称已存在")):s()}))},a=function(e,t,a){t.startsWith("${baseUrl}/")&&a();var s=/(https?|ftp|file):\/\/[-A-Za-z0-9+&@#/%?=~_|!:,.;]+[-A-Za-z0-9+&@#/%=~_|]/;s.test(t)?a():a(new Error("请输入正确的请求地址"))};return{newParamsList:[],activeName:"head",options:[{value:"string",label:"字符串"},{value:"boolean",label:"布尔值"},{value:"int",label:"数字"},{value:"date",label:"日期"}],newDataForm:{},dataForm:{id:"",name:"",typeId:"",remark:"",cache:0,labelIds:[],config:{className:"com.gccloud.dataset.entity.config.HttpDataSetConfig",requestType:"backend",method:"get",url:"",headers:[],params:[],body:"",paramsList:[],requestScript:"",responseScript:""}},rules:{name:[{required:!0,message:"请输入数据集名称",trigger:"blur"},{validator:t,trigger:"blur"}],typeId:[{required:!0,message:"请选择分组",trigger:"blur"}],"config.requestType":[{required:!0,message:"请选择调用方式",trigger:"change"}],key:[{required:!0,message:"键不能为空",trigger:"blur"}],value:[{required:!0,message:"值不能为空",trigger:"blur"}],"config.method":[{required:!0,message:"请求类型不能为空",trigger:"blur"}],"config.url":[{required:!0,message:"请求地址不能为空",trigger:"blur"},{validator:a,trigger:"blur"}]},codemirrorOption:{mode:"text/x-groovy",lineNumbers:!0,lineWrapping:!0,theme:"nord",extraKey:{Ctrl:"autocomplete"},hintOptions:{completeSingle:!0}},dataPreviewList:[],outputFieldList:[],structurePreviewListCopy:[],typeName:"",categoryData:[],fieldsetVisible:!1,paramsVisible:!1,tableLoading:!1,saveloading:!1,saveText:"",isSet:!1,passTest:!1,fieldDesc:null}},watch:{"dataForm.config.script":function(e){e||(this.passTest=!1)}},mounted:function(){this.init()},methods:{init:function(){var e=this;return(0,B.Z)((0,A.Z)().mark((function t(){return(0,A.Z)().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,C({tableName:"dataset",moduleCode:e.appCode});case 2:e.categoryData=t.sent,e.typeId&&(e.dataForm.typeId=e.typeId,e.$nextTick((function(){try{e.typeName=e.$refs.categorySelectTree.getNode(e.dataForm.typeId).data.name}catch(t){console.error(t)}}))),e.datasetId&&w(e.datasetId).then((function(t){var a=t.id,s=t.name,i=t.typeId,l=t.remark,o=t.datasetType,n=t.moduleCode,c=t.editable,d=t.sourceId,u=t.cache,p=t.config,m=(p.script,p.paramsList),f=p.fieldDesc,b=p.fieldList;e.dataForm={id:a,name:s,typeId:i,remark:l,datasetType:o,moduleCode:n,editable:c,sourceId:d,cache:u,config:(0,r.Z)({},p),labelIds:e.dataForm.labelIds},e.fieldDesc=f,e.outputFieldList=b,e.newParamsList=U()(m),e.codemirrorOption.mode="frontend"===e.dataForm.config.requestType?"text/javascript":"text/x-groovy"}));case 5:case"end":return t.stop()}}),t)})))()},save:function(e){var t=this,a=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!a){var s=this.outputFieldList.some((function(e){return""===e.fieldDesc||!e.hasOwnProperty("fieldDesc")}));if(s)return void this.$refs.fieldFillDialog.open()}this.$refs[e].validate((function(e){if(e){t.saveloading=!0,t.saveText="正在保存...";var a=t.datasetId,s=t.dataForm,i=t.appCode,r=t.fieldDesc,l=(t.outputFieldList,{id:a,name:s.name,typeId:s.typeId,remark:s.remark,cache:s.cache,datasetType:"http",moduleCode:i,editable:i?1:0,labelIds:s.labelIds,config:{className:"com.gccloud.dataset.entity.config.HttpDataSetConfig",method:s.config.method,url:s.config.url,headers:s.config.headers,params:s.config.params,body:s.config.body,requestScript:s.config.requestScript,responseScript:s.config.responseScript,requestType:s.config.requestType,fieldDesc:r,paramsList:s.config.paramsList,fieldList:t.outputFieldList}}),o=""===t.dataForm.id?g:v;o(l).then((function(){t.$message.success("操作成功"),t.$parent.init(!1),t.$parent.setType=null,t.saveloading=!1,t.saveText="",t.goBack()})).catch((function(){t.saveloading=!1,t.saveText=""}))}}))},changeRequestType:function(e){"frontend"===e?this.$set(this.codemirrorOption,"mode","text/javascript"):this.$set(this.codemirrorOption,"mode","text/x-groovy")},addHeader:function(){var e={key:"",type:"string",value:"",remark:""};this.dataForm.config.headers.push(U()(e))},delHeader:function(e){this.dataForm.config.headers.splice(e,1)},addParam:function(){var e={key:"",value:"",remark:""};this.dataForm.config.params.push(U()(e))},delParam:function(e){this.dataForm.config.params.splice(e,1)},saveParams:function(e){this.dataForm.config.paramsList=e},saveNewParams:function(e){this.newParamsList=e},setField:function(){},fieldDescFill:function(){var e=this;this.fieldDesc={},this.outputFieldList.forEach((function(t){""!==t.fieldDesc&&t.hasOwnProperty("fieldDesc")?e.fieldDesc[t.fieldName]=t.fieldDesc:(t.fieldDesc=t.fieldName,e.fieldDesc[t.fieldName]=t.fieldName)})),this.save("form"),this.$refs.fieldFillDialog.close()},fieldDescEdit:function(){this.$refs.fieldFillDialog.close(),this.$refs.outputFieldDialog.open()},toSave:function(){var e=this;this.fieldDesc={},this.outputFieldList.forEach((function(t){e.fieldDesc[t.fieldName]=t.fieldDesc})),this.save("form",!0),this.$refs.fieldFillDialog.close()},buildFieldDesc:function(){var e=this,t={};this.outputFieldList.forEach((function(a){e.fieldDesc.hasOwnProperty(a.fieldName)&&(a.fieldDesc=e.fieldDesc[a.fieldName]),t[a.fieldName]=a.fieldDesc})),this.fieldDesc=t},openParamsSetDialog:function(e){var t=this;return(0,B.Z)((0,A.Z)().mark((function a(){var s;return(0,A.Z)().wrap((function(a){while(1)switch(a.prev=a.next){case 0:return t.getPramsList(),s=U()(t.dataForm.config.paramsList),t.newParamsList=t.compareParamsList(t.newParamsList,s),a.next=5,t.$nextTick();case 5:t.$refs.paramsSettingDialog.open(e);case 6:case"end":return a.stop()}}),a)})))()},getPramsList:function(){var e,t,a,s,i=this,r=this.getValName(this.dataForm.config.url),o=null===(e=this.dataForm.config)||void 0===e?void 0:e.headers.map((function(e){var t;return null===(t=e.value.match(/\$\{(.+?)\}/))||void 0===t?void 0:t[1]})).filter(Boolean),n=null===(t=this.dataForm.config)||void 0===t?void 0:t.params.map((function(e){var t;return null===(t=e.value.match(/\$\{(.+?)\}/))||void 0===t?void 0:t[1]})).filter(Boolean),c=this.getValName(this.dataForm.config.body),d=new Set([].concat((0,l.Z)(r),(0,l.Z)(o),(0,l.Z)(n),(0,l.Z)(c))),u=null===(a=this.dataForm.config)||void 0===a||null===(s=a.paramsList)||void 0===s?void 0:s.map((function(e){return e.name})),p=[];d.forEach((function(e){if(u.includes(e)){var t,a,s=null===(t=i.dataForm.config)||void 0===t||null===(a=t.paramsList)||void 0===a?void 0:a.find((function(t){return t.name===e}));p.push(s)}else p.push({name:e,type:"String",value:"",status:1,require:0,remark:""})})),this.dataForm.config.paramsList=U()(p)},compareParamsList:function(e,t){var a,s=[],i=(0,yt.Z)(t);try{for(i.s();!(a=i.n()).done;){var r,l=a.value,o=!1,n=(0,yt.Z)(e);try{for(n.s();!(r=n.n()).done;){var c=r.value;if(l.name===c.name){l.require&&!c.value||(l.value=c.value),s.push(l),o=!0;break}}}catch(d){n.e(d)}finally{n.f()}o||s.push(l)}}catch(d){i.e(d)}finally{i.f()}return s},getValName:function(e){var t,a=/\${(.*?)\}/g,s=[];while(t=a.exec(e))s.push(t[1]);return s},scriptExecute:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];e||this.dataForm.config.url?(this.getPramsList(),this.dataForm.config.paramsList&&this.dataForm.config.paramsList.length&&!e?this.openParamsSetDialog(!0):this.getData()):this.$message.error("请输入请求地址")},getData:function(){var e=this;if("frontend"===this.dataForm.config.requestType)(0,Dt.Z)((0,r.Z)((0,r.Z)({},this.dataForm.config),{},{paramsList:this.newParamsList})).then((function(t){e.dataPreviewList=t&&Array.isArray(t)?t:[(0,r.Z)({},t)],e.updateOoutputFieldList(e.dataPreviewList),e.$message.success("脚本执行通过")})).catch((function(t){e.dataPreviewList=[],e.updateOoutputFieldList(e.dataPreviewList)}));else{var t=JSON.stringify(this.dataForm.config),a={script:t,params:this.newParamsList,dataSetType:"http"};y(a).then((function(t){e.dataPreviewList=t.data&&Array.isArray(t.data)?t.data:[(0,r.Z)({},t.data)],e.updateOoutputFieldList(e.dataPreviewList),e.$message.success("脚本执行通过")})).catch((function(t){e.dataPreviewList=[],e.updateOoutputFieldList(e.dataPreviewList)}))}},updateOoutputFieldList:function(e){if(e&&e.length){var t,a=null===(t=Object.keys(null===e||void 0===e?void 0:e[0]))||void 0===t?void 0:t.map((function(e){return{fieldName:e,fieldDesc:""}}));this.outputFieldList=this.compareArr(a,this.outputFieldList)}else this.outputFieldList=[]},compareArr:function(e,t){var a,s=[],i=(0,yt.Z)(e);try{for(i.s();!(a=i.n()).done;){var r,l=a.value,o=!1,n=(0,yt.Z)(t);try{for(n.s();!(r=n.n()).done;){var c=r.value;if(l.fieldName===c.fieldName){l.fieldDesc=c.fieldDesc,s.push(l),o=!0;break}}}catch(d){n.e(d)}finally{n.f()}o||s.push(l)}}catch(d){i.e(d)}finally{i.f()}return s},clearType:function(){this.typeName="",this.dataForm.typeId=""},setCurrentNode:function(e){if(e){var t=this.dataForm.typeId||null;this.$refs.categorySelectTree.setCurrentKey(t)}},selectParentCategory:function(e){this.dataForm.typeId=e.id,this.typeName=e.name,this.$refs.selectParentName.blur()},goBack:function(){this.$emit("back")},renderHeader:function(e,t){var a=t.column,s=(t.index,a.label.length),i=14;return a.minWidth=s*i<120?120:s*i,e("span",{class:"cell-content",style:{width:"100%"}},[a.label])},openNewWindow:function(e){window.open(e,"_blank")},setPrometheus:function(){this.dataForm.config.responseScript='const data = [];\nif (resp.data.resultType === "vector") {\n  resp.data.result.map((m) => {\n    data.push({\n      ...m.metric,\n      time: m.value[0],\n      value: parseFloat(m.value[1]),\n    });\n  });\n}\nif (resp.data.resultType === "matrix") {\n  resp.data.result.map((m) => {\n    m.values.map((v) => {\n      data.push({\n        ...m.metric,\n        time: v[0],\n        value: parseFloat(v[1]),\n      });\n    });\n  });\n}\nreturn data;'},setRange:function(e){this.dataForm.config.requestScript="const now = Math.ceil(Date.now() / 1000)\nconst duration = ".concat(e," * 60\nconst start = now - duration\nconst step = Math.ceil(duration / 240)\nreq.params.start = start\nreq.params.end = now\nreq.params.step = step < 1 ? 1 : step")}}},St=Tt,Pt=(0,E.Z)(St,vt,_t,!1,null,"372d2510",null),Et=Pt.exports,Nt=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("el-dialog",{staticClass:"bs-dialog-wrap bs-el-dialog",attrs:{title:"新增",visible:e.dialogVisible,width:"800px","append-to-body":!0,"close-on-click-modal":!1},on:{"update:visible":function(t){e.dialogVisible=t}}},[a("div",{staticClass:"type-wrap"},[a("el-row",{attrs:{gutter:20}},e._l(e.datasetTypeList.filter((function(e){return""!==e.datasetType})),(function(t){return a("el-col",{key:t.datasetType,staticStyle:{minWidth:"200px"},attrs:{span:8,xs:24,sm:12,md:8}},[a("el-card",{staticClass:"bs-el-card",attrs:{shadow:"hover"}},[a("div",{staticClass:"type-item",on:{click:function(a){return e.openAddForm(t.datasetType,t.componentName)}}},[a("span",[e._v(" "+e._s(t.name)+" ")]),a("p",[a("span",{staticClass:"description"},[e._v(" "+e._s(t.description)+" ")])])])])],1)})),1)],1)])},It=[],$t={props:{datasetTypeList:{type:Array,default:function(){return[]}}},data:function(){return{dialogVisible:!1}},created:function(){},mounted:function(){},methods:{openAddForm:function(e,t){this.dialogVisible=!1,this.$emit("openAddForm",e,t)}}},Ot=$t,qt=(0,E.Z)(Ot,Nt,It,!1,null,"14314d19",null),jt=qt.exports,Vt=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{directives:[{name:"loading",rawName:"v-loading",value:e.saveLoading,expression:"saveLoading"}],staticClass:"inner-container",attrs:{"element-loading-text":e.saveText}},[a("el-scrollbar",{staticClass:"data-set-scrollbar"},[a("div",{staticClass:"header"},[a("el-page-header",{staticClass:"bs-el-page-header"},[a("template",{slot:"content"},[a("div",{staticClass:"page-header"},[a("div",{staticClass:"page-header-left"},[e._v(" "+e._s(e.isEdit?e.dataForm.id?"编辑存储过程数据集":"新增存储过程数据集":"存储过程数据集详情")+" ")]),a("div",{staticClass:"page-header-right"},[a("el-button",{staticClass:"bs-el-button-default",on:{click:function(t){return e.openNewWindow("https://www.yuque.com/chuinixiongkou/bigscreen/procedure_dataset")}}},[e._v(" 帮助 ")]),e.isEdit?a("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.save("form")}}},[e._v(" 保存 ")]):e._e(),a("el-button",{staticClass:"bs-el-button-default",on:{click:e.goBack}},[e._v(" 返回 ")])],1)])])],2)],1),a("el-row",{staticStyle:{margin:"16px 16px 0"}},[a("el-col",{attrs:{span:e.isEdit?16:24}},[a("el-form",{ref:"form",staticClass:"bs-el-form",staticStyle:{padding:"16px 16px 0"},attrs:{model:e.dataForm,rules:e.rules,"label-width":"120px"}},[a("el-row",{attrs:{gutter:20}},[a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:"数据集名称",prop:"name"}},[a("el-input",{staticClass:"bs-el-input",attrs:{clearable:"",disabled:!e.isEdit},model:{value:e.dataForm.name,callback:function(t){e.$set(e.dataForm,"name",t)},expression:"dataForm.name"}})],1)],1),a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:"分组",prop:"typeId"}},[a("el-select",{ref:"selectParentName",staticClass:"bs-el-select",attrs:{"popper-class":"bs-el-select",placeholder:"请选择分组",clearable:"",disabled:!e.isEdit,filterable:"","filter-method":e.selectorFilter},on:{clear:e.clearType,"visible-change":e.setCurrentNode},model:{value:e.dataForm.typeId,callback:function(t){e.$set(e.dataForm,"typeId",t)},expression:"dataForm.typeId"}},[a("el-option",{staticStyle:{height:"auto",padding:"0"},attrs:{label:e.typeName,value:e.dataForm.typeId}},[a("div",[a("el-tree",{ref:"categorySelectTree",staticClass:"bs-el-tree",attrs:{data:e.categoryData,"node-key":"id",indent:0,props:{label:"name",children:"children"},"default-expand-all":!0,"highlight-current":!0,"expand-on-click-node":!1,"filter-node-method":e.treeFilter},on:{"node-click":e.selectParentCategory},scopedSlots:e._u([{key:"default",fn:function(t){var s=t.data;return a("span",{staticClass:"custom-tree-node"},[a("span",[a("i",{class:s.children&&s.children.length?"el-icon el-icon-folder":"el-icon el-icon-document"}),e._v(" "+e._s(s.name)+" ")])])}}])})],1)])],1)],1)],1)],1),a("el-row",{attrs:{gutter:20}},[a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:"备注",prop:"remark"}},[a("el-input",{staticClass:"bs-el-input",attrs:{disabled:!e.isEdit},model:{value:e.dataForm.remark,callback:function(t){e.$set(e.dataForm,"remark",t)},expression:"dataForm.remark"}})],1)],1),a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:"数据源",prop:"sourceId"}},[a("el-select",{staticClass:"bs-el-select",attrs:{clearable:"","popper-class":"bs-el-select",filterable:"",placeholder:"请选择数据源",disabled:!e.isEdit},on:{change:function(t){return e.setSqlProcess(t)}},model:{value:e.dataForm.sourceId,callback:function(t){e.$set(e.dataForm,"sourceId",t)},expression:"dataForm.sourceId"}},e._l(e.sourceList,(function(e){return a("el-option",{key:e.id,attrs:{label:e.sourceName,value:e.id}})})),1)],1)],1)],1),a("el-row",{attrs:{gutter:20}},[a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:"缓存",prop:"cache"}},[a("el-radio-group",{staticClass:"bs-el-radio-group",model:{value:e.dataForm.cache,callback:function(t){e.$set(e.dataForm,"cache",t)},expression:"dataForm.cache"}},[a("el-radio",{attrs:{label:1}},[e._v(" 开启 ")]),a("el-radio",{attrs:{label:0}},[e._v(" 关闭 ")])],1),a("el-tooltip",{staticClass:"item",attrs:{effect:"light",content:"开启缓存:会在首次调用该数据集时，将结果缓存，在接下来的十分钟内，若再次被调用则直接返回缓存中的数据，注意：在当前数据集编辑页面缓存不生效",placement:"top"}},[a("i",{staticClass:"el-icon-warning-outline",staticStyle:{color:"#E3C98C","margin-left":"16px","font-size":"14px"}})])],1)],1),a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:"标签",prop:"labelIds"}},[a("LabelSelect",{attrs:{"dataset-id":e.datasetId,"id-list":e.dataForm.labelIds},on:{commit:function(t){e.dataForm.labelIds=t}}})],1)],1)],1)],1),e.isEdit?a("div",{staticClass:"sql-config"},[a("div",[a("codemirror",{ref:"targetInSql",staticStyle:{"margin-top":"2px"},attrs:{options:e.cOptions},model:{value:e.dataForm.sqlProcess,callback:function(t){e.$set(e.dataForm,"sqlProcess",t)},expression:"dataForm.sqlProcess"}}),a("div",{staticClass:"bs-codemirror-bottom-text"},[e._v(" 示例： "),a("strong",[e._v("call 存储过程名称("),a("span",{staticStyle:{color:"#CC7832"}},[e._v("${参数名称}")]),e._v(",?)，SqlServer数据源使用：exec 存储过程名称 "),a("span",{staticStyle:{color:"#CC7832"}},[e._v("@参数名称")]),e._v("=?")])])],1),a("div",{staticStyle:{"text-align":"center",padding:"16px 0"}},[a("el-button",{attrs:{type:"primary"},on:{click:e.buildParamsAndRun}},[e._v(" 解析并运行 ")])],1)]):e._e()],1),e.isEdit?a("el-col",{attrs:{span:8}},[a("div",{staticClass:"right-setting"},[a("div",{staticClass:"paramConfig"},[a("div",{staticClass:"title-style bs-title-style"},[e._v(" 存储过程参数 "),a("el-button",{staticStyle:{float:"right",border:"none","margin-top":"-4px"},attrs:{type:"text"},on:{click:e.openParamsConfig}},[e._v(" 配置 ")])],1),a("div",{staticClass:"field-wrap bs-field-wrap bs-scrollbar"},e._l(e.dataForm.paramsList,(function(t){return a("div",{key:t.name,staticClass:"field-item",on:{click:e.openParamsConfig}},[a("span",[e._v(e._s(t.name))]),e._v(" "),a("span",{directives:[{name:"show",rawName:"v-show",value:t.remark,expression:"param.remark"}],staticStyle:{color:"#909399"}},[e._v(" ("+e._s(t.remark)+") ")]),a("el-button",{staticClass:"edit_field",staticStyle:{float:"right",border:"none","margin-top":"2px"},attrs:{type:"text"},on:{click:e.openParamsConfig}},[e._v(" 配置 ")])],1)})),0)]),a("div",{staticClass:"structure"},[a("div",{staticClass:"title-style bs-title-style"},[e._v(" 输出字段 "),a("el-button",{staticStyle:{float:"right",border:"none","margin-top":"-4px"},attrs:{type:"text"},on:{click:function(t){e.fieldsetVisible=!0}}},[e._v(" 配置 ")])],1),a("div",{staticClass:"field-wrap bs-field-wrap bs-scrollbar"},e._l(e.structurePreviewList,(function(t){return a("div",{key:t.fieldName,staticClass:"field-item",on:{click:function(t){e.fieldsetVisible=!0}}},[a("span",[e._v(e._s(t.fieldName))]),e._v(" "),a("span",{directives:[{name:"show",rawName:"v-show",value:t.fieldDesc,expression:"field.fieldDesc"}],staticStyle:{color:"#909399"}},[e._v("("+e._s(t.fieldDesc)+")")]),a("el-button",{staticClass:"edit_field",staticStyle:{float:"right",border:"none","margin-top":"2px"},attrs:{type:"text"},on:{click:function(t){e.fieldsetVisible=!0}}},[e._v(" 配置 ")])],1)})),0)])])]):e._e()],1),e.isEdit?a("div",{staticStyle:{"margin-top":"12px"}},[a("div",{staticClass:"result-view"},[e._v(" 数据预览 ")]),a("div",{staticClass:"bs-table-box is-Edit"},[a("el-table",{staticClass:"bs-el-table",attrs:{align:"center",data:e.dataPreviewList,"max-height":"100%"}},e._l(e.dataPreviewList[0]?e.dataPreviewList[0]:e.noDataTableDisplayFields,(function(t,s){return a("el-table-column",{key:s,attrs:{label:s,fixed:e.left,align:"center","show-overflow-tooltip":""},scopedSlots:e._u([{key:"default",fn:function(t){return[a("span",[e._v(e._s(t.row[s]))])]}}],null,!0)})})),1),a("div",{staticStyle:{margin:"8px 0",color:"var(--bs-el-text)"}},[a("span",{directives:[{name:"show",rawName:"v-show",value:e.dataPreviewList.length,expression:"dataPreviewList.length"}]},[e._v("数据预览中，存储过程仅展示20条数据")])])],1)]):e._e(),a("el-dialog",{staticClass:"bs-dialog-wrap bs-el-dialog",attrs:{title:"提示",visible:e.fieldDescVisible,width:"420px","append-to-body":"","close-on-click-modal":!1,"custom-class":"fieldDescCheck"},on:{"update:visible":function(t){e.fieldDescVisible=t}}},[a("p",{staticStyle:{color:"var(--bs-el-text)","line-height":"24px","padding-left":"10px",display:"flex"}},[a("i",{staticClass:"el-icon-warning",staticStyle:{color:"#E6A23C","font-size":"24px","margin-right":"5px"}}),e._v(" 存在字段描述信息为空，请确认 ")]),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{staticClass:"bs-el-button-default",on:{click:e.fieldDescFill}},[e._v(" 使用字段名填充 ")]),a("el-button",{staticClass:"bs-el-button-default",on:{click:e.fieldDescEdit}},[e._v(" 进入编辑 ")]),a("el-button",{attrs:{type:"primary"},on:{click:e.toSave}},[e._v("继续保存")])],1)]),a("el-dialog",{staticClass:"bs-dialog-wrap bs-el-dialog",attrs:{title:"输出字段配置",visible:e.fieldsetVisible,width:"1000px","append-to-body":"","close-on-click-modal":!1,"before-close":e.cancelField},on:{"update:visible":function(t){e.fieldsetVisible=t}}},[a("div",{staticClass:"bs-table-box"},[a("el-table",{staticClass:"bs-el-table",attrs:{data:e.structurePreviewListCopy,border:!0,align:"center"}},[a("el-empty",{attrs:{slot:"empty"},slot:"empty"}),a("el-table-column",{attrs:{align:"left","show-overflow-tooltip":"",prop:"fieldName",label:"字段值"}}),a("el-table-column",{attrs:{align:"center","show-overflow-tooltip":"",prop:"fieldType",label:"字段类型"}}),a("el-table-column",{attrs:{align:"center",prop:"fieldDesc",label:"字段描述"},scopedSlots:e._u([{key:"default",fn:function(t){return[e.isEdit?a("el-input",{staticClass:"labeldsc bs-el-input",attrs:{size:"small"},model:{value:t.row.fieldDesc,callback:function(a){e.$set(t.row,"fieldDesc",a)},expression:"scope.row.fieldDesc"}}):a("span",[e._v(e._s(t.row.fieldDesc))])]}}])}),a("el-table-column",{attrs:{align:"center",prop:"orderNum",label:"字段排序",sortable:""},scopedSlots:e._u([{key:"default",fn:function(t){return[e.isEdit?a("el-input",{staticClass:"labeldsc bs-el-input",attrs:{size:"small"},model:{value:t.row.orderNum,callback:function(a){e.$set(t.row,"orderNum",a)},expression:"scope.row.orderNum"}}):a("span",[e._v(e._s(t.row.orderNum))])]}}])}),e._t("output-field-table-column")],2)],1),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{on:{click:e.cancelField}},[e._v("取消")]),a("el-button",{attrs:{type:"primary"},on:{click:e.setField}},[e._v("确定")])],1)]),a("el-dialog",{staticClass:"bs-dialog-wrap bs-el-dialog",attrs:{title:"存储过程参数配置",visible:e.paramsVisible,width:"1000px","append-to-body":"","close-on-click-modal":!1,"before-close":e.cancelParam},on:{"update:visible":function(t){e.paramsVisible=t}}},[a("div",{staticClass:"bs-table-box"},[a("el-table",{ref:"singleTable",staticClass:"bs-el-table",attrs:{data:e.paramsListCopy,border:!0,align:"center"}},[a("el-empty",{attrs:{slot:"empty"},slot:"empty"}),a("el-table-column",{attrs:{prop:"name",label:"参数名称",align:"center"}}),a("el-table-column",{attrs:{prop:"type",label:"参数类型",align:"center",width:"200",filterable:""},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-select",{staticClass:"bs-el-select",attrs:{"popper-class":"bs-el-select",placeholder:"请选择"},model:{value:t.row.type,callback:function(a){e.$set(t.row,"type",a)},expression:"scope.row.type"}},e._l(e.typeSelect,(function(e){return a("el-option",{key:e.value,attrs:{label:e.value,value:e.value}})})),1)]}}])}),a("el-table-column",{attrs:{prop:"require",label:"是否必填",align:"center",width:"200",filterable:""},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-radio-group",{staticClass:"bs-el-radio-group",model:{value:t.row.require,callback:function(a){e.$set(t.row,"require",a)},expression:"scope.row.require"}},[a("el-radio",{attrs:{label:1}},[e._v(" 是 ")]),a("el-radio",{attrs:{label:0}},[e._v(" 否 ")])],1)]}}])}),a("el-table-column",{attrs:{prop:"value",label:"参数值",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return["Date"===t.row.type?a("el-date-picker",{attrs:{type:"datetime","value-format":"yyyy-MM-dd HH:mm:ss",placeholder:"选择日期时间"},model:{value:t.row.value,callback:function(a){e.$set(t.row,"value",a)},expression:"scope.row.value"}}):a("el-input",{staticClass:"bs-el-input",attrs:{clearable:"",placeholder:"请输入值"},model:{value:t.row.value,callback:function(a){e.$set(t.row,"value",a)},expression:"scope.row.value"}})]}}])}),a("el-table-column",{attrs:{prop:"remark",label:"备注",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-input",{staticClass:"bs-el-input",attrs:{clearable:"",placeholder:"请输入备注",rows:"2",maxlength:"200"},model:{value:t.row.remark,callback:function(a){e.$set(t.row,"remark",a)},expression:"scope.row.remark"}})]}}])}),a("el-table-column",{attrs:{label:"操作",width:"105",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-button",{staticClass:"no-border",staticStyle:{color:"#e47470"},attrs:{type:"text"},on:{click:function(a){return e.delRow(t.$index)}}},[e._v(" 删除 ")])]}}])},[a("template",{slot:"header"},[a("el-button",{staticClass:"no-border",attrs:{icon:"el-icon-plus",type:"text"},on:{click:e.addParam}},[e._v(" 添加 ")])],1)],2)],1)],1),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{staticClass:"bs-el-button-default",on:{click:e.cancelParam}},[e._v(" 取消 ")]),a("el-button",{attrs:{type:"primary"},on:{click:e.setParam}},[e._v(" 确定 ")])],1)])],1)],1)},Mt=[],At={name:"StoredProcedureEditForm",components:{codemirror:qe.codemirror,LabelSelect:ge},mixins:[We],data:function(){var e=this,t=function(t,a,s){h({id:e.datasetId,name:a,moduleCode:e.appCode}).then((function(e){e?s(new Error("数据集名称已存在")):s()}))};return{dataForm:{id:"",name:"",typeId:"",datasetType:"storedProcedure",remark:"",labelIds:[],sourceId:"",cache:0,sqlProcess:"call ",paramsList:[],fieldDesc:{},fieldList:[],code:"",script:"",cacheCoherence:null},rules:{name:[{required:!0,message:"请输入数据集名称",trigger:"blur"},{validator:t,trigger:"blur"}],sourceId:[{required:!0,message:"请选择数据源",trigger:"blur"}],typeId:[{required:!0,message:"请选择分组",trigger:"blur"}]},cOptions:{mode:"text/x-mysql",lineNumbers:!0,lineWrapping:!0,theme:"nord",extraKey:{Ctrl:"autocomplete"},hintOptions:{completeSingle:!0}},sourceList:[],msg:"",exception:"",passTest:!1,paramsVisible:!1,tableNameList:[],paramsListCopy:[],isTest:!1}},computed:{checkPass:function(){return{sqlProcess:this.dataForm.sqlProcess,script:this.dataForm.script,paramsList:this.dataForm.paramsList}},noDataTableDisplayFields:function(){var e={};return this.structurePreviewList.forEach((function(t){e[t.fieldName]=""})),e}},watch:{checkPass:{handler:function(e){this.passTest=!1},deep:!0}},mounted:function(){this.init()},methods:{init:function(){var e=this;return(0,B.Z)((0,A.Z)().mark((function t(){return(0,A.Z)().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,C({type:"dataset",moduleCode:e.appCode});case 2:if(e.categoryData=t.sent,e.typeId&&(e.dataForm.typeId=e.typeId,e.$nextTick((function(){try{e.typeName=e.$refs.categorySelectTree.getNode(e.dataForm.typeId).data.name}catch(t){console.error(t)}}))),e.getDataSource(),e.datasetId){t.next=7;break}return t.abrupt("return");case 7:w(e.datasetId).then((function(t){e.dataForm.id=t.id,e.dataForm.name=t.name,e.dataForm.typeId=t.typeId,e.dataForm.remark=t.remark,e.dataForm.datasetType=t.datasetType,e.dataForm.moduleCode=t.moduleCode,e.dataForm.editable=t.editable,e.dataForm.sourceId=t.sourceId,e.dataForm.cache=t.cache,e.dataForm.sqlProcess=t.config.sqlProcess,e.dataForm.paramsList=t.config.paramsList?t.config.paramsList:[],e.dataForm.fieldDesc=t.config.fieldDesc,e.dataForm.fieldList=t.config.fieldList,e.dataForm.cacheCoherence=t.config.cacheCoherence,e.dataForm.name=e.datasetName,e.paramsListCopy=U()(e.dataForm.paramsList),e.dataForm.typeId&&e.$nextTick((function(){try{e.typeName=e.$refs.categorySelectTree.getNode(e.dataForm.typeId).data.name}catch(t){console.error(t)}})),e.datasetTest(!1)}));case 8:case"end":return t.stop()}}),t)})))()},getDataSource:function(){var e=this,t={sourceName:"",sourceType:"",moduleCode:this.appCode};(0,ot.Ax)(t).then((function(t){e.sourceList=t}))},setSqlProcess:function(e,t){for(var a=0;a<this.sourceList.length;a++)this.sourceList[a].id===e&&("sqlserver"===this.sourceList[a].sourceType?"call "===this.dataForm.sqlProcess&&(this.dataForm.sqlProcess="exec "):"exec "===this.dataForm.sqlProcess&&(this.dataForm.sqlProcess="call "))},openParamsConfig:function(){this.isTest=!1,this.paramsVisible=!0},delRow:function(e){this.paramsListCopy.splice(e,1)},addParam:function(){this.paramsListCopy.push({name:"",type:"",value:"",status:1,require:0,remark:""})},cancelParam:function(){this.paramsListCopy=U()(this.dataForm.paramsList),this.paramsVisible=!1},setParam:function(){this.dataForm.paramsList=U()(this.paramsListCopy),this.isTest&&this.datasetTest(),this.paramsVisible=!1},save:function(e){var t=this,a=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(!1!==this.passTest)if(this.structurePreviewList.length){if(!a){var s=this.structurePreviewList.some((function(e){return""===e.fieldDesc||!e.hasOwnProperty("fieldDesc")}));if(s)return void(this.fieldDescVisible=!0)}this.$refs[e].validate((function(e){if(!e)return!1;if(t.dataForm.paramsList.length>0){var a=t.dataForm.paramsList.map((function(e){return e.name})),s=new Set(a);if(s.size!==a.length)return void t.$message.error("参数名称不能重复，请重新输入")}var i={};t.structurePreviewList.length>0&&(t.structurePreviewList.forEach((function(e){i[e.fieldName]=e.fieldDesc})),t.dataForm.fieldDesc=i),t.dataForm.fieldList=t.structurePreviewList.length?t.structurePreviewList:[],t.saveLoading=!0,t.saveText="正在保存...";var r=t.dataForm.id?v:g,l={id:t.dataForm.id,name:t.dataForm.name,typeId:t.dataForm.typeId,datasetType:"storedProcedure",remark:t.dataForm.remark,sourceId:t.dataForm.sourceId,cache:t.dataForm.cache,moduleCode:t.appCode,editable:t.appCode?1:0,labelIds:t.dataForm.labelIds,config:{className:"com.gccloud.dataset.entity.config.StoredProcedureDataSetConfig",sourceId:t.dataForm.sourceId,sqlProcess:t.dataForm.sqlProcess,paramsList:t.dataForm.paramsList,fieldList:t.dataForm.fieldList,fieldDesc:t.dataForm.fieldDesc}};r(l).then((function(e){t.$message.success("保存成功"),t.$parent.init(!1),t.$parent.setType=null,t.saveLoading=!1,t.saveText="",t.goBack()})).catch((function(){t.saveLoading=!1,t.saveText=""})),t.saveLoading=!1,t.saveText=""}))}else this.$message.warning("该存储过程未生成输出字段，请重新检查");else this.$message.error("请确保数据集SQL加工脚本不为空且运行通过")},buildParamsAndRun:function(){var e=this;this.isTest=!0;var t=/\${(.*?)}/g,a=(0,l.Z)(new Set((0,l.Z)(this.dataForm.sqlProcess.matchAll(t)).map((function(e){return e[1]})))),s=this.dataForm.paramsList.map((function(e){return e.name})),i=[];a.forEach((function(t){if(s.includes(t)){var a=e.dataForm.paramsList.find((function(e){return e.name===t}));i.push(a)}else i.push({name:t,type:"String",value:"",status:1,require:0,remark:""})})),this.dataForm.paramsList=U()(i),this.paramsListCopy=U()(this.dataForm.paramsList),this.dataForm.paramsList.length?this.paramsVisible=!0:this.datasetTest()},goBack:function(){this.$emit("back")},datasetTest:function(){var e=this,t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];if(""!==this.dataForm.sourceId)if(""!==this.dataForm.sqlProcess){if(this.dataForm.paramsList.length>0){var a=this.dataForm.paramsList.map((function(e){return e.name})),s=new Set(a);if(s.size!==a.length)return void this.$message.error("参数名称不能重复，请重新输入")}!0===t&&(this.current=1),this.saveLoading=!0;var i={dataSourceId:this.dataForm.sourceId,script:this.dataForm.sqlProcess,params:this.dataForm.paramsList,dataSetType:"storedProcedure",size:20,current:1};y(i).then((function(a){e.dataPreviewList=a.data.list,e.structurePreviewList=a.structure,e.structurePreviewList.forEach((function(t){var a=e.dataForm.fieldList.find((function(e){return e.fieldName===t.fieldName}));a&&(t.fieldDesc=a.fieldDesc,t.orderNum=a.orderNum,t.sourceTable=a.sourceTable)})),e.structurePreviewList.forEach((function(t){t.hasOwnProperty("orderNum")||e.$set(t,"orderNum",0),t.hasOwnProperty("sourceTable")||e.$set(t,"sourceTable",""),t.hasOwnProperty("fieldDesc")||e.$set(t,"fieldDesc","")})),e.totalCount=a.data.totalCount,e.tableNameList=a.tableNameList,e.tableNameList&&1===e.tableNameList.length&&e.structurePreviewList.forEach((function(t){t.sourceTable=e.tableNameList[0]})),e.structurePreviewListCopy=U()(e.structurePreviewList);var s=!1;e.dataForm.paramsList.forEach((function(t){var a=e.structurePreviewList.filter((function(e){return e.fieldName===t.name}));a.length&&(s=!0,t.name="")})),s?(e.$message.warning("参数名称不可以与字段名相同！"),e.passTest=!1):(t&&e.$message.success("脚本执行通过"),e.exception="",e.msg="",e.passTest=!0),e.saveLoading=!1})).catch((function(t){e.passTest=!1,e.saveLoading=!1}))}else this.$message.error("请输入数据集SQL加工脚本");else this.$message.error("请选择数据源")},selectorFilter:function(e){this.$refs.categorySelectTree.filter(e)},treeFilter:function(e,t){return!e||-1!==t.name.indexOf(e)}}},Bt=At,Rt=(0,E.Z)(Bt,Vt,Mt,!1,null,"68aeafeb",null),zt=Rt.exports,Zt={name:"DataSetManagement",directives:{table:Ge.Z},components:{TypeTree:j,DatasetTypeDialog:jt,OriginalEditForm:gt,CustomEditForm:ut,JsonEditForm:Xe,StoredProcedureEditForm:zt,ScriptEditForm:st,JsEditForm:Ae,checkDatasource:it.Z,HttpEditForm:Et},mixins:[me.a],props:{multiple:{type:Boolean,default:!1},isDialog:{type:Boolean,default:!1},dsValue:{type:[Array,Object],default:null},appCode:{type:String,default:""},isBorder:{type:Boolean,default:!1},toAdd:{type:Boolean,default:!0},doEdit:{type:Boolean,default:!0},isDelete:{type:Boolean,default:!0}},data:function(){return{reasonList:[],datasetType:null,isEdit:!1,categoryData:[],tableData:[],queryForm:{name:"",datasetType:"",typeId:"",labelIds:[]},datasetTypeList:[],labelList:[],isPackUpTree:!1,transition:.1,loadingText:"正在加载数据",dataListLoading:!1,leftBox:null,rightBox:null,startX:null,event:null,endX:null,resize:null,datasetId:"",datasetName:"",typeId:"",curRow:null,multipleSelection:[],componentData:{component:null,config:null,key:(new Date).getTime()}}},computed:{allType:function(){return this.datasetTypeList.map((function(e){return e.datasetType})).filter((function(e){return""!==e}))}},watch:{datasetType:function(e){null===e&&(this.datasetId="",this.datasetName="",this.isEdit=!1)}},mounted:function(){this.init(),/Safari/.test(navigator.userAgent)&&!/Chrome/.test(navigator.userAgent)&&document.addEventListener("mousemove",(function(e){1===e.buttons&&e.preventDefault()}))},methods:{getLabels:function(e){var t=this,a=[];return null===e||void 0===e||e.forEach((function(e){var s;a.push(null===(s=t.labelList.filter((function(t){return t.id===e}))[0])||void 0===s?void 0:s.labelName)})),a},toggleRowSelection:function(){var e=this;this.$nextTick((function(){var t=e.multipleSelection.map((function(e){return e.id}));e.$refs.userTable.clearSelection(),e.tableData.forEach((function(a){t.includes(a.id)&&e.$refs.userTable.toggleRowSelection(a,!0)}))}))},selectAll:function(e){var t=this;if(this.isDialog&&this.multiple)if(e.length){var a=this.multipleSelection.map((function(e){return e.id}));e.forEach((function(e){a.includes(e.id)||t.multipleSelection.push(e)}))}else this.tableData.forEach((function(e){var a=t.multipleSelection.map((function(e){return e.id})),s=a.indexOf(e.id);s>-1&&t.multipleSelection.splice(s,1)}))},selectDs:function(e,t){if(this.isDialog&&this.multiple){var a=null,s=this.multipleSelection.find((function(e,s){if(e.id===t.id)return a=s,e}));s?this.multipleSelection.splice(a,1):this.multipleSelection.push(t)}},getSelectDs:function(){if(this.isDialog)return this.multiple?this.multipleSelection:this.curRow?this.curRow:null},handleCurrentChange:function(e){this.curRow=e},delDataset:function(e){var t=this;e.loading=!0,f(e.id).then((function(a){e.loading=!1,a.canDelete?t.$confirm("确定删除当前数据集吗?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning",customClass:"bs-el-message-box"}).then((function(){_(e.id).then((function(e){t.init(!1),t.$message.success("删除成功")}))})).catch((function(){})):(t.reasonList=a.reasons,t.$refs.checkDatasource.checkDatasourceVisible=!0)}))},toPreview:function(e,t,a,s){this.datasetId=e,this.datasetType=t,this.datasetName=a,this.typeId=s,this.isEdit=!1},toEdit:function(e,t,a,s){var i,r;this.datasetId=e,this.datasetType=t,this.componentData=null!==(i=this.getComponents(null===(r=this.datasetTypeList.find((function(e){return(null===e||void 0===e?void 0:e.datasetType)===t})))||void 0===r?void 0:r.componentName))&&void 0!==i?i:"",this.datasetName=a,this.typeId=s,this.isEdit=!0},back:function(){this.datasetType=null,this.isEdit=!1},openAddForm:function(e,t){this.datasetType=e,this.componentData=this.getComponents(t),this.typeId=this.queryForm.typeId,this.isEdit=!0},showOperate:function(e){var t,a,s,i;return null===(t=null===(a=this.getComponents(null===(i=this.datasetTypeList.find((function(t){return t.datasetType===e})))||void 0===i?void 0:i.componentName))||void 0===a||null===(s=a.config)||void 0===s?void 0:s.showOperate)||void 0===t||t},getComponents:function(e){var t,a,s,i,r,l=Object.values(this.$options.components),o=null;null!==(t=window.BS_CONFIG)&&void 0!==t&&t.customDatasetComponents&&(null===(a=window.BS_CONFIG)||void 0===a?void 0:a.customDatasetComponents.length)>0&&(o=null===(r=window.BS_CONFIG)||void 0===r?void 0:r.customDatasetComponents.find((function(t){return t.config.componentName===e})));return{component:l.find((function(t){return t.name===e}))||(null===(s=o)||void 0===s?void 0:s.vueFile),config:(null===(i=o)||void 0===i?void 0:i.config)||null,key:(new Date).getTime()}},init:function(){var e,t,a,s,i,r=this,o=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];o&&this.getTreeList(),this.isDialog&&(this.multiple?this.multipleSelection=this.dsValue?this.dsValue:[]:this.curRow=this.dsValue),this.current=1;var n,c=[{name:"全部",datasetType:""},{name:"原始数据集",datasetType:"original",componentName:"OriginalEditForm",description:"直接查询某个数据库表"},{name:"自助数据集",datasetType:"custom",componentName:"CustomEditForm",description:"自定义SQL语句查询"},{name:"存储过程数据集",datasetType:"storedProcedure",componentName:"StoredProcedureEditForm",description:"调用数据库存储过程查询"},{name:"JSON数据集",datasetType:"json",componentName:"JsonEditForm",description:"直接定义静态数据"},{name:"JS数据集",datasetType:"js",componentName:"JsEditForm",description:"编写JS代码进行动态模拟数据创建"},{name:"HTTP数据集",datasetType:"http",componentName:"HttpEditForm",description:"接入第三方HTTP服务查询"},{name:"脚本数据集",datasetType:"script",componentName:"ScriptEditForm",description:"支持ES、Mongodb、国产化数据库、自定义Java代码查询"}];(null!==(e=window.BS_CONFIG)&&void 0!==e&&e.datasetTypeList&&0!==(null===(t=window.BS_CONFIG)||void 0===t||null===(a=t.datasetTypeList)||void 0===a?void 0:a.length)?this.datasetTypeList=[{name:"全部",datasetType:""}].concat((0,l.Z)(c.filter((function(e){var t;return-1!==(null===(t=window.BS_CONFIG)||void 0===t?void 0:t.datasetTypeList.findIndex((function(t){return t===e.datasetType})))})))):this.datasetTypeList=[].concat(c),null!==(s=window.BS_CONFIG)&&void 0!==s&&s.customDatasetComponents&&(null===(i=window.BS_CONFIG)||void 0===i?void 0:i.customDatasetComponents.length)>0)&&(null===(n=window.BS_CONFIG)||void 0===n||n.customDatasetComponents.forEach((function(e){r.datasetTypeList.push({name:e.config.name,datasetType:e.config.datasetType,componentName:e.config.componentName})})));this.getDataList()},addDataset:function(){this.$refs.DatasetTypeDialog.dialogVisible=!0},selectChange:function(){this.getDataList()},getTreeList:function(){},getDataList:function(){var e=this;H().then((function(t){e.labelList=t})),this.dataListLoading=!0,m((0,r.Z)((0,r.Z)({current:this.current,size:this.size,moduleCode:this.appCode},this.queryForm),{},{datasetType:""===this.queryForm.datasetType?(0,l.Z)(this.allType):[this.queryForm.datasetType]})).then((function(t){if(e.tableData=t.list,e.tableData.forEach((function(t){e.$set(t,"loading",!1)})),e.isDialog)if(e.multiple&&e.multipleSelection.length)e.toggleRowSelection();else if(e.curRow.id){var a=e.tableData.find((function(t){return t.id===e.curRow.id}));a&&(e.curRow=a)}e.totalCount=t.totalCount,e.dataListLoading=!1})).catch((function(){e.dataListLoading=!1}))},expandedNodes:function(e){this.transition=e&&e>50?0:.1},nodeClick:function(e,t){this.current=1,"group"===t?(this.queryForm.typeId=e.id,this.queryForm.datasetType=""):"type"===t&&(this.queryForm.typeId="",this.queryForm.datasetType=e),this.getDataList()},refreshData:function(e){e&&e.id===this.queryForm.typeId&&(this.queryForm.typeId=""),this.getDataList()},handleSearch:function(){this.current=1,this.queryForm.typeId="",this.$refs.datasetsTypeTree.ztreeObj.cancelSelectedNode(),this.getDataList()},mousedown:function(e){this.resize=document.getElementsByClassName("resize")[0],this.resize.left=document.getElementById("left-box").getBoundingClientRect().width,this.leftBox=document.getElementsByClassName("left-box")[0],this.rightBox=document.getElementsByClassName("right-box")[0],this.startX=e.clientX},mousemove:function(e){if(this.event=e,this.resize){var t=document.getElementById("box").getBoundingClientRect().width;this.endX=e.clientX;var a=document.getElementById("box").getBoundingClientRect().left>300?0:25,s=this.resize.left+(this.endX-this.startX)+a;this.leftBox.style.width=s/t*100+"%",this.rightBox.style.width=100*(1-s/t)+"%",this.isPackUpTree=!1,s<100&&this.endX-this.startX<0?(this.isPackUpTree=!0,this.leftBox.style.width="0%",this.rightBox.style.width="100%"):s/t>.5&&(this.leftBox.style.width="50%",this.rightBox.style.width="50%")}},packUpTree:function(){this.$refs.datasetsTypeTree.expandedNodes(),this.isPackUpTree=!this.isPackUpTree,this.isPackUpTree?(this.leftBox.style.width="0%",this.rightBox.style.width="100%"):(this.leftBox.style.width="25%",this.rightBox.style.width="75%")},mouseup:function(){this.resize&&(this.resize=null,this.endX<350&&this.endX-this.startX>0&&(this.isPackUpTree=!1,this.leftBox.style.width="25%",this.rightBox.style.width="75%"))},mousemoveOnBox:function(e){this.mousemove(e)},mouseupOnBox:function(){this.resize=null,this.endX<350&&this.endX-this.startX>0&&(this.isPackUpTree=!1,this.leftBox.style.width="25%",this.rightBox.style.width="75%"),this.resize=null}}},Ut=Zt,Wt=(0,E.Z)(Ut,s,i,!1,null,"71f85380",null),Kt=Wt.exports;Kt.install=function(e){e.component(Kt.name,Kt)};var Ht=Kt},5661:function(e,t,a){a.d(t,{a:function(){return s}});var s={data:function(){return{current:1,size:10,totalPage:0,totalCount:0,prevText:"",nextText:"",sortForm:{sortFieldMap:{},sortFieldOrderList:[],columnCacheMap:{}},enableMultiFieldOrder:!1,sortFieldHeaderTipMap:{}}},watch:{"sortForm.sortFieldMap":{handler:function(e,t){for(var a in e){var s=e[a];s?"ascending"===s?this.$set(this.sortFieldHeaderTipMap,a,"点击降序"):"descending"===s?this.$set(this.sortFieldHeaderTipMap,a,"取消排序"):this.$set(this.sortFieldHeaderTipMap,a,"点击升序"):this.$set(this.sortFieldHeaderTipMap,a,"点击升序")}},deep:!0}},methods:{initSortField:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(t)for(var a in t){var s=t[a];this.$set(this.sortForm.sortFieldMap,a,s)}for(var i=0;i<e.length;i++){var r=e[i],l=this.sortForm.sortFieldMap[r];l||this.$set(this.sortForm.sortFieldMap,r,"")}this.sortForm.sortFieldOrderList=e},sortStyle:function(e){e.row;var t=e.column,a=(e.rowIndex,e.columnIndex,this.sortForm.sortFieldMap[t.property]);a&&(t.order=a),this.sortForm.columnCacheMap[t.property]=t},reSort:function(e){if(!this.enableMultiFieldOrder){for(var t in this.sortForm.columnCacheMap){var a=this.sortForm.columnCacheMap[t];a.order=""}for(var s in this.sortForm.sortFieldMap)this.sortForm.sortFieldMap[s]=""}this.$set(this.sortForm.sortFieldMap,e.prop,e.order),this.reSearch()},reSearch:function(){this.current=1,this.getDataList()},getDataList:function(){console.error("你应该重写getDataList方法")},sizeChangeHandle:function(e){this.size=e,this.current=1,this.getDataList()},currentChangeHandle:function(e){this.current=e,this.getDataList()},getSortForm:function(){return{sortFieldMap:this.sortForm.sortFieldMap,sortFieldOrderList:this.sortForm.sortFieldOrderList}}}}},16669:function(e,t,a){a.d(t,{$z:function(){return p},Ax:function(){return u},FD:function(){return b},IH:function(){return r},JG:function(){return l},TU:function(){return c},VZ:function(){return f},Vx:function(){return o},ZK:function(){return m},h3:function(){return d},r2:function(){return n}});a(34338);var s=a(91317),i=a.n(s),r=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return i().prototype.$dataRoomAxios.post("/datasource/add",e,t)},l=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"-1",t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return i().prototype.$dataRoomAxios.post("/datasource/deleteCheck/".concat(e),{},t)},o=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return i().prototype.$dataRoomAxios.post("/datasource/update",e,t)},n=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return i().prototype.$dataRoomAxios.post("/datasource/checkRepeat",e,t)},c=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return i().prototype.$dataRoomAxios.post("/datasource/testConnect",e,t)},d=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return i().prototype.$dataRoomAxios.get("/datasource/page",e,t)},u=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return i().prototype.$dataRoomAxios.get("/datasource/list",e,t)},p=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"-1",t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return i().prototype.$dataRoomAxios.post("/datasource/delete/".concat(e),{},t)},m=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"-1",t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return i().prototype.$dataRoomAxios.get("/datasource/getTableList/".concat(e),{},t)},f=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"-1",t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return i().prototype.$dataRoomAxios.get("/datasource/getViewList/".concat(e),{},t)},b=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"-1",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",a=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return i().prototype.$dataRoomAxios.get("/datasource/getFieldList/table/".concat(e,"/").concat(t),{},a)}},78658:function(__unused_webpack_module,__webpack_exports__,__webpack_require__){__webpack_require__.d(__webpack_exports__,{Z:function(){return axiosFormatting}});var D_Documents_Sources_DataRoom_data_room_ui_node_modules_babel_runtime_helpers_esm_objectSpread2_js__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(95082),core_js_modules_es_object_to_string_js__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(60228),core_js_modules_es_object_to_string_js__WEBPACK_IMPORTED_MODULE_1___default=__webpack_require__.n(core_js_modules_es_object_to_string_js__WEBPACK_IMPORTED_MODULE_1__),core_js_modules_es_regexp_exec_js__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(64043),core_js_modules_es_regexp_exec_js__WEBPACK_IMPORTED_MODULE_2___default=__webpack_require__.n(core_js_modules_es_regexp_exec_js__WEBPACK_IMPORTED_MODULE_2__),core_js_modules_es_string_replace_js__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__(57267),core_js_modules_es_string_replace_js__WEBPACK_IMPORTED_MODULE_3___default=__webpack_require__.n(core_js_modules_es_string_replace_js__WEBPACK_IMPORTED_MODULE_3__),core_js_modules_es_regexp_constructor_js__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__(52003),core_js_modules_es_regexp_constructor_js__WEBPACK_IMPORTED_MODULE_4___default=__webpack_require__.n(core_js_modules_es_regexp_constructor_js__WEBPACK_IMPORTED_MODULE_4__),core_js_modules_es_regexp_dot_all_js__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__(68518),core_js_modules_es_regexp_dot_all_js__WEBPACK_IMPORTED_MODULE_5___default=__webpack_require__.n(core_js_modules_es_regexp_dot_all_js__WEBPACK_IMPORTED_MODULE_5__),core_js_modules_es_regexp_sticky_js__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__(13440),core_js_modules_es_regexp_sticky_js__WEBPACK_IMPORTED_MODULE_6___default=__webpack_require__.n(core_js_modules_es_regexp_sticky_js__WEBPACK_IMPORTED_MODULE_6__),core_js_modules_es_regexp_to_string_js__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__(12826),core_js_modules_es_regexp_to_string_js__WEBPACK_IMPORTED_MODULE_7___default=__webpack_require__.n(core_js_modules_es_regexp_to_string_js__WEBPACK_IMPORTED_MODULE_7__),core_js_modules_es_array_index_of_js__WEBPACK_IMPORTED_MODULE_8__=__webpack_require__(97195),core_js_modules_es_array_index_of_js__WEBPACK_IMPORTED_MODULE_8___default=__webpack_require__.n(core_js_modules_es_array_index_of_js__WEBPACK_IMPORTED_MODULE_8__),core_js_modules_es_string_match_js__WEBPACK_IMPORTED_MODULE_9__=__webpack_require__(22462),core_js_modules_es_string_match_js__WEBPACK_IMPORTED_MODULE_9___default=__webpack_require__.n(core_js_modules_es_string_match_js__WEBPACK_IMPORTED_MODULE_9__),core_js_modules_es_array_concat_js__WEBPACK_IMPORTED_MODULE_10__=__webpack_require__(34338),core_js_modules_es_array_concat_js__WEBPACK_IMPORTED_MODULE_10___default=__webpack_require__.n(core_js_modules_es_array_concat_js__WEBPACK_IMPORTED_MODULE_10__),core_js_modules_es_array_reduce_js__WEBPACK_IMPORTED_MODULE_11__=__webpack_require__(11390),core_js_modules_es_array_reduce_js__WEBPACK_IMPORTED_MODULE_11___default=__webpack_require__.n(core_js_modules_es_array_reduce_js__WEBPACK_IMPORTED_MODULE_11__),core_js_modules_es_function_name_js__WEBPACK_IMPORTED_MODULE_12__=__webpack_require__(34284),core_js_modules_es_function_name_js__WEBPACK_IMPORTED_MODULE_12___default=__webpack_require__.n(core_js_modules_es_function_name_js__WEBPACK_IMPORTED_MODULE_12__),core_js_modules_es_json_stringify_js__WEBPACK_IMPORTED_MODULE_13__=__webpack_require__(48324),core_js_modules_es_json_stringify_js__WEBPACK_IMPORTED_MODULE_13___default=__webpack_require__.n(core_js_modules_es_json_stringify_js__WEBPACK_IMPORTED_MODULE_13__),core_js_modules_es_object_keys_js__WEBPACK_IMPORTED_MODULE_14__=__webpack_require__(69358),core_js_modules_es_object_keys_js__WEBPACK_IMPORTED_MODULE_14___default=__webpack_require__.n(core_js_modules_es_object_keys_js__WEBPACK_IMPORTED_MODULE_14__),core_js_modules_es_promise_js__WEBPACK_IMPORTED_MODULE_15__=__webpack_require__(73964),core_js_modules_es_promise_js__WEBPACK_IMPORTED_MODULE_15___default=__webpack_require__.n(core_js_modules_es_promise_js__WEBPACK_IMPORTED_MODULE_15__),axios__WEBPACK_IMPORTED_MODULE_16__=__webpack_require__(9669),axios__WEBPACK_IMPORTED_MODULE_16___default=__webpack_require__.n(axios__WEBPACK_IMPORTED_MODULE_16__),lodash_cloneDeep__WEBPACK_IMPORTED_MODULE_17__=__webpack_require__(50361),lodash_cloneDeep__WEBPACK_IMPORTED_MODULE_17___default=__webpack_require__.n(lodash_cloneDeep__WEBPACK_IMPORTED_MODULE_17__);function axiosFormatting(customConfig){var newCustomConfig=replaceParams(customConfig),httpConfig={timeout:3e4,baseURL:"",headers:(0,D_Documents_Sources_DataRoom_data_room_ui_node_modules_babel_runtime_helpers_esm_objectSpread2_js__WEBPACK_IMPORTED_MODULE_0__.Z)({"Content-Type":"application/json"},newCustomConfig.headers)},instance=axios__WEBPACK_IMPORTED_MODULE_16___default().create(httpConfig);instance.interceptors.request.use((function(config){var req=(0,D_Documents_Sources_DataRoom_data_room_ui_node_modules_babel_runtime_helpers_esm_objectSpread2_js__WEBPACK_IMPORTED_MODULE_0__.Z)((0,D_Documents_Sources_DataRoom_data_room_ui_node_modules_babel_runtime_helpers_esm_objectSpread2_js__WEBPACK_IMPORTED_MODULE_0__.Z)({},config),{},{url:{}});for(var key in eval(newCustomConfig.requestScript),req.url)newCustomConfig.url=replaceUrlParam(newCustomConfig.url,key,req.url[key]);return config=(0,D_Documents_Sources_DataRoom_data_room_ui_node_modules_babel_runtime_helpers_esm_objectSpread2_js__WEBPACK_IMPORTED_MODULE_0__.Z)((0,D_Documents_Sources_DataRoom_data_room_ui_node_modules_babel_runtime_helpers_esm_objectSpread2_js__WEBPACK_IMPORTED_MODULE_0__.Z)((0,D_Documents_Sources_DataRoom_data_room_ui_node_modules_babel_runtime_helpers_esm_objectSpread2_js__WEBPACK_IMPORTED_MODULE_0__.Z)({},config),req),{},{url:newCustomConfig.url}),config}),(function(e){return Promise.reject(e)})),instance.interceptors.response.use((function(e){var t=e.data;if(newCustomConfig.responseScript){var a=new Function("resp",newCustomConfig.responseScript),s=a(t);return Promise.resolve(s)}return Promise.resolve(t)}));var body=null===newCustomConfig||void 0===newCustomConfig?void 0:newCustomConfig.body.replace(/: ,/g,":undefined,").replace(/, }/g,",undefined}");return new Promise((function(e,t){instance({method:newCustomConfig.method,url:newCustomConfig.url,params:newCustomConfig.params,data:"post"===newCustomConfig.method?body:void 0}).then((function(t){e(t)})).catch((function(e){t(e)}))}))}function replaceUrlParam(e,t,a){var s=new RegExp("([?&])".concat(t,"=.*?(&|$)"),"i"),i=-1!==e.indexOf("?")?"&":"?";return e.match(s)?e.replace(s,"$1".concat(t,"=").concat(a,"$2")):"".concat(e).concat(i).concat(t,"=").concat(a)}function replaceParams(e){var t=lodash_cloneDeep__WEBPACK_IMPORTED_MODULE_17___default()(e);return t.url=evalStrFunc(t.paramsList,t.url),t.headers=evalArrFunc(t.paramsList,t.headers),t.params=evalArrFunc(t.paramsList,t.params),t.body=evalStrFunc(t.paramsList,t.body),t}function evalStrFunc(paramsList,string){var params=paramsList.reduce((function(e,t){return e[t.name]=t.value,e}),{}),str=string.replace(/\$\{(\w+)\}/g,(function(e,t){return"${params."+t+"}"})),transformStr="";return eval("transformStr = `"+str+"`"),transformStr}function evalArrFunc(paramsList,arr){var params=paramsList.reduce((function(e,t){return e[t.name]=t.value,e}),{}),paramsListObj=arr.reduce((function(e,t){return e[t.key]=t.value,e}),{}),paramsListStr=JSON.stringify(paramsListObj),str=paramsListStr.replace(/\$\{(\w+)\}/g,(function(e,t){return"${params."+t+"}"})),transformStr="";eval("transformStr = `"+str+"`");var obj=JSON.parse(transformStr);return obj}},46761:function(e,t,a){var s=a(50124),i=a(48534),r=(a(96869),a(21057),a(68932),function(){var e=(0,i.Z)((0,s.Z)().mark((function e(t,a,i){var r,l,o,n,c;return(0,s.Z)().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,i;case 2:if(r=e.sent,l=r.componentInstance,o=a.value,l.height){e.next=7;break}throw new Error("使用v-table指令,el-table需设置height,例如: height='0'");case 7:if(n=o||100,l){e.next=10;break}return e.abrupt("return");case 10:c=window.innerHeight-t.getBoundingClientRect().top-n,c+=32,l.layout.setHeight(c),l.doLayout();case 14:case"end":return e.stop()}}),e)})));return function(t,a,s){return e.apply(this,arguments)}}()),l=function(e){var t=null;return function(){t||(t=setTimeout((function(){e(),t=null}),500))}};t.Z={bind:function(e,t,a){e.resizeListener=(0,i.Z)((0,s.Z)().mark((function i(){return(0,s.Z)().wrap((function(s){while(1)switch(s.prev=s.next){case 0:return s.next=2,r(e,t,a);case 2:case"end":return s.stop()}}),i)}))),window.addEventListener("resize",l(e.resizeListener))},inserted:function(e,t,a){return(0,i.Z)((0,s.Z)().mark((function i(){return(0,s.Z)().wrap((function(s){while(1)switch(s.prev=s.next){case 0:return s.next=2,r(e,t,a);case 2:case"end":return s.stop()}}),i)})))()},componentUpdated:function(e,t,a){return(0,i.Z)((0,s.Z)().mark((function i(){return(0,s.Z)().wrap((function(s){while(1)switch(s.prev=s.next){case 0:return s.next=2,setTimeout((function(){r(e,t,a)}),500);case 2:case"end":return s.stop()}}),i)})))()},unbind:function(e){window.removeEventListener("resize",l(e.resizeListener))}}}}]);