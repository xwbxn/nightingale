"use strict";(self["webpackChunk_gcpaas_data_room_ui"]=self["webpackChunk_gcpaas_data_room_ui"]||[]).push([[237],{60929:function(e,_,t){t.r(_),t.d(_,{default:function(){return E}});t(34284);var r=function(){var e=this,_=e.$createElement,t=e._self._c||_;return e.hasPermission?t("div",[t("div",{directives:[{name:"loading",rawName:"v-loading",value:e.pageLoading,expression:"pageLoading"}],staticClass:"bs-preview-wrap",style:e.previewWrapStyle,attrs:{"element-loading-background":"#151A26"}},[t("div",{staticClass:"bs-render-wrap render-theme-wrap",style:e.renderStyle},e._l(e.chartList,(function(_){return t("div",{key:_.code,style:e.getStyle(_)},[t("Configuration",{attrs:{config:_},on:{openDataViewDialog:e.openDataViewDialog}},[t("RenderCard",{key:_.key,ref:"RenderCardRef",refInFor:!0,attrs:{config:_},on:{styleHandler:e.styleHandler}})],1)],1)})),0)]),t("data-view-dialog",{ref:"dataViewDialog"})],1):t("NotPermission")},o=[],n=t(95082),i=(t(34338),t(49693),t(60228),t(47522),t(96869),t(97195),t(21694),t(76265),t(79307),t(98858),t(61318),t(33228),t(752),t(27611)),s=t(26294),a=t(33149),c=t(77069),u=t(3706),d=t(48008),g=t(7651),f={name:"BigScreenRun",components:{DataViewDialog:d.Z,Configuration:u.Z,RenderCard:i.Z,NotPermission:c["default"]},props:{config:{type:Object,default:function(){return{code:"",fitSelector:".inner-preview-wrap",fitMode:"auto"}}}},data:function(){return{innerHeight:window.innerHeight,innerWidth:window.innerWidth,timer:null,hasPermission:!0}},computed:(0,n.Z)((0,n.Z)({},(0,s.mapState)({pageInfo:function(e){return e.bigScreen.pageInfo},pageConfig:function(e){return e.bigScreen.pageInfo.pageConfig},chartList:function(e){return e.bigScreen.pageInfo.chartList},stateFitMode:function(e){return e.bigScreen.pageInfo.pageConfig.fitMode}})),{},{pageCode:function(){var e=this.getIframeCode();return this.$route.query.code||e||this.config.code},fitMode:function(){return this.config.fitMode||this.stateFitMode},fitSelector:function(){return this.config.fitSelector},pageLoading:function(){return this.$store.state.bigScreen.pageLoading},fitPageConfig:function(){return this.resolvePageConfig(this.pageConfig)},previewWrapStyle:function(){var e="none"!==this.fitMode?{backgroundColor:"light"===this.fitPageConfig.customTheme?this.fitPageConfig.lightBgColor:this.fitPageConfig.bgColor,backgroundImage:"light"===this.fitPageConfig.customTheme?"url(".concat(this.getCoverPicture(this.fitPageConfig.lightBg),")"):"url(".concat(this.getCoverPicture(this.fitPageConfig.bg),")"),backgroundSize:"cover"}:{};return(0,n.Z)({overflowX:"".concat(this.fitPageConfig.overflowX),overflowY:"".concat(this.fitPageConfig.overflowY)},e)},renderStyle:function(){var e={width:this.fitPageConfig.w,height:this.fitPageConfig.h,transform:"scaleX(".concat(this.fitPageConfig.scaleX,") scaleY(").concat(this.fitPageConfig.scaleY,") translate(").concat(this.fitPageConfig.translate,")")},_="none"===this.fitMode?{backgroundColor:"light"===this.fitPageConfig.customTheme?this.fitPageConfig.lightBgColor:this.fitPageConfig.bgColor,backgroundImage:"light"===this.fitPageConfig.customTheme?"url(".concat(this.getCoverPicture(this.fitPageConfig.lightBg),")"):"url(".concat(this.getCoverPicture(this.fitPageConfig.bg),")"),backgroundSize:"cover"}:{};return(0,n.Z)((0,n.Z)({},e),_)}}),watch:{pageCode:function(e){e&&this.init()},"pageInfo.pageConfig.refreshConfig.length":{handler:function(e){e&&this.startTimer()}}},beforeRouteLeave:function(e,_,t){this.$store.commit("bigScreen/resetStoreData"),t()},created:function(){this.permission(),this.getParentWH(),this.windowSize()},mounted:function(){this.pageInfo.pageConfig.refreshConfig&&this.pageInfo.pageConfig.refreshConfig.length>0&&this.startTimer()},beforeDestroy:function(){this.stopTimer()},methods:(0,n.Z)((0,n.Z)((0,n.Z)({},(0,s.mapActions)("bigScreen",["initLayout"])),(0,s.mapMutations)("bigScreen",["changeLayout","changePageLoading","changePageConfig","changeChartConfig"])),{},{getStyle:function(e){return e.perspective>0?{position:"absolute",width:e.w+"px",height:e.h+"px",left:e.x+"px",top:e.y+"px",transform:"perspective(".concat(e.perspective,"px) skew(").concat(e.skewX,"deg, ").concat(e.skewY,"deg) rotateX(").concat(e.rotateX,"deg) rotateY(").concat(e.rotateY,"deg)  rotateZ(").concat(e.rotateZ,"deg)"),zIndex:e.z||0}:{position:"absolute",width:e.w+"px",height:e.h+"px",left:e.x+"px",top:e.y+"px",transform:"skew(".concat(e.skewX,"deg, ").concat(e.skewY,"deg) rotateX(").concat(e.rotateX,"deg) rotateY(").concat(e.rotateY,"deg)  rotateZ(").concat(e.rotateZ,"deg)"),zIndex:e.z||0}},openDataViewDialog:function(e){this.$refs.dataViewDialog.init(e)},styleHandler:function(e){var _=this;this.chartList.forEach((function(t,r){t.code===e.code&&_.$refs.RenderCardRef[r].$refs[t.code].changeStyle(e)}))},permission:function(){var e=this;this.$dataRoomAxios.get("/bigScreen/permission/check/".concat(this.pageCode)).then((function(_){e.hasPermission=_,_&&e.init()}))},init:function(){var e=this;this.pageCode&&(this.changePageLoading(!0),this.initLayout(this.pageCode).then((function(){e.changePageLoading(!1),e.getParentWH()})))},startTimer:function(){var e=1,_=this;this.timer=setTimeout((function t(){_.pageInfo.pageConfig.refreshConfig.forEach((function(t){t.code&&(1===e&&(t.originTime=t.time),_.chartList.forEach((function(r,o){var n;t.code===r.code&&t.time===e&&(t.time=t.time+t.originTime,null!==(n=_.$refs.RenderCardRef[o].$refs[r.code])&&void 0!==n&&n.componentInstance?_.$refs.RenderCardRef[o].$refs[r.code].componentInstance.changeData(r):_.$refs.RenderCardRef[o].$refs[r.code].changeData(r))})))})),e+=1,_.timer=setTimeout(t,1e3)}),1e3)},stopTimer:function(){clearTimeout(this.timer)},getIframeCode:function(){var e=window.location.href,_=null;if(-1!==e.indexOf("#")){var t=e.split("#")[1],r=new URLSearchParams(t);_=r.get("code")}else{var o=new URLSearchParams(e.split("?")[1]);_=o.get("code")}return _},windowSize:function(){var e=this;window.onresize=function(){e.getParentWH()}},getParentWH:function(){var e=this;this.$nextTick((function(){var _=document.querySelector(e.fitSelector);_?(e.innerHeight=_.offsetHeight,e.innerWidth=_.offsetWidth):(e.innerHeight=window.innerHeight,e.innerWidth=window.innerWidth);var t=document.querySelector(".bs-preview-wrap");t&&(t.style.height=e.innerHeight+"px",t.style.width=e.innerWidth+"px")}))},styleSet:function(){var e=document.createElement("style");if(this.pageConfig.themeJson&&this.pageConfig.themeJson.themeCss){var _=this.pageConfig.themeJson.themeCss,t=(0,a.MY)(_).code;e.type="text/css",e.innerText=t,document.getElementsByTagName("head")[0].appendChild(e)}else e.remove()},resolvePageConfig:function(e){var _=e.w,t=e.h,r=1,o=1,i="0px, 0px",s="auto",a="auto";if("auto"===e.fitMode){var c=this.innerWidth/_,u=this.innerHeight/t;r=Math.min(c,u),o=Math.min(c,u),i="".concat((this.innerWidth-_)/2/r,"px, ").concat((this.innerHeight-t)/2/o,"px"),s="hidden",a="hidden"}"fitWidth"===e.fitMode&&(r=this.innerWidth/_,i=this.innerHeight>t?"".concat((this.innerWidth-_)/2/r,"px, ").concat((this.innerHeight-t)/2/o,"px"):"".concat((this.innerWidth-_)/2/r,"px, 0px"),s="hidden"),"fitHeight"===e.fitMode&&(o=this.innerHeight/t,i=this.innerWidth>_?"".concat((this.innerWidth-_)/2/r,"px, ").concat((this.innerHeight-t)/2/o,"px"):"0px, ".concat((this.innerHeight-t)/2/o,"px"),a="hidden"),"cover"===e.fitMode&&(r=this.innerWidth/_,o=this.innerHeight/t,i="".concat((this.innerWidth-_)/2/r,"px, ").concat((this.innerHeight-t)/2/o,"px"),s="hidden",a="hidden");var d=(0,n.Z)((0,n.Z)({},e),{},{w:_+"px",h:t+"px",scaleX:r,scaleY:o,translate:i,overflowX:s,overflowY:a});return d},getCoverPicture:function(e){return(0,g.q)(e)}})},l=f,m=t(1001),p=(0,m.Z)(l,r,o,!1,null,"43b13a43",null),h=p.exports;h.install=function(e){e.component(h.name,h)};var E=h},78658:function(__unused_webpack_module,__webpack_exports__,__webpack_require__){__webpack_require__.d(__webpack_exports__,{Z:function(){return axiosFormatting}});var D_Documents_Sources_DataRoom_data_room_ui_node_modules_babel_runtime_helpers_esm_objectSpread2_js__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(95082),core_js_modules_es_object_to_string_js__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(60228),core_js_modules_es_object_to_string_js__WEBPACK_IMPORTED_MODULE_1___default=__webpack_require__.n(core_js_modules_es_object_to_string_js__WEBPACK_IMPORTED_MODULE_1__),core_js_modules_es_regexp_exec_js__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(64043),core_js_modules_es_regexp_exec_js__WEBPACK_IMPORTED_MODULE_2___default=__webpack_require__.n(core_js_modules_es_regexp_exec_js__WEBPACK_IMPORTED_MODULE_2__),core_js_modules_es_string_replace_js__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__(57267),core_js_modules_es_string_replace_js__WEBPACK_IMPORTED_MODULE_3___default=__webpack_require__.n(core_js_modules_es_string_replace_js__WEBPACK_IMPORTED_MODULE_3__),core_js_modules_es_regexp_constructor_js__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__(52003),core_js_modules_es_regexp_constructor_js__WEBPACK_IMPORTED_MODULE_4___default=__webpack_require__.n(core_js_modules_es_regexp_constructor_js__WEBPACK_IMPORTED_MODULE_4__),core_js_modules_es_regexp_dot_all_js__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__(68518),core_js_modules_es_regexp_dot_all_js__WEBPACK_IMPORTED_MODULE_5___default=__webpack_require__.n(core_js_modules_es_regexp_dot_all_js__WEBPACK_IMPORTED_MODULE_5__),core_js_modules_es_regexp_sticky_js__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__(13440),core_js_modules_es_regexp_sticky_js__WEBPACK_IMPORTED_MODULE_6___default=__webpack_require__.n(core_js_modules_es_regexp_sticky_js__WEBPACK_IMPORTED_MODULE_6__),core_js_modules_es_regexp_to_string_js__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__(12826),core_js_modules_es_regexp_to_string_js__WEBPACK_IMPORTED_MODULE_7___default=__webpack_require__.n(core_js_modules_es_regexp_to_string_js__WEBPACK_IMPORTED_MODULE_7__),core_js_modules_es_array_index_of_js__WEBPACK_IMPORTED_MODULE_8__=__webpack_require__(97195),core_js_modules_es_array_index_of_js__WEBPACK_IMPORTED_MODULE_8___default=__webpack_require__.n(core_js_modules_es_array_index_of_js__WEBPACK_IMPORTED_MODULE_8__),core_js_modules_es_string_match_js__WEBPACK_IMPORTED_MODULE_9__=__webpack_require__(22462),core_js_modules_es_string_match_js__WEBPACK_IMPORTED_MODULE_9___default=__webpack_require__.n(core_js_modules_es_string_match_js__WEBPACK_IMPORTED_MODULE_9__),core_js_modules_es_array_concat_js__WEBPACK_IMPORTED_MODULE_10__=__webpack_require__(34338),core_js_modules_es_array_concat_js__WEBPACK_IMPORTED_MODULE_10___default=__webpack_require__.n(core_js_modules_es_array_concat_js__WEBPACK_IMPORTED_MODULE_10__),core_js_modules_es_array_reduce_js__WEBPACK_IMPORTED_MODULE_11__=__webpack_require__(11390),core_js_modules_es_array_reduce_js__WEBPACK_IMPORTED_MODULE_11___default=__webpack_require__.n(core_js_modules_es_array_reduce_js__WEBPACK_IMPORTED_MODULE_11__),core_js_modules_es_function_name_js__WEBPACK_IMPORTED_MODULE_12__=__webpack_require__(34284),core_js_modules_es_function_name_js__WEBPACK_IMPORTED_MODULE_12___default=__webpack_require__.n(core_js_modules_es_function_name_js__WEBPACK_IMPORTED_MODULE_12__),core_js_modules_es_json_stringify_js__WEBPACK_IMPORTED_MODULE_13__=__webpack_require__(48324),core_js_modules_es_json_stringify_js__WEBPACK_IMPORTED_MODULE_13___default=__webpack_require__.n(core_js_modules_es_json_stringify_js__WEBPACK_IMPORTED_MODULE_13__),core_js_modules_es_object_keys_js__WEBPACK_IMPORTED_MODULE_14__=__webpack_require__(69358),core_js_modules_es_object_keys_js__WEBPACK_IMPORTED_MODULE_14___default=__webpack_require__.n(core_js_modules_es_object_keys_js__WEBPACK_IMPORTED_MODULE_14__),core_js_modules_es_promise_js__WEBPACK_IMPORTED_MODULE_15__=__webpack_require__(73964),core_js_modules_es_promise_js__WEBPACK_IMPORTED_MODULE_15___default=__webpack_require__.n(core_js_modules_es_promise_js__WEBPACK_IMPORTED_MODULE_15__),axios__WEBPACK_IMPORTED_MODULE_16__=__webpack_require__(9669),axios__WEBPACK_IMPORTED_MODULE_16___default=__webpack_require__.n(axios__WEBPACK_IMPORTED_MODULE_16__),lodash_cloneDeep__WEBPACK_IMPORTED_MODULE_17__=__webpack_require__(50361),lodash_cloneDeep__WEBPACK_IMPORTED_MODULE_17___default=__webpack_require__.n(lodash_cloneDeep__WEBPACK_IMPORTED_MODULE_17__);function axiosFormatting(customConfig){var newCustomConfig=replaceParams(customConfig),httpConfig={timeout:3e4,baseURL:"",headers:(0,D_Documents_Sources_DataRoom_data_room_ui_node_modules_babel_runtime_helpers_esm_objectSpread2_js__WEBPACK_IMPORTED_MODULE_0__.Z)({"Content-Type":"application/json"},newCustomConfig.headers)},instance=axios__WEBPACK_IMPORTED_MODULE_16___default().create(httpConfig);instance.interceptors.request.use((function(config){var req=(0,D_Documents_Sources_DataRoom_data_room_ui_node_modules_babel_runtime_helpers_esm_objectSpread2_js__WEBPACK_IMPORTED_MODULE_0__.Z)((0,D_Documents_Sources_DataRoom_data_room_ui_node_modules_babel_runtime_helpers_esm_objectSpread2_js__WEBPACK_IMPORTED_MODULE_0__.Z)({},config),{},{url:{}});for(var key in eval(newCustomConfig.requestScript),req.url)newCustomConfig.url=replaceUrlParam(newCustomConfig.url,key,req.url[key]);return config=(0,D_Documents_Sources_DataRoom_data_room_ui_node_modules_babel_runtime_helpers_esm_objectSpread2_js__WEBPACK_IMPORTED_MODULE_0__.Z)((0,D_Documents_Sources_DataRoom_data_room_ui_node_modules_babel_runtime_helpers_esm_objectSpread2_js__WEBPACK_IMPORTED_MODULE_0__.Z)((0,D_Documents_Sources_DataRoom_data_room_ui_node_modules_babel_runtime_helpers_esm_objectSpread2_js__WEBPACK_IMPORTED_MODULE_0__.Z)({},config),req),{},{url:newCustomConfig.url}),config}),(function(e){return Promise.reject(e)})),instance.interceptors.response.use((function(e){var _=e.data;if(newCustomConfig.responseScript){var t=new Function("resp",newCustomConfig.responseScript),r=t(_);return Promise.resolve(r)}return Promise.resolve(_)}));var body=null===newCustomConfig||void 0===newCustomConfig?void 0:newCustomConfig.body.replace(/: ,/g,":undefined,").replace(/, }/g,",undefined}");return new Promise((function(e,_){instance({method:newCustomConfig.method,url:newCustomConfig.url,params:newCustomConfig.params,data:"post"===newCustomConfig.method?body:void 0}).then((function(_){e(_)})).catch((function(e){_(e)}))}))}function replaceUrlParam(e,_,t){var r=new RegExp("([?&])".concat(_,"=.*?(&|$)"),"i"),o=-1!==e.indexOf("?")?"&":"?";return e.match(r)?e.replace(r,"$1".concat(_,"=").concat(t,"$2")):"".concat(e).concat(o).concat(_,"=").concat(t)}function replaceParams(e){var _=lodash_cloneDeep__WEBPACK_IMPORTED_MODULE_17___default()(e);return _.url=evalStrFunc(_.paramsList,_.url),_.headers=evalArrFunc(_.paramsList,_.headers),_.params=evalArrFunc(_.paramsList,_.params),_.body=evalStrFunc(_.paramsList,_.body),_}function evalStrFunc(paramsList,string){var params=paramsList.reduce((function(e,_){return e[_.name]=_.value,e}),{}),str=string.replace(/\$\{(\w+)\}/g,(function(e,_){return"${params."+_+"}"})),transformStr="";return eval("transformStr = `"+str+"`"),transformStr}function evalArrFunc(paramsList,arr){var params=paramsList.reduce((function(e,_){return e[_.name]=_.value,e}),{}),paramsListObj=arr.reduce((function(e,_){return e[_.key]=_.value,e}),{}),paramsListStr=JSON.stringify(paramsListObj),str=paramsListStr.replace(/\$\{(\w+)\}/g,(function(e,_){return"${params."+_+"}"})),transformStr="";eval("transformStr = `"+str+"`");var obj=JSON.parse(transformStr);return obj}}}]);